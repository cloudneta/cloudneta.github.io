<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>CloudNet@</title>
    <link>http://cloudneta.github.io/</link>
    
    <atom:link href="/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description></description>
    <pubDate>Tue, 02 Jun 2020 02:25:44 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>LabGuide - AWS Transit Gateway</title>
      <link>http://cloudneta.github.io/2020/05/16/Transit-Gateway/</link>
      <guid>http://cloudneta.github.io/2020/05/16/Transit-Gateway/</guid>
      <pubDate>Sat, 16 May 2020 04:10:03 GMT</pubDate>
      <description>
      
        &lt;p&gt;&lt;em&gt;ì‘ì„±ì : ongja.cloudnet@&lt;/em&gt;&lt;/p&gt;
      
      </description>
      
      
      <content:encoded><![CDATA[<p><em>ì‘ì„±ì : ongja.cloudnet@</em></p><a id="more"></a><br><details><summary>AWS Transit Gateway ì°¸ê³  ë§í¬</summary><div markdown="1"><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL3ZwYy9sYXRlc3QvdGd3L3doYXQtaXMtdHJhbnNpdC1nYXRld2F5Lmh0bWw=">AWS Transit Gateway ê³µì‹ ë¬¸ì„œ<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby90cmFuc2l0LWdhdGV3YXkv">AWS Transit Gateway ê°œìš”<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL3ZwYy9sYXRlc3QvdGd3L3Rndy1tdWx0aWNhc3Qtb3ZlcnZpZXcuaHRtbA==">Multicast on AWS Transit G<i class="fa fa-external-link-alt"></i></span><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9ibG9ncy9uZXR3b3JraW5nLWFuZC1jb250ZW50LWRlbGl2ZXJ5L3RyYWZmaWMtbWFuYWdlbWVudC13aXRoLWF3cy1nbG9iYWwtYWNjZWxlcmF0b3Iv">ateway<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9ibG9ncy9rb3JlYS9uZXctZm9yLWF3cy10cmFuc2l0LWdhdGV3YXktYnVpbGQtZ2xvYmFsLW5ldHdvcmtzLWFuZC1jZW50cmFsaXplLW1vbml0b3JpbmctdXNpbmctbmV0d29yay1tYW5hZ2VyLw==">AWS Transit Gateway ëª¨ë‹ˆí„°ë§ ì¤‘ì•™ ì§‘ì¤‘í™”<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby90cmFuc2l0LWdhdGV3YXkvcHJpY2luZy8=">AWS Transit Gateway ìš”ê¸ˆ<i class="fa fa-external-link-alt"></i></span></p></div></details><blockquote><p>ğŸ’¡ AWS ì„œë¹„ìŠ¤ ê´€ë ¨í•´ì„œëŠ” í•­ìƒ ìµœìš°ì„ ìœ¼ë¡œ â€˜AWS ì„¤ëª…ì„œâ€™ ë¥¼ ì½ì–´ë³´ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.<br>í•œê¸€ ë²ˆì—­ì´ ë§¤ë„ëŸ½ì§€ ëª»í•˜ë©´ English ë¡œ ë³€ê²½ í›„ ì½ì–´ë³´ê¸¸ ë°”ë€ë‹¤.</p></blockquote><hr><br><h3 id="1-AWS-Transit-Gateway-Theory"><a href="#1-AWS-Transit-Gateway-Theory" class="headerlink" title="1. AWS Transit Gateway Theory"></a>1. AWS Transit Gateway Theory</h3><br><p><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby90cmFuc2l0LWdhdGV3YXkv">1.1 AWS Transit Gateway ë€?<i class="fa fa-external-link-alt"></i></span></p><ul><li>AWS Transit GatewayëŠ” VPCë‚˜ On-Premise ë“±ì˜ ë„¤íŠ¸ì›Œí¬ë¥¼ ë‹¨ì¼ Gatewayì— ì—°ê²°í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•´ ì£¼ëŠ” ì„œë¹„ìŠ¤ì´ë‹¤.</li><li>AWS Transit Gatewayë¥¼ ì‚¬ìš©í•˜ë©´ ì¤‘ì•™ ê²Œì´íŠ¸ì›¨ì´ì™€ ë„¤íŠ¸ì›Œí¬ ì „ë°˜ì˜ ë‹¨ì¼ ì—°ê²°ë§Œ ìƒì„±í•˜ì—¬ ê´€ë¦¬í•˜ë©´ ëœë‹¤.</li><li>Hub &amp; Spoke ëª¨ë¸ë¡œ êµ¬ì„±ë˜ë©°, ì—°ê²° ëœ ë„¤íŠ¸ì›Œí¬ë“¤ì€ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°í•  í•„ìš” ì—†ì´ AWS Transit Gatewayì—ë§Œ ì—°ê²°í•˜ë©´ ë˜ë¯€ë¡œ ê´€ë¦¬ë¥¼ í¬ê²Œ ê°„ì†Œí™”í•˜ê³  ìš´ì˜ ë¹„ìš©ì„ í¬ê²Œ ì¤„ì—¬ ì¤€ë‹¤.</li></ul><br><p><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby90cmFuc2l0LWdhdGV3YXkvZmVhdHVyZXMv">1.2 AWS Transit Gateway ì£¼ìš” ê¸°ëŠ¥<i class="fa fa-external-link-alt"></i></span></p><ul><li><p><em>ë¼ìš°íŒ…</em></p><p>  : ë™ì  / ì •ì ì˜ Layer 3 ë¼ìš°íŒ…ì„ ì§€ì›í•œë‹¤. </p></li><li><p><em>ì—£ì§€ ì—°ê²°</em></p><p>  : VPNì„ ì‚¬ìš©í•˜ì—¬ AWS Transit Gatewayì™€ ì˜¨í”„ë ˆë¯¸ìŠ¤ ê²Œì´íŠ¸ì›¨ì´ ê°„ì— VPN ì—°ê²°ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤.</p></li><li><p><em>VPC ê¸°ëŠ¥ ìƒí˜¸ ìš´ìš©ì„±</em></p><p>  : VPCì— ìˆëŠ” ì¸ìŠ¤í„´ìŠ¤ê°€ AWS Transit Gatewayì— ì—°ê²°ëœ ë‹¤ë¥¸ Amazon VPCì— ìˆëŠ” NAT ê²Œì´íŠ¸ì›¨ì´, Network Load Balancer, AWS PrivateLink ë° Amazon Elastic File System ë“±ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë‹¤.</p></li><li><p><em>ëª¨ë‹ˆí„°ë§</em></p><p>  : AWS Transit GatewayëŠ” Amazon CloudWatch ë° Amazon VPC íë¦„ ë¡œê·¸ì™€ ê°™ì€ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” í†µê³„ì™€ ë¡œê·¸ë¥¼ ì œê³µí•œë‹¤.</p></li><li><p><em>ë¦¬ì „ ê°„ VPC í”¼ì–´ë§</em></p><p>  : AWS Transit Gateway ë¦¬ì „ ê°„ VPC í”¼ì–´ë§ì€ AWS ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ì—¬ AWS ë¦¬ì „ì„ í†µí•´ íŠ¸ë˜í”½ì„ ë¼ìš°íŒ…í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•œë‹¤.</p></li><li><p><em>ë©€í‹°ìºìŠ¤íŠ¸</em></p><p>  : ê³ ê°ì´ í´ë¼ìš°ë“œì—ì„œ ë©€í‹°ìºìŠ¤íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‰½ê²Œ êµ¬ì¶•í•˜ê³  ìˆ˜ë°± ê°œì˜ ìˆ˜ì‹ ìê¹Œì§€ ë©€í‹°ìºìŠ¤íŠ¸ êµ¬ì„±ì„ ì‰½ê²Œ ëª¨ë‹ˆí„°ë§, ê´€ë¦¬ ë° í™•ì¥í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•œë‹¤. </p></li><li><p><em>ë³´ì•ˆ</em></p><p>  : AWS Transit GatewayëŠ” Identity and Access Management(IAM)ì™€ í†µí•©ë˜ë¯€ë¡œ, AWS Transit Gatewayì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.</p></li><li><p><em>ì§€í‘œ</em></p><p>  : ì„±ëŠ¥ê³¼ ì†¡ìˆ˜ì‹ ëœ ë°”ì´íŠ¸, íŒ¨í‚·, íê¸°ëœ íŒ¨í‚·ì„ ë¹„ë¡¯í•œ íŠ¸ë˜í”½ ì§€í‘œë¥¼ í†µí•´ ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ë¥¼ ëª¨ë‹ˆí„°ë§í•œë‹¤.</p></li></ul><br><p>1.3 Non Transit Gateway vs Transit Gateway</p><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled.png"></p><p>ê·¸ë¦¼ 1.1 Transit Gateway ë¯¸ì‚¬ìš© / ì‚¬ìš© ë¹„êµ Diagram</p><ul><li><p>ë‹¤ìˆ˜ì˜ VPC í™˜ê²½ì´ë‚˜ On-Premise í™˜ê²½ì— ëŒ€í•´ Transit Gatewayë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , VPC Peeringê³¼ VPN, Direct Connectë¥¼ í†µí•œ ê°œë³„ ì—°ê²°ì´ ì´ë£¨ì–´ì ¸ ë³µì¡í•œ ì‘ì—… í™˜ê²½</p></li><li><p>Transit Gatewayë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì—°ê²°ë§Œ í•˜ë©´ ë˜ì–´, ì¤‘ì•™ ì§‘ì¤‘í˜• ê°„ëµí•œ ì‘ì—… í™˜ê²½</p></li></ul><blockquote><p>ğŸ’¡ Transit Gatewayë¥¼ ì‚¬ìš©í•˜ë©´ ë³µì¡í•œ AWS ë„¤íŠ¸ì›Œí¬ ì•„í‚¤í…ì²˜ë¥¼ ê°„ì†Œí™” ê°€ëŠ¥í•˜ì—¬ ê´€ë¦¬ ë° ìš´ìš© íš¨ìœ¨ì´ ë³´ì¥ë˜ë©°, í–¥ìƒëœ ë³´ì•ˆê³¼ ë©€í‹°ìºìŠ¤íŠ¸ë¥¼ í™œìš©í•˜ì—¬ ìœ ìš©í•œ í†µì‹ ì´ ê°€ëŠ¥í•˜ë‹¤.</p></blockquote><br><p>1.4 AWS Transit Gateway Key Words</p><ul><li><p><em>Transit Gateway</em> - VPCë“¤ì˜ ì ‘ì ì´ ë˜ëŠ” ì¤‘ì•™ ì§‘ì¤‘í˜• ë‹¨ì¼ Gatewayë¡œ Hub &amp; Spoke í™˜ê²½ì—ì„œ Hub ì—­í• </p></li><li><p><em>Transit Gateway Attachment</em> - VPCë¥¼ ì—°ê²°í•˜ëŠ” ë°©ì‹ (í˜„ì¬ ë²„ì „ìœ¼ë¡œ 3ê°€ì§€ ë°©ì‹ ì§€ì›)</p><ul><li><p>VPC Attachment : TGWì™€ ë™ì¼ Region ë‚´ VPCë¥¼ ì§ì ‘ì ìœ¼ë¡œ ì—°ê²° (ë‹¤ë¥¸ ê³„ì •ì— ìƒì„±í•œ VPCë„ ì—°ê²° ê°€ëŠ¥)</p></li><li><p>VPN Attachment : TGWì™€ VPNë¥¼ ì—°ê²° (Site to Site VPN)</p></li><li><p>TGW Peering : TGWì™€ ë‹¤ë¥¸ Regionì˜ TGW ê°„ ì—°ê²° (Inter Region TGW Peering)</p></li></ul></li><li><p><em>Transit Gateway Routing Table</em> - TGWì—ì„œ ê´€ë¦¬í•˜ëŠ” ë¼ìš°íŒ… í…Œì´ë¸”</p></li><li><p><em>Transit Gateway Sharing</em> - TGWë¥¼ ê³µìœ í•˜ì—¬ ë‹¤ë¥¸ AWS ê³„ì •ì—ê²Œ ì „ë‹¬í•˜ì—¬ ì—°ê²° ê°€ëŠ¥ (Resource Access Manager í™œìš©)</p></li><li><p><em>Transit Gateway Multicast</em> - TGWë¥¼ í†µí•´ Multicast íŠ¸ë˜í”½ì„ ì „ë‹¬</p><ul><li><p>Multicast Domain : Multicast íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•  TGW ì§€ì •</p></li><li><p>Multicast Associate : Multicast íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•  TGW Attachment ì§€ì •</p></li><li><p>Multicast Group Source : Multicast Sender ëŒ€ìƒ ì§€ì •</p></li><li><p>Multicast Group Member : Multicast Reciever ëŒ€ìƒ ì§€ì •</p></li></ul></li><li><p><em>Transit Gateway Network Manager</em> - ë…¼ë¦¬ì  ë‹¤ì´ì–´ê·¸ë¨ ë˜ëŠ” ì§€ë¦¬ì  ë§µìœ¼ë¡œ ì¤‘ì•™ ëŒ€ì‹œ ë³´ë“œì—ì„œ ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ë¥¼ ì‹œê°í™”</p></li></ul><hr><br><h3 id="2-AWS-Transit-Gateway-Lab-Preview"><a href="#2-AWS-Transit-Gateway-Lab-Preview" class="headerlink" title="2. AWS Transit Gateway Lab Preview"></a>2. AWS Transit Gateway Lab Preview</h3><br><p>2.1 Lab Topology</p><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled1.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%201.png"></p><p>ê·¸ë¦¼ 2.1 AWS Transit Gateway Lab Topology</p><p>â‘  <em>TGW Intra Region VPC Attachment</em> - <code>ë²„ì§€ë‹ˆì•„</code>ì— MAIN SITE êµ¬ì¶• (ë™ì¼ ë¦¬ì „ ë‚´ VPCì™€ TGWë¥¼ ìƒì„±í•˜ì—¬ ì—°ê²°)</p><p>â‘¡ <em>Multicast on TGW</em> - <code>ë²„ì§€ë‹ˆì•„</code> MAIN SITEì—ì„œ Multicast í†µì‹  í…ŒìŠ¤íŠ¸</p><p>â‘¢ <em>TGW Multi Account VPC Attachment</em> - ë‹¤ë¥¸ ê³„ì •ì˜ <code>ë²„ì§€ë‹ˆì•„</code>ì— SUB SITE êµ¬ì¶• í›„ Resource Access Managerë¥¼ í†µí•´ TGWë¥¼ ê³µìœ í•˜ê³  ë‹¤ë¥¸ ê³„ì •ì˜ VPCì™€ ì—°ê²°</p><p>â‘£ <em>TGW Inter Region Peering</em> - <code>ì•„ì¼ëœë“œ</code> ì— BRANCH SITE êµ¬ì¶• í›„ TGW ê°„ í”¼ì–´ë§ ì—°ê²°</p><p>â‘¤ <em>TGW VPN Attachment</em> - <code>ì„œìš¸</code>ì— OpenSwan VPN ì„œë²„ë¥¼ ì„¤ì¹˜ í›„ TGWì™€ ì—°ê²°</p><p>â‘¥ <em>NATGW though TGW</em> - Private Subnet ì¤‘ DEV í™˜ê²½ì˜ ëŒ€ìƒìœ¼ë¡œ, TGWë¥¼ í†µí•´ <code>ë²„ì§€ë‹ˆì•„</code> MAIN SITEì˜ Egress VPCì— ì¡´ì¬í•˜ëŠ” NAT GWë¡œ ì¸í„°ë„· í†µì‹ </p><p>â‘¦ <em>TGW Network Manager</em> - TGW ë„¤íŠ¸ì›Œí¬ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ ì‹œê°í™”</p><br><p>2.2 AWS ê¸°ë³¸ ì„¤ì •</p><ul><li>ë³¸ ì‹¤ìŠµì—ì„œ í™œìš©í•  AWS Regionì€ <code>ë²„ì§€ë‹ˆì•„, ì•„ì¼ëœë“œ, ì„œìš¸</code> ì´ë‹¤. í•´ë‹¹ Regionì— ëŒ€í•œ <em>EC2-Key Pair</em>ë¥¼ ìƒì„±</li><li>TGW Multi Account VPC Attachment í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë³¸ ê³„ì • ì™¸ì— ì„œë¸Œ ê³„ì •ì´ í•„ìš”</li><li>ëª¨ë“  Regionì— ëŒ€í•œ ê¸°ë³¸ì ì¸ ì¸í”„ë¼ëŠ” <em>CloudFormation</em>ì— ì˜í•´ ìë™ êµ¬ì¶• (ëª¨ë“  ì¸í”„ë¼ê°€ êµ¬ì¶•ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.)</li><li>ìƒì„±ëœ ëª¨ë“  EC2-Instanceì˜ IP ì£¼ì†ŒëŠ” X.X.X.10ìœ¼ë¡œ ê³ ì •í•˜ì˜€ë‹¤. (ì˜ˆì‹œ: 10.1.1.10, 10.5.1.10 â€¦)</li></ul><br><p>2.3 CloudFormation (Infrastructure as Code)</p><p>â¤µ <span class="exturl" data-url="aHR0cHM6Ly9zMy5hcC1ub3J0aGVhc3QtMi5hbWF6b25hd3MuY29tL2Nsb3VkZm9ybWF0aW9uLmNsb3VkbmV0YS5uZXQvVEdXL1ZpcmdpbmlhX1RyYW5zaXRHV19MYWJfQ0YueWFtbA==">Download Virginia_TransitGW_Lab_CF.yaml<i class="fa fa-external-link-alt"></i></span></p><p>â¤µ <span class="exturl" data-url="aHR0cHM6Ly9zMy5hcC1ub3J0aGVhc3QtMi5hbWF6b25hd3MuY29tL2Nsb3VkZm9ybWF0aW9uLmNsb3VkbmV0YS5uZXQvVEdXL0lyZWxhbmRfVHJhbnNpdEdXX0xhYl9DRi55YW1s">Download Ireland_TransitGW_Lab_CF.yaml<i class="fa fa-external-link-alt"></i></span></p><p>â¤µ <span class="exturl" data-url="aHR0cHM6Ly9zMy5hcC1ub3J0aGVhc3QtMi5hbWF6b25hd3MuY29tL2Nsb3VkZm9ybWF0aW9uLmNsb3VkbmV0YS5uZXQvVEdXL1Nlb3VsX1RyYW5zaXRHV19MYWJfQ0YueWFtbA==">Download Seoul_TransitGW_Lab_CF.yaml<i class="fa fa-external-link-alt"></i></span></p><ul><li><code>ë²„ì§€ë‹ˆì•„, ì•„ì¼ëœë“œ, ì„œìš¸</code>ì— ë°°í¬í•  Cloud Formation í…œí”Œë¦¿ì´ë‹¤.</li><li>ì§€ê¸ˆ ë°”ë¡œ ë°°í¬í•˜ì§€ ì•Šê³ , ì‹¤ìŠµ ë‹¨ê³„ ë³„ë¡œ í•˜ë‚˜ì”© ë°°í¬í•  ê²ƒì´ë‹ˆ ì¼ë‹¨ ë‹¤ìš´ë¡œë“œë§Œ ë°›ì•„ ë‘ì.</li></ul><blockquote><p>ğŸ’¡ ë³¸ê²©ì ì¸ ì‹¤ìŠµì— ì•ì„œ, ë¦¬ì†ŒìŠ¤ ë‹¹ ì†ŒëŸ‰ì˜ ê³¼ê¸ˆì´ ë¶ˆê°€í”¼ í•˜ë‹¤.<br>ìì„¸í•œ ì‚¬í•­ì€ <span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby90cmFuc2l0LWdhdGV3YXkvcHJpY2luZy8=">Transit Gateway ìš”ê¸ˆ<i class="fa fa-external-link-alt"></i></span> ë§í¬ë¥¼ ì°¸ê³  ë°”ë€ë‹¤.</p></blockquote><hr><br><h3 id="3-AWS-Transit-Gateway-Intra-Region-VPC-Attachment-Test"><a href="#3-AWS-Transit-Gateway-Intra-Region-VPC-Attachment-Test" class="headerlink" title="3. AWS Transit Gateway Intra Region VPC Attachment Test"></a>3. AWS Transit Gateway Intra Region VPC Attachment Test</h3><ul><li><strong>ì´ ë²ˆ ë‹¨ê³„ì˜ ì‹¤ìŠµì€ ë™ì¼ ë¦¬ì „ì— ì¡´ì¬í•˜ëŠ” VPCì™€ TGW ê°„ì˜ ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•œë‹¤. (Intra Region VPC Attachment)</strong></li><li>ì‹¤ìŠµ í™˜ê²½: Region - <code>ë²„ì§€ë‹ˆì•„</code> , Account - ë³¸ AWS ê³„ì •</li></ul><br><p>3.1 ë²„ì§€ë‹ˆì•„ CloufFormation ë°°í¬</p><p>3.1.1) CloudFormation ë°°í¬</p><ul><li>2.3í•­ì—ì„œ ì œê³µí•œ Virginia_TransitGW_Lab_CF.yaml íŒŒì¼ì„ ë°°í¬í•˜ì.</li></ul><blockquote><p>ğŸ’¡ ì£¼ì˜: CF Conditionì— ì˜í•´ Main Siteì™€ Sub Siteì˜ ìƒì„± ì¸í”„ë¼ê°€ ë‹¤ë¥´ë‹¤. <strong>íŒŒë¼ë¯¸í„° ê°’ì„ Mainìœ¼ë¡œ ì§€ì •</strong>í•˜ì!</p></blockquote><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled2.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%202.png"></p><p>ê·¸ë¦¼ 3.1 ë²„ì§€ë‹ˆì•„ CF í…œí”Œë¦¿ ìƒì„± ì¤‘ EnvType íŒŒë¼ë¯¸í„° ê°’ì„ Mainìœ¼ë¡œ ì§€ì •</p><details><summary>ë²„ì§€ë‹ˆì•„ CF ìƒì„± ì¸í”„ë¼</summary><div markdown="1"><pre><code>- EC2-Instance 3ê°œ- VPC 2ê°œ, Public Subnet 1ê°œ, Private Subnet 2ê°œ, Routing Table 3ê°œ, IGW 1ê°œ- Security Group 2ê°œ</code></pre></div></details><ul><li>ìœ„ ìƒì„±ëœ ì¸í”„ë¼ê°€ ì •ìƒì ìœ¼ë¡œ ì˜¬ë¼ì™”ëŠ” ì§€ í™•ì¸í•˜ì.</li></ul><p>3.1.2) MAIN-MGT EC2 ì ‘ì†</p><ul><li>í˜„ì¬ ì ‘ì† ê°€ëŠ¥í•œ Public Subnetì— ìœ„ì¹˜í•œ MAIN-MGT EC2ì— SSH ì ‘ì†</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOT &gt;&gt; list.txt</span><br><span class="line">google.com</span><br><span class="line">10.1.1.10</span><br><span class="line">10.2.1.10</span><br><span class="line">10.2.2.10</span><br><span class="line">10.3.1.10</span><br><span class="line">10.3.2.10</span><br><span class="line">10.4.1.10</span><br><span class="line">10.5.1.10</span><br><span class="line">10.6.1.10</span><br><span class="line">EOT</span><br></pre></td></tr></table></figure><ul><li>list.txt íŒŒì¼ì„ ìƒì„±ì„ ìœ„í•´ ìœ„ ê°’ì„ ë¶™ì—¬ë„£ì (ë³¸ ì‹¤ìŠµì—ì„œ ìƒì„±ë  ëª¨ë“  EC2 IPì™€ êµ¬ê¸€ì£¼ì†Œ)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@MAIN-MGT ec2-user]<span class="comment"># vi pingall.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">cat list.txt |  <span class="keyword">while</span> <span class="built_in">read</span> output</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    ping -c 1 -W 1 <span class="string">"<span class="variable">$output</span>"</span> &gt; /dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"node <span class="variable">$output</span> is up"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"node <span class="variable">$output</span> is down"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@MAIN-MGT ec2-user]<span class="comment"># chmod +x pingall.sh</span></span><br></pre></td></tr></table></figure><ul><li><code>vi pingall.sh</code> ë¡œ ì§„ì…í•˜ì—¬ ìœ„ì™€ ê°™ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±í•œë‹¤.</li><li><code>chmod +x pingall.sh</code> ë¡œ ìŠ¤í¬ë¦½íŠ¸ ê¶Œí•œì„ ë¶€ì—¬í•œë‹¤.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@MAIN-MGT ec2-user]<span class="comment"># ./pingall.sh</span></span><br><span class="line">node google.com is up</span><br><span class="line">node 10.1.1.10 is up</span><br><span class="line">node 10.2.1.10 is down</span><br><span class="line">node 10.2.2.10 is down</span><br><span class="line">node 10.3.1.10 is down</span><br><span class="line">node 10.3.2.10 is down</span><br><span class="line">node 10.4.1.10 is down</span><br><span class="line">node 10.5.1.10 is down</span><br><span class="line">node 10.6.1.10 is down</span><br><span class="line">[root@MAIN-MGT ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li><code>./pingall.sh</code> ë¡œ ì „ì²´ íƒ€ê²Ÿì— ëŒ€í•œ Ping í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.</li><li>í˜„ì¬ ìê¸° ìì‹ ê³¼ ì™¸ë¶€ ì¸í„°ë„·ë§Œ ê°€ëŠ¥í•˜ë‹¤.</li></ul><br><p>3.2 Transit Gatewaay ìƒì„±</p><ul><li>VPC  â€”&gt; Transit Gateway â€”&gt; Create Transit Gateway</li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled3.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%203.png"><br>ê·¸ë¦¼ 3.2 Create Transit Gateway</p><ul><li>Name Tag ê¸°ì…í•˜ê³ , Multicast support enableì„ ë°˜ë“œì‹œ ì²´í¬ í•˜ì! (4ì¥ Multicast on TGW ì‹¤ìŠµ ë•Œ í•„ìš”í•˜ë‹¤. ì¶”í›„ ìˆ˜ì •ì´ ë˜ì§€ ì•Šì•„ ë¯¸ë¦¬ í™œì„±í™”)</li><li>1~2ë¶„ ì •ë„ ëŒ€ê¸°í•˜ë©´, ìƒíƒœê°€ available ë¡œ ë³€ê²½ ëœë‹¤.</li></ul><br><p>3.3 Transit Gateway Attachment ìƒì„±</p><ul><li><p>VPC â€”&gt; Transit Gateway Attachment â€”&gt; Create Transit Gateway Attachment (ğŸ˜“ êµ³ì´ í•œê¸€ ë²ˆì—­ì„ í•´ë†”ì„œ Attachmentë¥¼ ì²¨ë¶€íŒŒì¼ë¡œ í‘œí˜„í•¨;)</p><ul><li><p>Transit Gateway ID ì§€ì •</p></li><li><p>Attachment Type : VPC</p></li><li><p>Attachment Name Tag : MAIN-VPC01-ATT</p></li><li><p>VPC ID : VPC01 â€”&gt; AZ &amp; Subnet ì§€ì •</p></li></ul><hr><ul><li><p><em>ìƒë™</em></p></li><li><p>Attachment Name Tag : MAIN-VPC02-ATT</p></li><li><p>VPC ID : VPC02 â€”&gt; AZ &amp; Subnet ì§€ì •</p></li></ul></li><li><p>Transit Gateway Attachment ë¥¼ 2ê°œ ìƒì„± í•œë‹¤. (1~2ë¶„ ì •ë„ ëŒ€ê¸°)</p></li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled4.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%204.png"><br>ê·¸ë¦¼ 3.3 TGW Attachment ì •ë³´ í™•ì¸</p><ul><li>ìƒì„±ëœ 2ê°œì˜ TGW Attachmentë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤. (Resource Type: VPC, State: available)</li></ul><br><p>3.4 Routing Table ì„¤ì •</p><ul><li><p>CloudFormationì— ì˜í•´ ìƒì„±ëœ 3ê°œì˜ ë¼ìš°íŒ… í…Œì´ë¸”ì— ê²½ë¡œë¥¼ ì¶”ê°€í•œë‹¤.</p><ul><li>ë¼ìš°íŒ… í¸ì§‘ â€”&gt; ë¼ìš°íŒ… ì¶”ê°€ â€”&gt; 10.0.0.0/8 ëŒ€ì—­, tgw-xxxx íƒ€ê²Ÿ</li></ul></li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled5.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%205.png"></p><p>ê·¸ë¦¼ 3.4 ë¼ìš°íŒ… í…Œì´ë¸” í¸ì§‘ (10.0.0.0/8 ëŒ€ì—­ì„ TGWë¡œ ì „ë‹¬í•˜ëŠ” ê²½ë¡œ ì¶”ê°€)</p><ul><li>ë¼ìš°íŒ… í…Œì´ë¸” 3ê°œ ëª¨ë‘ ë¼ìš°íŒ… ì •ì±… ì¶”ê°€</li></ul><br><p>3.5 Verify</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@MAIN-MGT ec2-user]<span class="comment"># ./pingall.sh</span></span><br><span class="line">node google.com is up</span><br><span class="line">node 10.1.1.10 is up</span><br><span class="line">node 10.2.1.10 is up</span><br><span class="line">node 10.2.2.10 is up</span><br><span class="line">node 10.3.1.10 is down</span><br><span class="line">node 10.3.2.10 is down</span><br><span class="line">node 10.4.1.10 is down</span><br><span class="line">node 10.5.1.10 is down</span><br><span class="line">node 10.6.1.10 is down</span><br><span class="line">[root@MAIN-MGT ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>MAIN-MGT EC2ì— ì ‘ì†í•˜ì—¬ <code>pingall.sh</code> ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆ˜í–‰í•œë‹¤.</li><li><code>ë²„ì§€ë‹ˆì•„</code> MAINì— ì¡´ì¬í•˜ëŠ” EC2 ë¼ë¦¬ í†µì‹ ì´ ê°€ëŠ¥í•˜ë‹¤.</li></ul><details><summary><b>3ì¥ í˜„ì¬ê¹Œì§€ ì™„ë£Œëœ êµ¬ì„±ë„ í™•ì¸</summary></b><div markdown="1"><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled6.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%206.png"></p></div></details><hr><br><h3 id="4-Multicast-on-Transit-Gateway-Test"><a href="#4-Multicast-on-Transit-Gateway-Test" class="headerlink" title="4. Multicast on Transit Gateway Test"></a>4. Multicast on Transit Gateway Test</h3><ul><li><strong>ì´ ë²ˆ ë‹¨ê³„ì˜ ì‹¤ìŠµì€ TGWì„ í†µí•´ Multicast í†µì‹ ì„ í…ŒìŠ¤íŠ¸í•œë‹¤. (Multicast on Transit Gateway)</strong></li><li>MAIN-MGT ì¸ìŠ¤í„´ìŠ¤ë¥¼ Multicast Senderë¡œ í•˜ê³ , MAIN-TESTì™€ MAIN-DEV ì¸ìŠ¤í„´ìŠ¤ë¥¼ Multicast Receiverë¡œ í•œë‹¤.</li><li>Multicast íŠ¸ë˜í”½ì˜ UDP í¬íŠ¸ ë²ˆí˜¸ì— ëŒ€í•´ Security Groupì—ì„œ í—ˆìš©í•´ì•¼ í•œë‹¤. (CFë¡œ ë¯¸ë¦¬ ì„¤ì •í•´ ë†ˆ)</li><li>ì‹¤ìŠµ í™˜ê²½: Region - <code>ë²„ì§€ë‹ˆì•„</code> , Account - ë³¸ AWS ê³„ì •</li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL3ZwYy9sYXRlc3QvdGd3L3Rndy1tdWx0aWNhc3Qtb3ZlcnZpZXcuaHRtbA==">Multicast on transit gateways<i class="fa fa-external-link-alt"></i></span></p><p>ì°¸ê³  ë§í¬ : Multicast on transit gateway</p><p><em>Multicast ì‹¤ìŠµì— ì•ì„œ ê³ ë ¤ ì‚¬í•­</em></p><ul><li>í˜„ì¬ Multicast ë¼ìš°íŒ… ê¸°ëŠ¥ì€ <code>ë²„ì§€ë‹ˆì•„</code> ë¦¬ì „ì—ì„œë§Œ ì§€ì›í•˜ê³  ìˆë‹¤.</li><li>í•´ë‹¹ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ TGWë¥¼ ìƒì„±í•  ë•Œ Multicast Supportë¥¼ í™œì„±í•´ì•¼ í•œë‹¤. (ì´ë¯¸ í™œì„±í™” í•¨)</li><li>IGMPëŠ” ë¯¸ì§€ì›ìœ¼ë¡œ TGWì—ì„œ Multicast Domainê³¼ Sender / Receiverë¥¼ ê´€ë¦¬í•˜ì—¬ ë¼ìš°íŒ… ëœë‹¤.</li><li>EC2 ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…ì´ Nitro ì—¬ì•¼ Senderê°€ ë  ìˆ˜ ìˆê³ , Non Nitroê°€ Receicerê°€ ë  ìˆ˜ ìˆì§€ë§Œ Source/Destination Checkë¥¼ ë¹„í™œì„±í™”í•´ì•¼ ë™ì‘í•œë‹¤.</li><li>ë³¸ ì‹¤ìŠµì—ì„œ CloudFormationìœ¼ë¡œ ìƒì„±í•œ EC2 ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…ì€ Nitro íƒ€ì…ìœ¼ë¡œ ì§€ì •í•˜ì˜€ë‹¤.</li></ul><br><p>4.1 Multicast ë¼ìš°íŒ… ì„¤ì • ì „ì— í…ŒìŠ¤íŠ¸</p><p>4.1.1) MAIN-MGT ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì† (Sender)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@MAIN-MGT ec2-user]<span class="comment"># omping -m 239.1.1.1 -p 10000 10.1.1.10</span></span><br><span class="line">10.1.1.10 : waiting <span class="keyword">for</span> response msg</span><br><span class="line">10.1.1.10 : joined (S,G) = (*, 239.1.1.1), pinging</span><br><span class="line">10.1.1.10 :   unicast, seq=1, size=69 bytes, dist=0, time=0.016ms</span><br><span class="line">10.1.1.10 : multicast, seq=1, size=69 bytes, dist=0, time=0.021ms</span><br><span class="line">10.1.1.10 :   unicast, seq=2, size=69 bytes, dist=0, time=0.041ms</span><br><span class="line">10.1.1.10 : multicast, seq=2, size=69 bytes, dist=0, time=0.046ms</span><br><span class="line">10.1.1.10 :   unicast, seq=3, size=69 bytes, dist=0, time=0.050ms</span><br></pre></td></tr></table></figure><ul><li><code>omping -m 239.1.1.1 -p 10000 10.1.1.10</code> ëª…ë ¹ì–´ë¡œ Multicast íŠ¸ë˜í”½ì„ ë°œìƒ ì‹œí‚¨ë‹¤.</li><li>Multicast IP ëŒ€ì—­ : 239.1.1.1 , Port ë²ˆí˜¸ : UDP 10000</li></ul><p>4.1.2) MAIN-TEST, MAIN-DEV ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì† (Receiver)</p><ul><li>MAIN-TEST, MAIN-DEVì€ Private Subnetì— ìœ„ì¹˜í•˜ì—¬ ë‹¤ì´ë ‰íŠ¸ë¡œ SSH ì ‘ê·¼ì´ ë¶ˆê°€í•˜ë‹¤.</li><li>MAIN-MGTì— ì ‘ê·¼ í›„ <code>ssh root@10.2.1.10</code>ê³¼ <code>ssh root@10.2.2.10</code> ëª…ë ¹ì–´ë¡œ ê±°ì³ì„œ ì ‘ê·¼í•œë‹¤.</li><li>Key-Pair ì—†ì´ Root ê³„ì •ìœ¼ë¡œ ì ‘ê·¼í•˜ë©°, íŒ¨ìŠ¤ì›Œë“œëŠ” qwe123 ì´ë‹¤.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@MAIN-MGT ~]$ ssh root@10.2.1.10</span><br><span class="line">:</span><br><span class="line">password:</span><br><span class="line">:</span><br><span class="line">[root@MAIN-TEST ~]<span class="comment">#</span></span><br><span class="line">[root@MAIN-TEST ~]<span class="comment"># tcpdump ip dst 239.1.1.1 -nn</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br></pre></td></tr></table></figure><ul><li><code>tcpdump ip dst 239.1.1.1 -nn</code> ëª…ë ¹ì–´ë¡œ ëª©ì ì§€ IPê°€ 239.1.1.1ì¸ íŒ¨í‚·ì„ ì¡ì•„ ì¶œë ¥í•œë‹¤.</li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled7.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%207.png"></p><p>ê·¸ë¦¼ 4.1 Multicast ë¼ìš°íŒ… ì„¤ì • ì „ í…ŒìŠ¤íŠ¸</p><ul><li>ì¢Œì¸¡ Multicast Senderì—ì„œ 239.1.1.1 íŠ¸ë˜í”½ì„ ë°œìƒí•˜ê³  ìˆì§€ë§Œ, ìš°ì¸¡ Multicast Receiverë“¤ë¡œ ì¸ì…ë˜ì§€ ì•ŠëŠ”ë‹¤.</li></ul><br><p>4.2 Transit Gateway Multicast ì„¤ì •</p><p>4.2.1) Create Transit Gateway Multicast Domain</p><ul><li><p>VPC â€”&gt; Transit Gateway Multicast â€”&gt; Create Transit Gateway Multicast Domain</p><ul><li>Transit Gateway ID ì§€ì •</li></ul></li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled8.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%208.png"><br>ê·¸ë¦¼ 4.2 Transit Gateway Multicast Domain í™•ì¸</p><p>4.2.2) Create Association</p><ul><li><p>VPC â€”&gt; Transit Gateway Multicast â€”&gt; ì‘ì—… â€”&gt; Create Association</p><ul><li><p>Choose attachment to associate : MAIN-VPC01-ATT</p></li><li><p>Choose Subnets to associate : Subnet ì„ íƒ</p></li></ul><hr><ul><li><p>Choose attachment to associate : MAIN-VPC02-ATT</p></li><li><p>Choose Subnets to associate : Subnet ì„ íƒ</p></li></ul></li><li><p>3ì¥ì—ì„œ ìƒì„±í•œ 2ê°œì˜ TGW Attachmentë¥¼ ì„ íƒí•œ í›„ Subnetì„ ì§€ì •í•œë‹¤. (TGW-VPC01-ATT, TGW-VPC02-ATT)</p></li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled9.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%209.png"></p><p>ê·¸ë¦¼ 4.3 TGW Multicast Domainì˜ Assoiciate ì •ë³´ &amp; ì§€ì •ëœ Subnet í™•ì¸</p><p>4.2.3) Add group sources</p><ul><li><p>VPC â€”&gt; Transit Gateway Multicast â€”&gt; ì‘ì—… â€”&gt; Add group sources</p><ul><li><p>Group IP Address : 239.1.1.1</p></li><li><p>Choose network interfaces : MAIN-MGT ì§€ì •</p></li></ul></li><li><p>EC2 ì¸ìŠ¤í„´ìŠ¤ MAIN-MGT ì§€ì •ì„ í•  ë•Œ êµ¬ë¶„ì´ í˜ë“¤ë‹¤. (ì„¤ì • ì „ì— MAIN-MGTì— ëŒ€í•œ ì •ë³´ë¥¼ í™•ì¸ í›„ ì§€ì •í•˜ì)</p></li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled10.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2010.png"></p><p>ê·¸ë¦¼ 4.4 Group Source í™•ì¸</p><ul><li>Groups íƒ­ì— ì§„ì…í•˜ë©´ ëŒ€ìƒ ë³„ Sourceì™€ Member í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤. (MAIN-MGTë¥¼ source ë¡œ ì§€ì •)</li></ul><p>4.2.4) Add group members</p><ul><li><p>VPC â€”&gt; Transit Gateway Multicast â€”&gt; ì‘ì—… â€”&gt; Add group members</p><ul><li><p>Group IP Address : 239.1.1.1</p></li><li><p>Choose network interfaces : MAIN-TESTì™€ MAIN-DEV ì§€ì •</p></li></ul></li><li><p>ë§ˆì°¬ê°€ì§€ë¡œ ëŒ€ìƒ êµ¬ë¶„ì´ í˜ë“¤ì–´ ë¯¸ë¦¬ í™•ì¸ í›„ 2ê°œì˜ ëŒ€ìƒ ì§€ì •í•œë‹¤.</p></li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled11.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2011.png"></p><p>ê·¸ë¦¼ 4.5 Group Member í™•ì¸</p><ul><li>MAIN-TESTì™€ MAIN-DEVë¥¼ member ë¡œ ì§€ì •</li></ul><br><p>4.3 Verify</p><ul><li>4.1.2í•­ê³¼ ê°™ì´ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³¸ë‹¤.</li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled12.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2012.png"></p><p>ê·¸ë¦¼ 4.6 Multicast on Transit Gateway í…ŒìŠ¤íŠ¸ ê²°ê³¼</p><ul><li>MAIN-MGT (Multicast Sender)ì—ì„œ ë°œìƒí•˜ëŠ” 239.1.1.1 Multicast íŠ¸ë˜í”½ì€ MAIN-TESTì™€ MAIN-DEV (Multicast Receiver)ë¡œ ì¸ì…ëœë‹¤.</li><li>ì¦‰, TGWê°€ Multicast Groupì„ ê´€ë¦¬í•˜ì—¬ ë¼ìš°íŒ…í•˜ì—¬ Source ì •ë³´ë¥¼ Memberì—ê²Œ ì „ë‹¬í•´ ì¤€ë‹¤.</li><li>TGWì—ì„œ Multicast ì„¤ì •ì„ í•˜ë©´ ë°”ë¡œ ì ìš©ë˜ì§€ ì•Šê³  1~2ë¶„ì •ë„ ëŒ€ê¸° ì‹œê°„ì´ í•„ìš”í•˜ë‹¤.</li></ul><blockquote><p>ğŸ’¡ í˜„ì¬ Transit Gateway ìƒì—ì„œ ë™ì‘í•˜ëŠ” MulticastëŠ” ë¯¸ì™„ì„± ì„œë¹„ìŠ¤ì´ë©°, ë²„ì§€ë‹ˆì•„ ë¦¬ì „ì—ë§Œ ë™ì‘í•˜ëŠ” ì œì•½ì´ ìˆë‹¤. í–¥í›„ ë‹¤ë¥¸ ë¦¬ì „ê¹Œì§€ ì„œë¹„ìŠ¤ê°€ ë™ì‘í•˜ê±°ë‚˜ ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ë©´, ì¶”ê°€ì ì¸ ì‹¤ìŠµì„ ì§„í–‰í•  ì˜ˆì •ì´ë‹¤.<br>ê·¸ë¦¬ê³ , í˜„ì¬ ì‹¤ìŠµ ìƒ Multicast ë™ì‘ì€ ê°•ì œë¡œ íŠ¸ë˜í”½ì„ ì¸ì…í•˜ëŠ” í˜•íƒœì˜ ì‹¤ìŠµì´ë¼ ì¶”í›„ ê¸°íšŒê°€ ë˜ë©´ ì‹¤ì œ Multicast Stramì„ í†µí•´ ì‹¤ìŠµì„ ì§„í–‰í•´ ë³´ë„ë¡ í•˜ê² ë‹¤.</p></blockquote><hr><br><h3 id="5-AWS-Transit-Gateway-Multi-Account-VPC-Attachment-Test"><a href="#5-AWS-Transit-Gateway-Multi-Account-VPC-Attachment-Test" class="headerlink" title="5. AWS Transit Gateway Multi Account VPC Attachment Test"></a>5. AWS Transit Gateway Multi Account VPC Attachment Test</h3><ul><li><strong>ì´ ë²ˆ ë‹¨ê³„ì˜ ì‹¤ìŠµì€ TGWì„ ì •ë³´ë¥¼ ë‹¤ë¥¸ ê³„ì •ìœ¼ë¡œ ê³µìœ í•˜ì—¬ VPC ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•œë‹¤. (Multi Account VPC Attachment)</strong></li><li>ì´ ë²ˆ ë‹¨ê³„ì—ì„œëŠ” ì„œë¸Œ AWS ê³„ì •ì´ í•„ìš”í•˜ë‹¤. (<code>ë²„ì§€ë‹ˆì•„</code> ë¦¬ì „ì—ì„œ í…ŒìŠ¤íŠ¸í•˜ë©°, CF ë°°í¬ ì „ì— Key-Pairë¥¼ ë¯¸ë¦¬ ìƒì„±í•´ ë‘ì)</li><li>ë™ì¼í•œ ë¸Œë¼ìš°ì €ì—ì„œ ë¡œê·¸ì¸ ì‹œ ê¸°ì¡´ ê³„ì •ì€ ë¡œê·¸ì•„ì›ƒì´ ëœë‹¤. ë‹¤ë¥¸ ë¸Œë¼ìš°ì € ì¶”ê°€í•˜ì—¬ ì‹¤ìŠµí•˜ë©´ ë³¸ ê³„ì •ê³¼ ì„œë¸Œ ê³„ì •ì„ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</li><li>ì‹¤ìŠµ í™˜ê²½: Region - <code>ë²„ì§€ë‹ˆì•„</code> , Account - ë³¸ AWS ê³„ì • + ì„œë¸Œ AWS ê³„ì •</li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9ibG9ncy9rb3JlYS9uZXctdXNlLWFuLWF3cy10cmFuc2l0LWdhdGV3YXktdG8tc2ltcGxpZnkteW91ci1uZXR3b3JrLWFyY2hpdGVjdHVyZS8=">AWS Transit Gateway ì¶œì‹œ - VPC ë„¤íŠ¸ì›Œí¬ ì•„í‚¤í…ì²˜ ë‹¨ìˆœí™” ê°€ëŠ¥ (ì„œìš¸ ë¦¬ì „ í¬í•¨) | Amazon Web Services<i class="fa fa-external-link-alt"></i></span></p><p>ì°¸ê³  ë§í¬ : Resource Access Managerë¥¼ í™œìš©í•˜ì—¬ Multi Account VPC Attachment</p><br><p>5.1 ë²„ì§€ë‹ˆì•„ CloufFormation ë°°í¬ (ì„œë¸Œ ê³„ì •)</p><p>5.1.1) CloudFormation ë°°í¬</p><ul><li>2.3í•­ì—ì„œ ì œê³µí•œ Virginia_TransitGW_Lab_CF.yaml íŒŒì¼ì„ ë°°í¬í•˜ì.</li></ul><blockquote><p>ğŸ’¡ ì£¼ì˜: CF Conditionì— ì˜í•´ Main Siteì™€ Sub Siteì˜ ìƒì„± ì¸í”„ë¼ê°€ ë‹¤ë¥´ë‹¤. <strong>íŒŒë¼ë¯¸í„° ê°’ì„ Subë¡œ ì§€ì •</strong>í•˜ì!</p></blockquote><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled13.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2013.png"></p><p>ê·¸ë¦¼ 5.1 ì„œë¸Œ ê³„ì •ì—ì„œ ë²„ì§€ë‹ˆì•„ CF í…œí”Œë¦¿ ìƒì„± ì¤‘ EnvType íŒŒë¼ë¯¸í„° ê°’ì„ Subë¡œ ì§€ì •</p><ul><li>ì„œë¸Œ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ í›„ <code>ë²„ì§€ë‹ˆì•„</code>ì—ì„œ CloudFormation í…œí”Œë¦¿ì„ ì‹¤í–‰í•œë‹¤.</li><li>EnvTypeì€ Subë¡œ ì§€ì •í•˜ì!!</li></ul><details><summary>ë²„ì§€ë‹ˆì•„ CF ìƒì„± ì¸í”„ë¼ (ì„œë¸Œ ê³„ì •)</summary><div markdown="1"><pre><code>- EC2-Instance 2ê°œ- VPC 1ê°œ, Private Subnet 2ê°œ, Routing Table 2ê°œ- Security Group 1ê°œ</code></pre></div></details><ul><li>ìœ„ ìƒì„±ëœ ì¸í”„ë¼ê°€ ì •ìƒì ìœ¼ë¡œ ì˜¬ë¼ì™”ëŠ” ì§€ í™•ì¸í•˜ì</li></ul><br><p>5.2 Resource Access Managerë¥¼ í™œìš©í•˜ì—¬ TGW ê³µìœ  (ë³¸ ê³„ì • &amp; ì„œë¸Œ ê³„ì •)</p><p>5.2.1) Resource Access Manager ë¦¬ì†ŒìŠ¤ ê³µìœ  ìƒì„± (ë³¸ ê³„ì •)</p><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled14.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2014.png"></p><p>ê·¸ë¦¼ 5.2 ë³¸ ê³„ì •ì—ì„œ Resource Access Manager ì§„ì…</p><ul><li><p>Resource Access Manager â€”&gt; ë¦¬ì†ŒìŠ¤ ê³µìœ  ìƒì„±</p><ul><li><p>ì´ë¦„ : CloudNeta-TGW-Sharing</p></li><li><p>ë¦¬ì†ŒìŠ¤ ìœ í˜• ì„ íƒ : ì „ì†¡ ê²Œì´íŠ¸ì›¨ì´ â€”&gt; MAIN SITEì— ìƒì„±í•œ TGW ì§€ì •</p></li><li><p>í”„ë¦°ì‹œí„ AWS ê³„ì • ë²ˆí˜¸ â€”&gt; ì„œë¸Œ AWS ê³„ì • ë²ˆí˜¸ ì…ë ¥</p></li></ul></li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled15.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2015.png"></p><p>ê·¸ë¦¼ 5.3 ì„œë¸Œ ê³„ì •ì—ì„œ ë‚´ ë³´ì•ˆ ìê²© ì¦ëª…ì— ì§„ì…í•˜ì—¬ AWS ê³„ì • ID í™•ì¸</p><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled16.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2016.png"></p><p>ê·¸ë¦¼ 5.4 ë¦¬ì†ŒìŠ¤ ê³µìœ  ì„¤ì • í™”ë©´</p><p>5.2.2) Resource Access Manager ë¦¬ì†ŒìŠ¤ ê³µìœ  ìˆ˜ë½ (ì„œë¸Œ ê³„ì •)</p><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled17.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2017.png"></p><p>ê·¸ë¦¼ 5.5 ì„œë¸Œ ê³„ì •ì—ì„œ RAMì— ì§„ì…í•˜ì—¬ ë¦¬ì†ŒìŠ¤ ê³µìœ  ì´ˆëŒ€ í™•ì¸</p><ul><li>ë³¸ ê³„ì •ì—ì„œ ê³µìœ í•œ TGWë¥¼ ì„ íƒ í›„ ë¦¬ì†ŒìŠ¤ ê³µìœ  ìˆ˜ë½</li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled18.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2018.png"></p><p>ê·¸ë¦¼ 5.6 ì„œë¸Œ ê³„ì •ì—ì„œ ê³µìœ  ë¦¬ì†ŒìŠ¤ í™•ì¸</p><ul><li>ê³µìœ  ë¦¬ì†ŒìŠ¤ ë©”ë‰´ë¡œ ì ‘ê·¼í•˜ì—¬ ê³µìœ ëœ TGW ì •ë³´ í™•ì¸</li></ul><p>5.2.3) Multi Account VPC Attachment (ë³¸ ê³„ì • / ì„œë¸Œ ê³„ì •)</p><ul><li><p>VPC â€”&gt; Transit Gatewayë¡œ ì§„ì…í•˜ë©´ ê³µìœ  ë°›ì€ TGW ì •ë³´ í™•ì¸ (ì„œë¸Œ ê³„ì •)</p></li><li><p>VPC â€”&gt; Transit Gateway Attachment (ì„œë¸Œ ê³„ì •)</p><ul><li><p>Transit Gateway ID : ì§€ì •</p></li><li><p>Attachment Type : VPC</p></li><li><p>Attachment Name Tag : SUB-VPC03-ATT</p></li><li><p>VPC ID : MAIN-A â€”&gt; AZ &amp; Subnet ì§€ì •</p></li></ul></li><li><p>VPC â€”&gt; Transit Gateway Attachment â€”&gt; ì‘ì—… â€”&gt; Accept (ë³¸ ê³„ì •)</p></li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled19.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2019.png"></p><p>ê·¸ë¦¼ 5.7 ì„œë¸Œ ê³„ì •ì—ì„œ TGW Attachment ìƒíƒœ í™•ì¸</p><ul><li>ì„œë¸Œ ê³„ì •ì—ì„œ TGW VPC Attachmentë¥¼ ìˆ˜í–‰í•´ë„ ë°”ë¡œ ì—°ê²°ì´ ë˜ì§€ ì•Šê³  pending acceptance ìƒíƒœì´ë‹¤.</li><li>ë³¸ ê³„ì •ì— ì§„ì…í•˜ì—¬ Accept í•´ì¤€ë‹¤. (1~2ë¶„ í›„ ì„±ê³µ)</li></ul><br><p>5.3 Routing Table ì„¤ì • (ì„œë¸Œ ê³„ì •)</p><ul><li><p>CloudFormationì— ì˜í•´ ìƒì„±ëœ 2ê°œì˜ ë¼ìš°íŒ… í…Œì´ë¸”ì— ê²½ë¡œë¥¼ ì¶”ê°€í•œë‹¤.</p><ul><li>ë¼ìš°íŒ… í¸ì§‘ â€”&gt; ë¼ìš°íŒ… ì¶”ê°€ â€”&gt; 10.0.0.0/8 ëŒ€ì—­, tgw-xxxx íƒ€ê²Ÿ</li></ul></li></ul><br><p>5.4 Verify</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@MAIN-MGT ec2-user]<span class="comment"># ./pingall.sh</span></span><br><span class="line">node google.com is up</span><br><span class="line">node 10.1.1.10 is up</span><br><span class="line">node 10.2.1.10 is up</span><br><span class="line">node 10.2.2.10 is up</span><br><span class="line">node 10.3.1.10 is up</span><br><span class="line">node 10.3.2.10 is up</span><br><span class="line">node 10.4.1.10 is down</span><br><span class="line">node 10.5.1.10 is down</span><br><span class="line">node 10.6.1.10 is down</span><br><span class="line">[root@MAIN-MGT ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>MAIN-MGT EC2ì— ì ‘ì†í•˜ì—¬ <code>pingall.sh</code> ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆ˜í–‰í•œë‹¤.</li><li><code>ë²„ì§€ë‹ˆì•„</code> MAINê³¼ SUB SITEì— ì¡´ì¬í•˜ëŠ” EC2 ë¼ë¦¬ í†µì‹ ì´ ê°€ëŠ¥í•˜ë‹¤.</li></ul><details><summary><b>5ì¥ í˜„ì¬ê¹Œì§€ ì™„ë£Œëœ êµ¬ì„±ë„ í™•ì¸</summary></summary></b><div markdown="1"><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled20.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2020.png"></p></div></details><hr><br><h3 id="6-AWS-Transit-Gateway-Inter-Region-Peering-Test"><a href="#6-AWS-Transit-Gateway-Inter-Region-Peering-Test" class="headerlink" title="6. AWS Transit Gateway Inter Region Peering Test"></a>6. AWS Transit Gateway Inter Region Peering Test</h3><ul><li><strong>ì´ ë²ˆ ë‹¨ê³„ì˜ ì‹¤ìŠµì€ MAIN SITE TGWì™€ ë‹¤ë¥¸ ë¦¬ì „ì— ìˆëŠ” BRANCH SITE TGWë¥¼ ì—°ê²°í•˜ì—¬  í…ŒìŠ¤íŠ¸í•œë‹¤. (Inter Region Peering TGW Attachment)</strong></li><li>ì°¸ê³ ë¡œ Inter-Regional-Peeringì€ <code>ë²„ì§€ë‹ˆì•„, ì˜¤í•˜ì´ì˜¤, ì˜¤ë ˆê³¤, ì•„ì¼ëœë“œ, í”„ë‘í¬í‘¸ë¥´íŠ¸</code> ë¦¬ì „ ì—ì„œë§Œ ì§€ì›í•œë‹¤.</li><li>ì‹¤ìŠµ í™˜ê²½: Region - <code>ì•„ì¼ëœë“œ</code> , Account - ë³¸ AWS ê³„ì •</li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9ibG9ncy9hd3MvYXdzLXRyYW5zaXQtZ2F0ZXdheS1hZGRzLW11bHRpY2FzdC1hbmQtaW50ZXItcmVnaW9uYWwtcGVlcmluZy8=">AWS Transit Gateway Adds Multicast and Inter-Regional Peering | Amazon Web Services<i class="fa fa-external-link-alt"></i></span></p><p>ì°¸ê³  ë§í¬ : AWS Transit Gateway Adds Multicast &amp; Inter Regional Peering</p><br><p>6.1 ì•„ì¼ëœë“œ CloufFormation ë°°í¬</p><p>6.1.1) CloudFormation ë°°í¬</p><ul><li>2.3í•­ì—ì„œ ì œê³µí•œ Ireland_TransitGW_Lab_CF.yaml íŒŒì¼ì„ ë°°í¬í•˜ì.</li></ul><details><summary>ì•„ì¼ëœë“œ CF ìƒì„± ì¸í”„ë¼</summary><div markdown="1"><pre><code>- EC2-Instance 2ê°œ- VPC 2ê°œ, Public Subnet 1ê°œ, Private Subnet 1ê°œ, Routing Table 2ê°œ, IGW 1ê°œ- Security Group 2ê°œ- Transit Gateway 1ê°œ, Transit Gateway Attachment 2ê°œ</code></pre></div></details><ul><li>ìœ„ ìƒì„±ëœ ì¸í”„ë¼ê°€ ì •ìƒì ìœ¼ë¡œ ì˜¬ë¼ì™”ëŠ” ì§€ í™•ì¸í•˜ì</li><li>ì•„ì¼ëœë“œì—ì„œ ì‚¬ìš©í•  ì¸í”„ë¼ë¥¼ CloudFormationì—ì„œ ëª¨ë‘ ì •ì˜í•˜ì˜€ë‹¤. (TGWê¹Œì§€ í¬í•¨)</li><li>Routing Table ì¶”ê°€ëŠ” ì •ì˜í•˜ì§€ ì•Šì•„ ìˆ˜ë™ìœ¼ë¡œ ì‘ì—… (ğŸ¤¢TGW ìƒì„± ë° Attachment ë˜ëŠ” ë”œë ˆì´ê°€ ë°œìƒí•˜ì—¬ ê²½ë¡œ ì„¤ì •ì„ ëª»í•˜ê³  íƒ€ì„ ì•„ì›ƒ)</li></ul><br><p>6.2 Inter Region Peering ì„¤ì •</p><p>6.2.1) TGW Attachment - Inter Region Peering </p><ul><li><p>VPC â€”&gt; Transit Gateway Attachment â€”&gt; Create Transit Gateway Attachment (<code>ì•„ì¼ëœë“œ</code>)</p><ul><li><p>Transit Gateway ID : BRC-TGW ëŒ€ìƒ ì§€ì •</p></li><li><p>Attachment Type : Peering</p></li><li><p>Attachment Name Tag : MAIN-TGW-ATT</p></li><li><p>Region : N. Virginia</p></li><li><p>Transit Gateway (accepter) : MAIN-TGW ëŒ€ìƒ ì§€ì • (<code>ë²„ì§€ë‹ˆì•„</code>ì— ì§‘ì…í•˜ì—¬ TGW IDë¥¼ í™•ì¸ í›„ ì§ì ‘ ì…ë ¥í•´ì•¼ í•œë‹¤)</p></li></ul></li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled21.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2021.png"></p><p>ê·¸ë¦¼ 6.1 ì•„ì¼ëœë“œ ë¦¬ì „ì—ì„œ Inter Region Peering ì„¤ì •</p><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled22.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2022.png"></p><p>ê·¸ë¦¼ 6.2 Transit Gateway Attachment Inter Region Peering ì€ ë°”ë¡œ ì ìš©ì´ ë˜ì§€ ì•ŠìŒ (ë²„ì§€ë‹ˆì•„ì—ì„œ ìˆ˜ë½)</p><ul><li>VPC â€”&gt; Transit Gateway Attachment â€”&gt; ëŒ€ìƒ ì§€ì • â€”&gt; ì‘ì—… â€”&gt; Accept (<code>ë²„ì§€ë‹ˆì•„</code>)</li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled23.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2023.png"></p><p>ê·¸ë¦¼ 6.3 Transit Gateway Attachment Inter Region Peering í™•ì¸</p><ul><li>Inter Region Peering Attachment ëœ ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤. (êµ¬ë¶„ì„ ìœ„í•´ BRC-TGW-ATTë¡œ Tagí•¨)</li></ul><br><p>6.3 Routing Table ì„¤ì •</p><p>6.3.1) BRANCH SITE VPCì˜ Routing Table ì„¤ì •</p><ul><li><p>CloudFormationì— ì˜í•´ ìƒì„±ëœ 2ê°œì˜ ë¼ìš°íŒ… í…Œì´ë¸”ì— ê²½ë¡œë¥¼ ì¶”ê°€í•œë‹¤.</p><ul><li>ë¼ìš°íŒ… í¸ì§‘ â€”&gt; ë¼ìš°íŒ… ì¶”ê°€ â€”&gt; 10.0.0.0/8 ëŒ€ì—­, tgw-xxxx íƒ€ê²Ÿ</li></ul></li></ul><p>6.3.2) MAIN-TGWì˜ Routing Table ì„¤ì •</p><ul><li><p>VPC â€”&gt; Transit Gateway Routing Table â€”&gt; ëŒ€ìƒ ì„ íƒ â€”&gt; Route íƒ­ â€”&gt; Create Route</p><ul><li>10.0.0.0/8 ëŒ€ì—­, BRANCH-TGW íƒ€ê²Ÿ (tgw-xxxx)</li></ul></li></ul><p>6.3.3) BRANCH-TGWì˜ Routing Table ì„¤ì •</p><ul><li><p>VPC â€”&gt; Transit Gateway Routing Table â€”&gt; ëŒ€ìƒ ì„ íƒ â€”&gt; Route íƒ­ â€”&gt; Create Route</p><ul><li>10.0.0.0/8 ëŒ€ì—­, MAIN-TGW íƒ€ê²Ÿ (tgw-xxxx)</li></ul></li></ul><br><p>6.4 Verify</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@MAIN-MGT ~]$ ./pingall.sh</span><br><span class="line">node google.com is up</span><br><span class="line">node 10.1.1.10 is up</span><br><span class="line">node 10.2.1.10 is up</span><br><span class="line">node 10.2.2.10 is up</span><br><span class="line">node 10.3.1.10 is up</span><br><span class="line">node 10.3.2.10 is up</span><br><span class="line">node 10.4.1.10 is up</span><br><span class="line">node 10.5.1.10 is up</span><br><span class="line">node 10.6.1.10 is down</span><br><span class="line">[ec2-user@MAIN-MGT ~]$</span><br></pre></td></tr></table></figure><ul><li>MAIN-MGT EC2ì— ì ‘ì†í•˜ì—¬ <code>pingall.sh</code> ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆ˜í–‰í•œë‹¤.</li><li><code>ë²„ì§€ë‹ˆì•„</code> MAIN / SUB / BRANCH SITEì— ì¡´ì¬í•˜ëŠ” EC2 ë¼ë¦¬ í†µì‹ ì´ ê°€ëŠ¥í•˜ë‹¤.</li></ul><details><summary><b>6ì¥ í˜„ì¬ê¹Œì§€ ì™„ë£Œëœ êµ¬ì„±ë„ í™•ì¸</summary></summary></b><div markdown="1"><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled24.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2024.png"></p></div></details><hr><br><h3 id="7-AWS-Transit-Gateway-VPN-Attachment"><a href="#7-AWS-Transit-Gateway-VPN-Attachment" class="headerlink" title="7. AWS Transit Gateway VPN Attachment"></a>7. AWS Transit Gateway VPN Attachment</h3><ul><li><strong>ì´ ë²ˆ ë‹¨ê³„ì˜ ì‹¤ìŠµì€ MAIN SITE TGWì™€ ë‹¤ë¥¸ ë¦¬ì „ì— ìˆëŠ” Site-to-Site VPNì„ ì—°ê²°í•˜ëŠ”  í…ŒìŠ¤íŠ¸ë¥¼ í•œë‹¤. (AWS Transit Gateway VPN Attachment)</strong></li><li>ì„œìš¸ ë¦¬ì „ì— VPCë¥¼ ìƒì„±í•˜ì—¬ VPN ì„œë²„ë¥¼ ë°°ì¹˜í•˜ëŠ”ë°, ê°€ìƒìœ¼ë¡œ On-Premise í™˜ê²½ì´ë¼ ê°€ì •í•˜ì—¬ í…ŒìŠ¤íŠ¸ í•œë‹¤.</li><li>ì‹¤ìŠµ í™˜ê²½: Region - <code>ë²„ì§€ë‹ˆì•„, ì„œìš¸</code> , Account - ë³¸ AWS ê³„ì •</li></ul><br><p>7.1 ì„œìš¸ CloufFormation ë°°í¬</p><p>7.1.1) CloudFormation ë°°í¬</p><ul><li><p>2.3í•­ì—ì„œ ì œê³µí•œ Seoul_TransitGW_Lab_CF.yaml íŒŒì¼ì„ ë°°í¬í•˜ì.</p></li><li><p>ì„œìš¸ CF ìƒì„± ì¸í”„ë¼</p><ul><li><p>EC2-Instance 1ê°œ</p></li><li><p>VPC 1ê°œ, Public Subnet 1ê°œ, Routing Table 1ê°œ, IGW 1ê°œ</p></li><li><p>Security Group 1ê°œ</p></li></ul></li><li><p>ìœ„ ìƒì„±ëœ ì¸í”„ë¼ê°€ ì •ìƒì ìœ¼ë¡œ ì˜¬ë¼ì™”ëŠ” ì§€ í™•ì¸í•˜ì.</p></li></ul><br><p>7.2 AWS Site to Site VPN ì„¤ì •</p><p>7.2.1) Custom Gateway ìƒì„±</p><ul><li><p>VPC â€”&gt; VPN â€”&gt; ê³ ê° ê²Œì´íŠ¸ì›¨ì´ â€”&gt; ê³ ê° ê²Œì´íŠ¸ì›¨ì´ ìƒì„± (<code>ë²„ì§€ë‹ˆì•„</code>)</p><ul><li><p>ì´ë¦„ : CloudNeta-CGW</p></li><li><p>ë¼ìš°íŒ… : ì •ì </p></li><li><p>IP ì£¼ì†Œ : <code>ì„œìš¸</code>ì— ìœ„ì¹˜í•œ EC2 Public IP ì£¼ì†Œ</p></li></ul></li></ul><p>7.2.2) TGW VPN Attachment</p><ul><li><p>VPC â€”&gt; Transit Gateway Attachment â€”&gt; ì‚¬ì´íŠ¸ ê°„ VPN ì—°ê²° â€”&gt; VPN ì—°ê²° ìƒì„± (<code>ë²„ì§€ë‹ˆì•„</code>)</p><ul><li><p>Transit Gateway ID : MAIN-TGW ì„ íƒ</p></li><li><p>Attachment Type : VPN</p></li></ul><hr><ul><li><p>ê³ ê° ê²Œì´íŠ¸ì›¨ì´ : Existing</p></li><li><p>Customer Gateway ID : ìƒì„±í•œ CGW ì„ íƒ</p></li></ul><hr><ul><li>ë¼ìš°íŒ… ì˜µì…˜ : ì •ì </li></ul></li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled25.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2025.png"></p><p>7.2.3) VPN êµ¬ì„± ë‹¤ìš´ë¡œë“œ</p><ul><li>VPC â€”&gt; VPN â€”&gt; ì‚¬ì´íŠ¸ ê°„ VPNì— ì ‘ê·¼í•œë‹¤</li><li>ì¼ì • ì‹œê°„ì´ ì§€ë‚˜ë©´ Site to Site VPN ì—°ê²° ìƒíƒœëŠ” ì‚¬ìš© ê°€ëŠ¥ ìƒíƒœë¡œ ì „í™˜ëœë‹¤.</li><li>AWSì—ì„œëŠ” ì—°ê²° í•  ìƒëŒ€ë°© VPN ì„œë²„ì— ëŒ€í•œ êµ¬ì„± ì •ë³´ë¥¼ ì¹œì ˆíˆ ì œê³µí•˜ê³  ìˆë‹¤.</li><li>êµ¬ì„± ë‹¤ìš´ë¡œë“œ  â€”&gt; ê³µê¸‰ì—…ì²´ : Openswan ì„ íƒ</li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled26.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2026.png"></p><br><p>7.3 OpenSwan VPN ì„œë²„ ì„¤ì •</p><ul><li><code>ì„œìš¸</code>ì— ìƒì„±í•œ EC2-Instanceì— SSH ì ‘ì†ì„ í•œë‹¤.</li></ul><p>7.3.1) aws-vpn.conf ìƒì„± ë° ì…ë ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ec2-user@OPM-VPN ~]$ sudo su</span><br><span class="line">[root@OPM-VPN ec2-user]<span class="comment">#</span></span><br><span class="line">[root@OPM-VPN ec2-user]<span class="comment"># vi /etc/ipsec.d/aws-vpn.conf</span></span><br></pre></td></tr></table></figure><ul><li>vi í¸ì§‘ê¸° ëª¨ë“œë¡œ <code>/etc/ipsec.d/aws-vpn.conf</code> íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ì ‘ê·¼í•œë‹¤.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ipsec.d/aws-vpn.conf</span><br><span class="line">--------------------------------------------------------------------------</span><br><span class="line">conn Tunnel1</span><br><span class="line">authby=secret</span><br><span class="line">auto=start</span><br><span class="line">left=%defaultroute</span><br><span class="line">leftid=54.180.131.143</span><br><span class="line">right=34.231.125.200</span><br><span class="line"><span class="built_in">type</span>=tunnel</span><br><span class="line">ikelifetime=8h</span><br><span class="line">keylife=1h</span><br><span class="line">phase2alg=aes128-sha1;modp1024</span><br><span class="line">ike=aes128-sha1;modp1024</span><br><span class="line">~~auth=esp~~ ì‚­ì œ</span><br><span class="line">keyingtries=%forever</span><br><span class="line">keyexchange=ike</span><br><span class="line">leftsubnet=&lt;LOCAL NETWORK&gt; 10.6.0.0/16 ìœ¼ë¡œ ì…ë ¥</span><br><span class="line">rightsubnet=&lt;REMOTE NETWORK&gt; 10.0.0.0/8 ìœ¼ë¡œ ì…ë ¥</span><br><span class="line">dpddelay=10</span><br><span class="line">dpdtimeout=30</span><br><span class="line">dpdaction=restart_by_peer</span><br></pre></td></tr></table></figure><ul><li><p>í•´ë‹¹ ì½”ë“œ ì •ë³´ëŠ” <strong>7.2.3í•­ì—ì„œ ë‹¤ìš´ ë°›ì€ TXT íŒŒì¼ì—ì„œ 4í•­ì˜ ë‚´ìš©</strong>ì„ ì‚¬ìš©í•œë‹¤. (â˜¢ ìœ„ ì½”ë“œ ê°’ì„ ë„£ìœ¼ë¼ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê°ì ë‹¤ìš´ë°›ì€ TXT íŒŒì¼ì„ ì°¸ì¡°í•´ì„œ ì„¤ì •)</p></li><li><p><em>ì½”ë“œ ë‚´ìš© ì¤‘ ìˆ˜ì •ì´ í•„ìš”í•œ ì‚¬í•­</em></p><ul><li><p>LOCAL NETWORKëŠ” VPC-OPMì˜ ëŒ€ì—­ìœ¼ë¡œ 10.6.0.0/16 ì…ë ¥í•œë‹¤.</p></li><li><p>REMOTE NETWORKëŠ” AWS ëŒ€ì—­ìœ¼ë¡œ 10.0.0.0/8 ì…ë ¥í•œë‹¤.</p></li><li><p>auto=esp ì‚­ì œ</p></li><li><p>ë‚˜ë¨¸ì§€ëŠ” ìˆëŠ” ê·¸ëŒ€ë¡œ ì‚¬ìš©</p></li></ul></li></ul><p>7.3.2) aws-vpn.secrets ìƒì„±</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@OPM-VPN ec2-user]<span class="comment"># vi /etc/ipsec.d/aws-vpn.secrets</span></span><br></pre></td></tr></table></figure><ul><li>vi í¸ì§‘ê¸° ëª¨ë“œë¡œ <code>/etc/ipsec.d/aws-vpn.secrets</code> íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ì ‘ê·¼í•œë‹¤.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ipsec.d/aws-vpn.conf</span><br><span class="line">--------------------------------------------------------------------------</span><br><span class="line">54.180.131.143 34.231.125.200: PSK <span class="string">"DWJ2n0smRq6gDlMUuIweGa45m8c_RvZ3"</span></span><br></pre></td></tr></table></figure><ul><li>í•´ë‹¹ ì½”ë“œ ì •ë³´ëŠ” <strong>7.2.3í•­ì—ì„œ ë‹¤ìš´ ë°›ì€ TXT íŒŒì¼ì—ì„œ 5í•­ì˜ ë‚´ìš©</strong>ì„ ì‚¬ìš©í•œë‹¤. (â˜¢ ìœ„ ì½”ë“œ ê°’ì„ ë„£ìœ¼ë¼ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê°ì ë‹¤ìš´ë°›ì€ TXT íŒŒì¼ì„ ì°¸ì¡°í•´ì„œ ì„¤ì •)</li></ul><p>7.3.3) OpenSwan VPN ì„œë²„ ì‹œì‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@OPM-VPN ec2-user]<span class="comment"># chkconfig ipsec on</span></span><br><span class="line">:</span><br><span class="line">[root@OPM-VPN ec2-user]<span class="comment"># service ipsec start</span></span><br><span class="line">:</span><br><span class="line">[root@OPM-VPN ec2-user]<span class="comment"># service ipsec status</span></span><br><span class="line">Redirecting to /bin/systemctl status ipsec.service</span><br><span class="line">â— ipsec.service - Internet Key Exchange (IKE) Protocol Daemon <span class="keyword">for</span> IPsec</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/ipsec.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Fri 2020-05-08 07:49:18 UTC; 10s ago</span><br><span class="line">     Docs: man:ipsec(8)</span><br><span class="line">           man:pluto(8)</span><br><span class="line">           man:ipsec.conf(5)</span><br><span class="line">  Process: 4718 ExecStopPost=/usr/sbin/ipsec --stopnflog (code=exited, status=0/SUCCESS)</span><br><span class="line">:</span><br></pre></td></tr></table></figure><ul><li>OpenSwanì˜ ìƒíƒœê°€ Active ì„ì„ í™•ì¸ í•œë‹¤.</li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled27.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2027.png"></p><ul><li>ë²„ì§€ë‹ˆì•„ Site to Site VPN ìƒíƒœë¥¼ ë³´ë©´ Tunnel 1ì´ ì‘ë™ ìƒíƒœë¡œ ì˜¬ë¼ì™”ë‹¤.</li></ul><br><p>7.4 TGW ë¼ìš°íŒ… í…Œì´ë¸” ì„¤ì •</p><ul><li><p>Transit Gateway ë¼ìš°íŒ… í…Œì´ë¸”ì—ì„œ On-Premise ëŒ€ì—­ì— ëŒ€í•œ ë¼ìš°íŒ…ì„ ì¡ì•„ì•¼ í•œë‹¤.</p></li><li><p>VPC â€”&gt; Transit Gateway ë¼ìš°íŒ… í…Œì´ë¸” â€”&gt; TGW ëŒ€ìƒ ì§€ì • â€”&gt; Route íƒ­ â€”&gt; Create Route</p><ul><li><p>CIDR : 10.6.0.0/16</p></li><li><p>Choose Attachment : ìœ„ì— ìƒì„±í•œ VPN Attachment ì§€ì •</p><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled28.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2028.png"></p></li></ul></li></ul><br><p>7.5 Verify</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@MAIN-MGT ec2-user]<span class="comment"># ./pingall.sh</span></span><br><span class="line">node google.com is up</span><br><span class="line">node 10.1.1.10 is up</span><br><span class="line">node 10.2.1.10 is up</span><br><span class="line">node 10.2.2.10 is up</span><br><span class="line">node 10.3.1.10 is up</span><br><span class="line">node 10.3.2.10 is up</span><br><span class="line">node 10.4.1.10 is up</span><br><span class="line">node 10.5.1.10 is up</span><br><span class="line">node 10.6.1.10 is up</span><br><span class="line">[root@MAIN-MGT ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>MAIN-MGT EC2ì— ì ‘ì†í•˜ì—¬ <code>pingall.sh</code> ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆ˜í–‰í•œë‹¤.</li><li>ë“œë””ì–´ ëª¨ë“  êµ¬ê°„ìœ¼ë¡œ í†µì‹ ì´ ê°€ëŠ¥í•˜ë‹¤.</li></ul><details><summary><b>7ì¥ í˜„ì¬ê¹Œì§€ ì™„ë£Œëœ êµ¬ì„±ë„ í™•ì¸</summary></summary></b><div markdown="1"><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled29.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2029.png"></p></div></details><hr><br><h3 id="8-NAT-Gateway-through-AWS-Transit-Gateway"><a href="#8-NAT-Gateway-through-AWS-Transit-Gateway" class="headerlink" title="8. NAT Gateway through AWS Transit Gateway"></a>8. NAT Gateway through AWS Transit Gateway</h3><ul><li><strong>ì´ ë²ˆ ë‹¨ê³„ì˜ ì‹¤ìŠµì€ Private Subnetì— ì¡´ì¬í•˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ TGWë¥¼ í†µí•´ MAIN SITEì˜ Egress VPCì— ì¡´ì¬í•˜ëŠ” NAT GWë¥¼ í†µí•´ ì™¸ë¶€ ì¸í„°ë„· í†µì‹ ì„ í…ŒìŠ¤íŠ¸í•œë‹¤.</strong></li><li>ë³¸ ì‹¤ìŠµì—ì„œ Private Subnetì€ í¬ê²Œ TEST í™˜ê²½ê³¼ DEV í™˜ê²½ìœ¼ë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤. ì´ ì¤‘ì— DEV í™˜ê²½ë§Œ NAT GWë¥¼ í†µí•´ ì™¸ë¶€ ì¸í„°ë„· í†µì‹ ì„í•˜ê³ , TEST í™˜ê²½ì€ íì‡„ë§ ì„±ê²©ìœ¼ë¡œ ì™¸ë¶€ ì¸í„°ë„· í†µì‹ ì„ í•˜ì§€ ì•Šë„ë¡ í•˜ëŠ” ì»¨ì…‰ì´ë‹¤.</li><li>ì‹¤ìŠµ í™˜ê²½: Region - <code>ë²„ì§€ë‹ˆì•„</code> , Account - ë³¸ AWS ê³„ì • + ì„œë¸Œ AWS ê³„ì •</li></ul><br><p>8.1 ë²„ì§€ë‹ˆì•„ CloufFormation ë°°í¬</p><p>8.1.1) CloudFormation ë°°í¬</p><ul><li>2.3í•­ì—ì„œ ì œê³µí•œ Virginia_TransitGW_Lab_CF.yaml íŒŒì¼ì„ ë°°í¬í•˜ì.</li></ul><blockquote><p>ğŸ’¡ ì£¼ì˜: CF Conditionì— ì˜í•´ <strong>íŒŒë¼ë¯¸í„° ê°’ì„ Natë¡œ ì§€ì •</strong>í•˜ì!</p></blockquote><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled30.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2030.png"><br>ê·¸ë¦¼ 8.1 NAT ìš©ë„ì˜ CloudFormation ìƒì„± (EnvTypeì„ Natë¡œ ì§€ì •)</p><details><summary>ë²„ì§€ë‹ˆì•„ CF ìƒì„± ì¸í”„ë¼ (NAT)</summary><div markdown="1"><pre><code>- NAT Gateway 1ê°œ- VPC 1ê°œ, Public Subnet 1ê°œ, Private Subnet 1ê°œ, Routing Table 2ê°œ, IGW 1ê°œ</code></pre></div></details><ul><li>ìœ„ ìƒì„±ëœ ì¸í”„ë¼ê°€ ì •ìƒì ìœ¼ë¡œ ì˜¬ë¼ì™”ëŠ” ì§€ í™•ì¸í•˜ì.</li></ul><br><p>8.2 TGW Attachment</p><ul><li><p>VPC â€”&gt; Transit Gateway Attachment â€”&gt; Create Transit Gateway Attachment</p><ul><li><p>Transit Gateway ID ì§€ì •</p></li><li><p>Attachment Type : VPC</p></li><li><p>Attachment Name Tag : MAIN-VPCEG-ATT</p></li><li><p>VPC ID : VPC01 â€”&gt; AZ &amp; Subnet ì§€ì •</p></li></ul></li></ul><br><p>8.3 Routing Table ì„¤ì •</p><p>8.3.1) DEV í™˜ê²½ì˜ ë¼ìš°íŒ… ì„¤ì •</p><ul><li><p>DEV í™˜ê²½ì€ MAIN-DEVì™€ SUB-DEV 2êµ°ë°ë§Œ ì„¤ì • ì´ë‹¤.</p></li><li><p>VPC â€”&gt; ë¼ìš°íŒ… í…Œì´ë¸” â€”&gt; ëŒ€ìƒ ì§€ì • (ë³¸ ê³„ì •, ì„œë¸Œê³„ì • ëª¨ë‘ ì„¤ì •)</p><ul><li>ë¼ìš°íŒ… í¸ì§‘ â€”&gt; ë¼ìš°íŒ… ì¶”ê°€ â€”&gt; 0.0.0.0/0 ëŒ€ì—­, TGW íƒ€ê²Ÿ(tgw-xxxx)</li></ul></li></ul><p>8.3.2) TGWì˜ ë¼ìš°íŒ…ì„¤ì •</p><ul><li><p>VPC â€”&gt; Transit Gateway ë¼ìš°íŒ… í…Œì´ë¸” â€”&gt; ëŒ€ìƒ ì§€ì • â€”&gt; Route íƒ­ â€”&gt; Create Route</p><ul><li>0.0.0.0/0 ëŒ€ì—­, MAIN-VPCEG-ATT ëŒ€ìƒ ì§€ì •</li></ul></li></ul><p>8.3.3) VPCEGì˜ Privateì™€ Public ë¼ìš°íŒ… ì„¤ì • (2 êµ°ë° ì„¤ì •)</p><ul><li><p>VPC â€”&gt; ë¼ìš°íŒ… í…Œì´ë¸” â€”&gt; ëŒ€ìƒ ì§€ì •</p><ul><li>ë¼ìš°íŒ… í¸ì§‘ â€”&gt; ë¼ìš°íŒ… ì¶”ê°€ â€”&gt; 10.0.0.0/8 ëŒ€ì—­, TGW íƒ€ê²Ÿ(tgw-xxxx)</li></ul></li></ul><p>8.3 Verify</p><ul><li>MAIN-TEST, MAIN-DEV, SUB-TEST, SUB-DEVì— SSHë¡œ ì ‘ê·¼í•˜ì—¬ pingall.sh ìˆ˜í–‰ (rootê³„ì • ì•”í˜¸: qwe123)</li></ul><p>8.3.1) MAIN-TEST í…ŒìŠ¤íŠ¸</p><ul><li><p>View Result</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@MAIN-TEST ~]<span class="comment"># ./pingall.sh</span></span><br><span class="line">node google.com is down</span><br><span class="line">node 10.1.1.10 is up</span><br><span class="line">node 10.2.1.10 is up</span><br><span class="line">node 10.2.2.10 is up</span><br><span class="line">node 10.3.1.10 is up</span><br><span class="line">node 10.3.2.10 is up</span><br><span class="line">node 10.4.1.10 is up</span><br><span class="line">node 10.5.1.10 is up</span><br><span class="line">node 10.6.1.10 is up</span><br><span class="line">[root@MAIN-TEST ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>ë‚´ë¶€ ì¸í”„ë¼ì™€ëŠ”í†µì‹ ë˜ì§€ë§Œ ì™¸ë¶€ ì¸í„°ë„· í†µì‹ ì€ ë¶ˆê°€í•˜ë‹¤.</li></ul></li></ul><p>8.3.2) MAIN-DEV í…ŒìŠ¤íŠ¸</p><ul><li><p>View Result</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@MAIN-DEV ~]<span class="comment"># ./pingall.sh</span></span><br><span class="line">node google.com is up</span><br><span class="line">node 10.1.1.10 is up</span><br><span class="line">node 10.2.1.10 is up</span><br><span class="line">node 10.2.2.10 is up</span><br><span class="line">node 10.3.1.10 is up</span><br><span class="line">node 10.3.2.10 is up</span><br><span class="line">node 10.4.1.10 is up</span><br><span class="line">node 10.5.1.10 is up</span><br><span class="line">node 10.6.1.10 is up</span><br><span class="line">[root@MAIN-DEV ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>ëª¨ë“  ì˜ì—­ìœ¼ë¡œ í†µì‹ ì´ ê°€ëŠ¥í•˜ë‹¤.</li></ul></li></ul><p>8.3.3) SUB-TEST í…ŒìŠ¤íŠ¸</p><ul><li><p>View Result</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@SUB-TEST ~]<span class="comment"># ./pingall.sh</span></span><br><span class="line">node google.com is down</span><br><span class="line">node 10.1.1.10 is up</span><br><span class="line">node 10.2.1.10 is up</span><br><span class="line">node 10.2.2.10 is up</span><br><span class="line">node 10.3.1.10 is up</span><br><span class="line">node 10.3.2.10 is up</span><br><span class="line">node 10.4.1.10 is up</span><br><span class="line">node 10.5.1.10 is up</span><br><span class="line">node 10.6.1.10 is up</span><br><span class="line">[root@SUB-TEST ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>ë‚´ë¶€ ì¸í”„ë¼ì™€ëŠ”í†µì‹ ë˜ì§€ë§Œ ì™¸ë¶€ ì¸í„°ë„· í†µì‹ ì€ ë¶ˆê°€í•˜ë‹¤.</li></ul></li></ul><p>8.3.4) SUB-DEV í…ŒìŠ¤íŠ¸</p><ul><li><p>View Result</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@SUB-DEV ~]<span class="comment"># ./pingall.sh</span></span><br><span class="line">node google.com is up</span><br><span class="line">node 10.1.1.10 is up</span><br><span class="line">node 10.2.1.10 is up</span><br><span class="line">node 10.2.2.10 is up</span><br><span class="line">node 10.3.1.10 is up</span><br><span class="line">node 10.3.2.10 is up</span><br><span class="line">node 10.4.1.10 is up</span><br><span class="line">node 10.5.1.10 is up</span><br><span class="line">node 10.6.1.10 is up</span><br><span class="line">[root@SUB-DEV ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>ëª¨ë“  ì˜ì—­ìœ¼ë¡œ í†µì‹ ì´ ê°€ëŠ¥í•˜ë‹¤.</li></ul></li></ul><details><summary><b>8ì¥ í˜„ì¬ê¹Œì§€ ì™„ë£Œëœ êµ¬ì„±ë„ í™•ì¸</summary></summary></b><div markdown="1"><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled31.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2031.png"></p></div></details><hr><br><h3 id="9-AWS-Transit-Gateway-Network-Manager"><a href="#9-AWS-Transit-Gateway-Network-Manager" class="headerlink" title="9. AWS Transit Gateway Network Manager"></a>9. AWS Transit Gateway Network Manager</h3><ul><li><strong>ì´ ë²ˆ ë‹¨ê³„ì˜ ì‹¤ìŠµì€ TGW Network Manager ê¸°ëŠ¥ì„ í†µí•´ ê°€ì‹œì„± ìˆê²Œ Global Networkë¥¼ ëª¨ë‹ˆí„°ë§í•œë‹¤.</strong></li></ul><br><p>9.1 Create Global Network</p><ul><li><p>VPC â€”&gt; Transit Gateway â€”&gt; ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ì â€”&gt; Create a Global Network</p><ul><li>ì´ë¦„ : CloudNeta-GN</li></ul></li></ul><br><p>9.2 Transit Gateway ë“±ë¡</p><ul><li><p>ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ì ë°ì‹œë³´ë“œì—ì„œ ì „ì†¡ ê²Œì´íŠ¸ì›¨ì´ ì¶”ê°€í•œë‹¤.</p><ul><li><p>CloudNeta-MAIN-TGW</p></li><li><p>BRC-TGW</p></li></ul></li></ul><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled32.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2032.png"></p><p>ê·¸ë¦¼ 9.1 TGW Global Network ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ìì—ì„œ Transit Gateway ë“±ë¡</p><br><p>9.3 Verify</p><p>9.3.1) ì§€ë¦¬ì  ì •ë³´</p><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled33.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2033.png"></p><p>ê·¸ë¦¼ 9.2 TGWì˜ ì§€ë¦¬ì  ìœ„ì¹˜ í‘œí˜„</p><p>9.3.2) í† í´ë¡œì§€</p><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled34.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2034.png"></p><p>ê·¸ë¦¼ 9.3 Global Network ì—°ê²° í† í´ë¡œì§€ í™•ì¸</p><p>9.3.4) ëª¨ë‹ˆí„°ë§</p><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled35.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2035.png"></p><p>ê·¸ë¦¼ 9.4 Global Network ëª¨ë‹ˆí„°ë§ ì •ë³´</p><p>9.3.5) Route Analyzer</p><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled36.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2036.png"></p><p>ê·¸ë¦¼ 9.5 ê²½ë¡œ ë¶„ì„ê¸° (Route Analyzer) ì •ë³´ ì…ë ¥</p><p><img src="/images/LabGuide-AWS-Transit-Gateway/Untitled37.png" alt="LabGuide%20AWS%20Transit%20Gateway%20efff213e58a546c5bc56273e4425244a/Untitled%2037.png"><br>ê·¸ë¦¼ 9.6 ê²½ë¡œ ë¶„ì„ê¸° ê²°ê³¼ í™•ì¸</p><p><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9hYm91dC1hd3Mvd2hhdHMtbmV3LzIwMjAvMDUvYW5ub3VuY2luZy1yb3V0ZS1hbmFseXplci1pbi1hd3MtdHJhbnNpdC1nYXRld2F5LW5ldHdvcmstbWFuYWdlci8=">AWS Transit Gateway ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ì Route Analyzer ë°œí‘œ<i class="fa fa-external-link-alt"></i></span></p><p>ì°¸ê³  ë§í¬ : AWS TGW ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ Route Analyzer ë°œí‘œ</p><hr><br><h3 id="10-Delete-Resources"><a href="#10-Delete-Resources" class="headerlink" title="10. Delete Resources"></a>10. Delete Resources</h3><p>01) TGW ë„¤íŠ¸ì›Œí¬ ë§¤ë‹ˆì € ì „ì†¡ ê²Œì´íŠ¸ì›¨ì´ ë“±ë¡ ì·¨ì†Œ</p><p>02) ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ ì‚­ì œ</p><p>03) <code>ì„œìš¸</code> CloudFormation ìŠ¤íƒ ì‚­ì œ</p><p>04) <code>ì•„ì´ëœë“œ</code> TGW Attachmentì—ì„œ TGW Peering ëŒ€ìƒ ì‚­ì œ</p><p>05) <code>ì•„ì¼ëœë“œ</code> CloudFormation ìŠ¤íƒ ì‚­ì œ</p><p>06) ì„œë¸Œ ê³„ì • Resource Access Managerì—ì„œ ë¦¬ì†ŒìŠ¤ ê³µìœ  ë‚˜ê°€ê¸°</p><p>07) ë©”ì¸ ê³„ì • Resource Access Managerì—ì„œ ë¦¬ì†ŒìŠ¤ ì‚­ì œ</p><p>08) ì„œë¸Œ ê³„ì • TGW Attachmentì—ì„œ VPC Attachment ëŒ€ìƒ ì‚­ì œ</p><p>09) ì„œë¸Œ ê³„ì • <code>ë²„ì§€ë‹ˆì•„</code> CloudFormation ìŠ¤íƒ ì‚­ì œ</p><p>10) <code>ë²„ì§€ë‹ˆì•„</code> ì‚¬ì´íŠ¸ ê°„ VPN ì—°ê²° ì‚­ì œ í›„ ê³ ê° ê²Œì´íŠ¸ì›¨ì´ ì‚­ì œ</p><p>11) <code>ë²„ì§€ë‹ˆì•„</code> TGW Multicast Domain ì‚­ì œ (ìš°ì„  Delete Association í›„ ì‚­ì œ)</p><p>12) <code>ë²„ì§€ë‹ˆì•„</code> TGW Attachment ëŒ€ìƒ ëª¨ë‘ ì‚­ì œ</p><p>13) <code>ë²„ì§€ë‹ˆì•„</code> Trasit Gateway ì‚­ì œ</p><p>14) <code>ë²„ì§€ë‹ˆì•„</code> NAT CloudFormation ìŠ¤íƒ ì‚­ì œ</p><p>15) <code>ë²„ì§€ë‹ˆì•„</code> MAIN CloudFormation ìŠ¤íƒ  ì‚­ì œ</p><blockquote><p>ğŸ”” CloudFormation ìŠ¤íƒì„ ì‚­ì œ ì‹œ ì¼ì • ì‹œê°„ì´ ì†Œìš”ë˜ëŠ”ë°, ë„ˆë¬´ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦°ë‹¤ë©´ ìˆ˜ë™ìœ¼ë¡œ ê´€ë ¨ ì¸í”„ë¼ë¥¼ ì‚­ì œí•´ì•¼ í•œë‹¤.<br>ë°˜ë“œì‹œ, ì‹¤ìŠµì„ ìœ„í•´ ìƒì„±í•œ ë¦¬ì†ŒìŠ¤ëŠ” ì‚­ì œí•œë‹¤.</p></blockquote><br>]]></content:encoded>
      
      <comments>http://cloudneta.github.io/2020/05/16/Transit-Gateway/#disqus_thread</comments>
    </item>
    
    <item>
      <title>AWS VPN Site to Site with Dynamic Route</title>
      <link>http://cloudneta.github.io/2020/05/07/VPN-SitetoSite-with-Dynamic-Route/</link>
      <guid>http://cloudneta.github.io/2020/05/07/VPN-SitetoSite-with-Dynamic-Route/</guid>
      <pubDate>Thu, 07 May 2020 10:45:01 GMT</pubDate>
      <description>
      
        &lt;p&gt;&lt;em&gt;ì‘ì„±ì : gasida.cloudnet@&lt;/em&gt;&lt;/p&gt;
      
      </description>
      
      
      <content:encoded><![CDATA[<p><em>ì‘ì„±ì : gasida.cloudnet@</em></p><a id="more"></a><br><details><summary>AWS Document Link</summary><div markdown="1"><ul><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL3Zwbi9sYXRlc3QvczJzdnBuL1ZQQ19WUE4uaHRtbA==">Site-to-Site VPN User Guide<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL3ZwYy9sYXRlc3QvYWRtaW5ndWlkZS9XZWxjb21lLmh0bWw=">Site-to-Site VPN Network Administrator Guide<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93aWtpLnZ5b3MubmV0L3dpa2kvVXNlcl9HdWlkZQ==">VYOS User Guide<i class="fa fa-external-link-alt"></i></span></li></ul></div></details><hr><br><h3 id="1-AWS-VPN-Site-to-Site-with-Dynamic-Route-BGP"><a href="#1-AWS-VPN-Site-to-Site-with-Dynamic-Route-BGP" class="headerlink" title="1. AWS VPN Site to Site with Dynamic Route (BGP)"></a>1. AWS VPN Site to Site with Dynamic Route (BGP)</h3><ul><li><p>VPN ì„ í†µí•œ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­ì— ëŒ€í•œ ë¼ìš°íŒ… ê´‘ë¡œë¥¼ BGP ë¥¼ í†µí•˜ì—¬ ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ í•œë‹¤</p></li><li><p>BGP AS ëŠ” 2- or 4-byte ASN ë¥¼ ì‚¬ìš©</p></li><li><p>AWS VGWëŠ” BGPë¡œ Amazon VPC ëŒ€ì—­ì„ ê´‘ê³ í•œë‹¤</p><p>  â†’ ì¦‰, IDC(ê³ ê°ì¸¡)ì—ëŠ” AWS VPCëŒ€ì—­ì˜ ë„¤íŠ¸ì›Œí¬ ì •ë³´ë¥¼ ì•Œê²Œ ëœë‹¤</p></li><li><p>AWS VGWëŠ” BGPë¡œ VPCëŒ€ì—­ ê´‘ê³  ì‹œ BGP MED 100 ê³¼ 200 ì„ ê°ê° Tunnel ë¡œ ê´‘ê³ í•œë‹¤</p><p>  â†’ ì¦‰, IDC(ê³ ê°ì¸¡)ì—ì„œëŠ” BGP MED 100ì´ ìš°ì„ í•¨ìœ¼ë¡œ 1ê°œì˜ Tunnel ì´ ì„ ì •ë˜ê³  ì‹¤ì œ íŠ¸ë˜í”½ì´ í•´ë‹¹ Tunnel ë¡œ í†µì‹ í•œë‹¤</p></li><li><p>IPsec tunnels ê³¼ BGP sessions ëŠ” í•­ìƒ ê³ ê°ì¸¡(CGW)ì—ì„œ ì‹œì‘í•œë‹¤</p></li></ul><hr><br><h3 id="2-AWS-VPN-Site-to-Site-with-Dynamic-Route-BGP-Lab-Preview"><a href="#2-AWS-VPN-Site-to-Site-with-Dynamic-Route-BGP-Lab-Preview" class="headerlink" title="2. AWS VPN Site to Site with Dynamic Route (BGP) Lab Preview"></a>2. AWS VPN Site to Site with Dynamic Route (BGP) Lab Preview</h3><br><p>2.1 Lab Topology</p><ul><li><p><code>ì„œìš¸, ì‹±ê°€í´</code> Regionì— ê°ê° AWS í™˜ê²½ê³¼, IDC í™˜ê²½(ê°€ì •)ìœ¼ë¡œ êµ¬ì„±</p><ul><li>IDC í™˜ê²½ì€ ì‹¤ì œ AWS ì˜ì—­ì´ ì•„ë‹ˆë¼ ì¼ë°˜ ê¸°ì—… ë¬¼ë¦¬ë§ì´ì§€ë§Œ ì‹¤ìŠµì˜ í¸ë¦¬ì„±ì„ ìœ„í•´ì„œ AWS í™˜ê²½ì—ì„œ êµ¬ì„±í•¨</li></ul></li><li><p><code>ì„œìš¸</code> Region ì€ AWS VGWë¥¼ ë°°ì¹˜í•˜ê³  Public Subnet ì— í…ŒìŠ¤íŠ¸ ìš©ë„ì˜ EC2ë¥¼ ë°°ì¹˜í•¨</p></li><li><p><code>ì‹±ê°€í´</code> Region (IDCí™˜ê²½)ì€ VPN ì—­í• ì„ VYOS(ì»¤ë®¤ë‹ˆí‹°AMI)ë¡œ í•˜ë©° Private Subnetì— í…ŒìŠ¤íŠ¸ ìš©ë„ì˜ EC2ë¥¼ ë°°ì¹˜í•¨</p><p>  <img src="/images/VPN-SitetoSite-with-Dynamic-Route/Untitled.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Dynamic%20Route%20BGP%2005b6a5e86b864ae6b876cae1b8184477/Untitled.png"></p></li></ul><blockquote><p>ğŸ’¡ VYOSëŠ” ë¦¬ëˆ…ìŠ¤(Debina) ê¸°ë°˜ì— ë¼ìš°íŒ…, ë°©í™”ë²½, VPN ê¸°ëŠ¥ì„ ì œê³µí•˜ì—¬ VPN ì—­í• ë¡œ ì„ íƒí•¨. <span class="exturl" data-url="aHR0cHM6Ly93aWtpLnZ5b3MubmV0L3dpa2kvVXNlcl9HdWlkZQ==">ì°¸ê³  ë§í¬<i class="fa fa-external-link-alt"></i></span></p></blockquote><br><p>2.2 ê¸°ë³¸ ì„¤ì •</p><ul><li>ë³¸ ì‹¤ìŠµì—ì„œ í™œìš©í•  AWS Regionì€ <code>ì„œìš¸, ì‹±ê°€í´</code> ì…ë‹ˆë‹¤. í•´ë‹¹ Regionì— ëŒ€í•œ <em>EC2-Key Pair</em>ë¥¼ ìƒì„±</li><li><code>ì‹œë“œë‹ˆ, ìƒíŒŒìš¸ë£¨</code> Region ì— ë¦¬ì†ŒìŠ¤ëŠ” <em>CloudFormation</em>ì— ì˜í•´ 2.1 ê·¸ë¦¼ì˜ ì¸í”„ë¼ë¥¼ ìë™ êµ¬ì¶• (2.3í•­ì—ì„œ ì§„í–‰)</li></ul><br><p>2.3 CloudFormation (Infrastructure as Code)</p><details><summary><b>ì‹±ê°€í´ Regionì—ì„œ CloudFormation ìŠ¤íƒì„ ìƒì„±í•œë‹¤.</summary></b><div markdown="1"><ul><li>1ë‹¨ê³„ í…œí”Œë¦¿ ì§€ì •<ul><li>í…œí”Œë¦¿ ì¤€ë¹„ : ì¤€ë¹„ëœ í…œí”Œë¦¿</li><li>í…œí”Œë¦¿ ì†ŒìŠ¤ : Amazon S3 URL</li><li>Amazon S3 URL : <span class="exturl" data-url="aHR0cHM6Ly9zMy5hcC1ub3J0aGVhc3QtMi5hbWF6b25hd3MuY29tL2Nsb3VkZm9ybWF0aW9uLmNsb3VkbmV0YS5uZXQvVlBOL2dhc2lkYV92cG5faWRjMS55YW1s">https://s3.ap-northeast-2.amazonaws.com/cloudformation.cloudneta.net/VPN/gasida_vpn_idc1.yaml<i class="fa fa-external-link-alt"></i></span><ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ë‹¤ìŒ</code> í´ë¦­</li></ul></li></ul></li><li>2ë‹¨ê³„ ìŠ¤íƒ ì„¸ë¶€ ì •ë³´ ì§€ì •<ul><li>ìŠ¤íƒ ì´ë¦„ : VPN-IDC</li><li>KeyName : ìì‹ ì˜ <em>EC2-Key Pair</em> ë¥¼ ì§€ì •<ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ë‹¤ìŒ</code> í´ë¦­</li></ul></li></ul></li><li>3ë‹¨ê³„ ìŠ¤íƒ ì˜µì…˜ êµ¬ì„±<ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ë‹¤ìŒ</code> í´ë¦­</li></ul></li><li>4ë‹¨ê³„ ê²€í† <ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ìŠ¤íƒ ìƒì„±</code> í´ë¦­</li></ul></li></ul></div></details><details><summary><b>ì‹±ê°€í´ Regionì—ì„œ CloudFormation ìŠ¤íƒ ìƒì„± ì™„ë£Œ í›„ (5ë¶„ ì •ë„ ì†Œìš”) ì¶œë ¥ì—ì„œ VYOSInstancePublicIP ì˜ ê°’(IP)ë¥¼ í™•ì¸í•œë‹¤.</summary></b><div markdown="1"><p><img src="/images/VPN-SitetoSite-with-Dynamic-Route/Untitled1.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Dynamic%20Route%20BGP%2005b6a5e86b864ae6b876cae1b8184477/Untitled%201.png"></p></div></details><details><summary><b>ì„œìš¸ Regionì—ì„œ CloudFormation ìŠ¤íƒì„ ìƒì„±í•œë‹¤.</summary></b><div markdown="1"><ul><li>1ë‹¨ê³„ í…œí”Œë¦¿ ì§€ì •<ul><li>í…œí”Œë¦¿ ì¤€ë¹„ : ì¤€ë¹„ëœ í…œí”Œë¦¿</li><li>í…œí”Œë¦¿ ì†ŒìŠ¤ : Amazon S3 URL</li><li>Amazon S3 URL : <span class="exturl" data-url="aHR0cHM6Ly9zMy5hcC1ub3J0aGVhc3QtMi5hbWF6b25hd3MuY29tL2Nsb3VkZm9ybWF0aW9uLmNsb3VkbmV0YS5uZXQvVlBOL2dhc2lkYV92cG5fYXdzLnlhbWw=">https://s3.ap-northeast-2.amazonaws.com/cloudformation.cloudneta.net/VPN/gasida_vpn_aws.yaml<i class="fa fa-external-link-alt"></i></span><ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ë‹¤ìŒ</code> í´ë¦­</li></ul></li></ul></li><li>2ë‹¨ê³„ ìŠ¤íƒ ì„¸ë¶€ ì •ë³´ ì§€ì •<ul><li>ìŠ¤íƒ ì´ë¦„ : VPN-AWS</li><li>KeyName : ìì‹ ì˜ <em>EC2-Key Pair</em> ë¥¼ ì§€ì •</li><li>StaticRoutesOnlyForVPN : <strong>false</strong> â† AWS VPN ì™€ IDC VPN ê°„ <strong>Dynamic Route(BGP)</strong> ì„¤ì •ì„ í•  ì˜ˆì •ì´ë¯€ë¡œ</li><li>VPCAWSCustomerGatewayIP : 52.76.100.41 â† ìœ„ ì‹±ê°€í´ì—ì„œ ìŠ¤íƒ ì¶œë ¥ì—ì„œ VYOSInstancePublicIP ê°’<ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ë‹¤ìŒ</code> í´ë¦­</li></ul></li></ul></li><li>3ë‹¨ê³„ ìŠ¤íƒ ì˜µì…˜ êµ¬ì„±<ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ë‹¤ìŒ</code> í´ë¦­</li></ul></li><li>4ë‹¨ê³„ ê²€í† <ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ìŠ¤íƒ ìƒì„±</code> í´ë¦­</li></ul></li></ul></div></details><ul><li>CloudFormationì— ì˜í•´ ìƒì„±ë˜ëŠ” ë¦¬ì†ŒìŠ¤ëŠ” ì•„ë˜ì™€ ê°™ìœ¼ë©°, ê° Region ë³„ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.</li></ul><details><summary>ì‹±ê°€í´ CloudFormation ìƒì„± ì¸í”„ë¼</summary><div markdown="1"><pre><code>- VPC, 2 Subnet, IGW, 2 Route table- EIP, VYOS EC2 Instance (eth0, eth1)- Amazon Linux 2 EC2 Instance (Testìš©)</code></pre></div></details><details><summary>ì„œìš¸ CloudFormation ìƒì„± ì¸í”„ë¼</summary><div markdown="1"><pre><code>- VPC, 2 Subnet, IGW, 2 Route table- VGW, CGW, VPN Connection- EIP, Amazon Linux 2 EC2 Instance (Testìš©)</code></pre></div></details><br><blockquote><p>ğŸ’¡ ì‹¤ë¬´ì—ì„œì˜ AWS VGW ì™€ ì—°ê²° ì‹œ IDC ìœ„ì¹˜í•œ VPN(ì˜ˆ. VYOS)ì„¤ì •ì€ ë³´í†µ â€˜IDC ë„¤íŠ¸ì›Œí¬(í˜¹ì€ ë³´ì•ˆ) ì—”ì§€ë‹ˆì–´â€™ ê°€ ì„¤ì •ì„ í•˜ê²Œ ë˜ì–´ì„œ ê°œë°œì ë¶„ë“¤ì˜ ê²½ìš° ì•„ë˜ Lab ë”°ë¼í•˜ê¸°ê°€ ì–´ë ¤ìš´ ë¶€ë¶„ì´ ìˆë‹¤. ê·¸ë˜ì„œ VYOS ê´€ë ¨ ì„¤ì •ê³¼ IDC1ì— ê´€ë ¨ ì„¤ì •ì€ toggle â€˜â–¶ï¸â€™ ì ‘ì–´ ë‘ì—ˆë‹¤. í•„ìš” ì‹œ toggle í´ë¦­í•˜ì—¬ ìƒì„¸íˆ ë‚´ìš©ì„ ë³´ì‹œê¸° ë°”ë€ë‹¤. VYOS ë‚´ìš©ì„ ì œì™¸í•œ AWS VPN ê´€ë ¨ ì„¤ì • ë‚´ìš©ì„ ìœ„ì£¼ë¡œ ë³´ì‹œë©´ ëœë‹¤.</p></blockquote><br><p>2.4 ê²€ì¦</p><ul><li><p>ì‚¬ìš©ì PCì—ì„œ <code>ì‹±ê°€í´</code> VYOS Public IP ì£¼ì†Œë¡œ SSH ì ‘ê·¼í•œë‹¤. ì¶”ê°€ë¡œ VYOS ì¸í„°í˜ì´ìŠ¤ ì„¤ì •ì„ í•œë‹¤.</p><ul><li><p>VYOS ì„¤ì • ëª¨ë“œ(conf) ë¡œ ì§„ì…í•´ì„œ VYOS eth1 IP(ìŠ¤íƒ ì¶œë ¥ VYOSInstanceINTERNALPrivateIP í™•ì¸)ëŠ” ì„¤ì • í›„ ì ìš©í•œë‹¤.</p></li><li><p>Private Subnet ì— ìˆëŠ” Test EC2 IP ë¡œ ping ë° SSH ì ‘ê·¼í•œë‹¤. ì ‘ì† ê³„ì • root / qwe123</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ìì‹ ì˜ VYOSInstanceINTERNALPrivateIP ë¡œ SSH ì ‘ì†</span></span><br><span class="line">ssh -i <span class="string">'*EC2-Key Pair'</span>* vyos@52.76.100.41</span><br><span class="line">..</span><br><span class="line"></span><br><span class="line"><span class="comment"># í•´ë‹¹ AMI ì´ë¯¸ì§€ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ eth1 IP ê°€ ë¯¸ì„¤ì • ë˜ì–´ ìˆë‹¤</span></span><br><span class="line">vyos@ip-10-100-1-198:~$ show interfaces</span><br><span class="line">Codes: S - State, L - Link, u - Up, D - Down, A - Admin Down</span><br><span class="line">Interface        IP Address                        S/L  Description</span><br><span class="line">---------        ----------                        ---  -----------</span><br><span class="line">eth0             10.100.1.198/24                    u/u</span><br><span class="line">eth1             -                                 u/u</span><br><span class="line">..</span><br><span class="line"></span><br><span class="line"><span class="comment"># VYOS ì„¤ì •ëª¨ë“œ(conf)ë¡œ ì§„ì…í•˜ì—¬ eth1ì˜ IPë¥¼ ì„¤ì • í›„ ì ìš©ê³¼ ì €ì¥ì„ í•œë‹¤</span></span><br><span class="line">vyos@ip-10-100-1-198$ conf</span><br><span class="line">vyos@ip-10-100-1-198<span class="comment"># set interfaces ethernet eth1 address 10.100.100.56/24</span></span><br><span class="line">vyos@ip-10-100-1-198<span class="comment"># commit</span></span><br><span class="line">vyos@ip-10-100-1-198<span class="comment"># exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># VYOSì—ì„œ ë‚´ë¶€ì— ìˆëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤ë¡œ ping í…ŒìŠ¤íŠ¸ë¥¼ í•œë‹¤</span></span><br><span class="line">vyos@ip-10-100-1-198:~$ ping 10.100.100.192</span><br><span class="line">PING 10.100.100.192 (10.100.100.192) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.100.100.192: icmp_seq=1 ttl=255 time=0.732 ms</span><br><span class="line">..</span><br><span class="line"></span><br><span class="line"><span class="comment"># VYOSì—ì„œ ë‚´ë¶€ì— ìˆëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤ë¡œ SSH ì ‘ì† í™•ì¸ì„ í•œë‹¤.</span></span><br><span class="line">vyos@ip-10-100-1-198:~$ ssh root@10.100.100.192</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ì‚¬ìš©ì PCì—ì„œ <code>ì„œìš¸</code> EC2 Instance EIP ì£¼ì†Œë¡œ SSH ì ‘ê·¼í•œë‹¤. ì ‘ì† ê³„ì • root / qwe123</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@52.78.176.204</span><br></pre></td></tr></table></figure></li><li><p>ì°¸ê³ ë¡œ CloudFormationì— ì˜í•´ ë¦¬ì†ŒìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ì˜¬ë¼ì˜¤ê¸° ê¹Œì§€ ì•½ê°„ì˜ ì‹œê°„ì´ í•„ìš”í•˜ë‹ˆ ì¼ì • ì‹œê°„ ëŒ€ê¸°ê°€ í•„ìš”í•˜ë‹¤.</p></li></ul><blockquote><p>ğŸ’¡ ë³¸ê²©ì ì¸ ì‹¤ìŠµì— ì•ì„œ, Site to Site VPN ë¦¬ì†ŒìŠ¤ëŠ” ì†ŒëŸ‰ì˜ ê³¼ê¸ˆì´ ë¶ˆê°€í”¼ í•˜ë‹¤. (VPN ì—°ê²° ì‹œê°„ ë‹¨ìœ„ ìš”ê¸ˆ ë¶€ê³¼ - ì‹œê°„ ë‹¹ $0.05 ë“±)<br>ìì„¸í•œ ì‚¬í•­ì€ <span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9nbG9iYWwtYWNjZWxlcmF0b3IvcHJpY2luZy9odHRwczovL2F3cy5hbWF6b24uY29tL2tvL3Zwbi9wcmljaW5nLw==">ìš”ê¸ˆ ë§í¬<i class="fa fa-external-link-alt"></i></span>ë¥¼ ì°¸ê³  ë°”ë€ë‹¤.</p></blockquote><hr><br><h3 id="3-Configuration-Site-to-Site-VPN"><a href="#3-Configuration-Site-to-Site-VPN" class="headerlink" title="3. Configuration Site to Site VPN"></a>3. Configuration Site to Site VPN</h3><br><p>3.1 <code>ì„œìš¸</code> Region ì˜ VPN ì •ë³´ í™•ì¸</p><ul><li><p>VPN Tunnel 1 ê³¼  Tunnel 2 ì˜ ì™¸ë¶€IPì™€  ë‚´ë¶€IP CIDRì„ í™•ì¸ í•œë‹¤.</p><p>  <img src="/images/VPN-SitetoSite-with-Dynamic-Route/2020-05-07-01.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Dynamic%20Route%20BGP%2005b6a5e86b864ae6b876cae1b8184477/_2020-05-07__10.03.33.png"></p></li></ul><br><p>3.2 <code>ì„œìš¸</code> Region ì˜ ê³ ê° VPN ì¥ë¹„ ì„¤ì •ì„ ìœ„í•œ êµ¬ì„± ë‹¤ìš´ë¡œë“œ í›„ <code>ì‹±ê°€í´</code> Region ì— VYOS ì— VPN Config ì„¤ì •</p><ul><li><p>ğŸ’ğŸ»â€â™‚ï¸ VPN êµ¬ì„± ë‹¤ìš´ë¡œë“œ?  AWS VGW ì— ì—°ê²°ë˜ëŠ” ê³ ê°VPN ì¥ë¹„(ê³µê¸‰ì—…ì²´ ë³„)ì˜ VPN ê´€ë ¨ ì„¤ì •ì„ AWS ì—ì„œ ì œê³µ</p></li><li><p>[AWS VPN ì‚¬ì´íŠ¸ ê°„ VPN ì—°ê²° - êµ¬ì„± ë‹¤ìš´ë¡œë“œ] ì„ íƒ í›„ Vyatta ì„ íƒ í›„ <code>ë‹¤ìš´ë¡œë“œ</code></p><p>  <img src="/images/VPN-SitetoSite-with-Dynamic-Route/Untitled2.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Dynamic%20Route%20BGP%2005b6a5e86b864ae6b876cae1b8184477/Untitled%202.png"></p><ul><li><p>ë‹¤ìš´ë¡œë“œ íŒŒì¼ ì˜ˆì‹œ</p><p>  <a href="/images/VPN-SitetoSite-with-Dynamic-Route/vpn-0056e880bc3e56d15.txt">vpn-0056e880bc3e56d15.txt</a></p></li></ul></li><li><p>ë‹¤ìš´ ë°›ì€ config íŒŒì¼ ë‚´ìš©ì„ ì¼ë¶€ ë³€ê²½ í›„ VYOS ì— ì ìš©í•œë‹¤</p></li></ul><details><summary>ì¼ë¶€ ë‚´ìš© ë³€ê²½ : ì°¾ê¸° ì‚¬ìš©ì„ ê¶Œì¥</summary><div markdown="1"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">41ì¤„, 132ì¤„) VYOS eth0(EIP)ë¥¼ etho(private ip)ë¡œ ë³€ê²½</span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 15.164.80.217 <span class="built_in">local</span>-address <span class="string">'10.100.1.198'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 52.78.188.212 <span class="built_in">local</span>-address <span class="string">'10.100.1.198'</span></span><br><span class="line"></span><br><span class="line">98ì¤„, 189ì¤„) VYOS ì˜ BGP ëª…ë ¹ì–´ ì…ë ¥ì´ ë²„ì „ ìƒí–¥ìœ¼ë¡œ ì¼ë¶€ ë°”ë€Œì—ˆìŒ</span><br><span class="line"><span class="built_in">set</span> protocols bgp 65000 neighbor 169.254.13.29 soft-reconfiguration <span class="string">'inbound'</span> -(ì•„ë˜ ë‚´ìš©ìœ¼ë¡œ ë³€ê²½)-&gt;</span><br><span class="line"><span class="built_in">set</span> protocols bgp 65000 neighbor 169.254.13.29 address-family ipv4-unicast soft-reconfiguration inbound</span><br><span class="line"></span><br><span class="line">106ì¤„, 197ì¤„) í•´ë‹¹ ë‚´ìš© ì‚­ì œ, í•´ë‹¹ ë‚´ìš©ì€ IDCì—ì„œ ë””í´íŠ¸ route ì •ë³´ë¥¼ ê´‘ê³ í•˜ëŠ” ë‚´ìš©ì´ë‹¤</span><br><span class="line"><span class="built_in">set</span> protocols bgp 65000 network 0.0.0.0/0 - í•´ë‹¹ ì¤„ ë‚´ìš© ì‚­ì œ</span><br><span class="line"></span><br><span class="line">ë§¨ ë§ˆì§€ë§‰ì¤„ ë‚´ìš© ì¶”ê°€) IDCë‚´ë¶€ ëŒ€ì—­ì¸ 10.100.0.0/16 ëŒ€ì—­ì„ BGPë¡œ ê´‘ê³ í•œë‹¤</span><br><span class="line"><span class="built_in">set</span> protocols bgp 65000 address-family ipv4-unicast network 10.100.0.0/16</span><br></pre></td></tr></table></figure></div></details><br><details><summary>ë³€ê²½ ì ìš© í•œ VYOS VPN Config â†’ VYOS conf ëª¨ë“œì— ë³µì‚¬ ë¶™ì—¬ë„£ê¸°ë¥¼ í•œë‹¤</summary><div markdown="1"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">conf</span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS lifetime <span class="string">'28800'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS proposal 1 dh-group <span class="string">'2'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS proposal 1 encryption <span class="string">'aes128'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS proposal 1 <span class="built_in">hash</span> <span class="string">'sha1'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 15.164.80.217 authentication mode <span class="string">'pre-shared-secret'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 15.164.80.217 authentication pre-shared-secret <span class="string">'NCN1B7Xzjv0NnGOLxFQJMnWBG8FlJnzT'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 15.164.80.217 description <span class="string">'VPC tunnel 1'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 15.164.80.217 ike-group <span class="string">'AWS'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 15.164.80.217 <span class="built_in">local</span>-address <span class="string">'10.100.1.198'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 15.164.80.217 vti <span class="built_in">bind</span> <span class="string">'vti0'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 15.164.80.217 vti esp-group <span class="string">'AWS'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ipsec-interfaces interface <span class="string">'eth0'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS compression <span class="string">'disable'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS lifetime <span class="string">'3600'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS mode <span class="string">'tunnel'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS pfs <span class="string">'enable'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS proposal 1 encryption <span class="string">'aes128'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS proposal 1 <span class="built_in">hash</span> <span class="string">'sha1'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS dead-peer-detection action <span class="string">'restart'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS dead-peer-detection interval <span class="string">'10'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS dead-peer-detection timeout <span class="string">'30'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti0 address <span class="string">'169.254.70.182/30'</span></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti0 description <span class="string">'VPC tunnel 1'</span></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti0 mtu <span class="string">'1436'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> protocols bgp 65000 neighbor 169.254.70.181 remote-as <span class="string">'64512'</span></span><br><span class="line"><span class="built_in">set</span> protocols bgp 65000 neighbor 169.254.70.181 address-family ipv4-unicast soft-reconfiguration inbound</span><br><span class="line"><span class="built_in">set</span> protocols bgp 65000 neighbor 169.254.70.181 timers holdtime <span class="string">'30'</span></span><br><span class="line"><span class="built_in">set</span> protocols bgp 65000 neighbor 169.254.70.181 timers keepalive <span class="string">'10'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 52.78.188.212 authentication mode <span class="string">'pre-shared-secret'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 52.78.188.212 authentication pre-shared-secret <span class="string">'MfmyxlydtXvvC2FLGmBsqMQlW5q89Z0S'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 52.78.188.212 description <span class="string">'VPC tunnel 2'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 52.78.188.212 ike-group <span class="string">'AWS'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 52.78.188.212 <span class="built_in">local</span>-address <span class="string">'10.100.1.198'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 52.78.188.212 vti <span class="built_in">bind</span> <span class="string">'vti1'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer 52.78.188.212 vti esp-group <span class="string">'AWS'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti1 address <span class="string">'169.254.50.254/30'</span></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti1 description <span class="string">'VPC tunnel 2'</span></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti1 mtu <span class="string">'1436'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> protocols bgp 65000 neighbor 169.254.50.253 remote-as <span class="string">'64512'</span></span><br><span class="line"><span class="built_in">set</span> protocols bgp 65000 neighbor 169.254.50.253 address-family ipv4-unicast soft-reconfiguration inbound</span><br><span class="line"><span class="built_in">set</span> protocols bgp 65000 neighbor 169.254.50.253 timers holdtime <span class="string">'30'</span></span><br><span class="line"><span class="built_in">set</span> protocols bgp 65000 neighbor 169.254.50.253 timers keepalive <span class="string">'10'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> protocols bgp 65000 address-family ipv4-unicast network 10.100.0.0/16</span><br><span class="line"></span><br><span class="line">commit</span><br><span class="line">save</span><br></pre></td></tr></table></figure></div></details><br><ul><li><p>VPN ê´€ë ¨ Tunnel, Interface, IP ë¥¼ í‘œí˜„</p><p>  <img src="/images/VPN-SitetoSite-with-Dynamic-Route/Untitled3.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Dynamic%20Route%20BGP%2005b6a5e86b864ae6b876cae1b8184477/Untitled%203.png"></p></li></ul><hr><br><h3 id="4-Verify-Site-to-Site-VPN"><a href="#4-Verify-Site-to-Site-VPN" class="headerlink" title="4. Verify Site to Site VPN"></a>4. Verify Site to Site VPN</h3><br><p>4.1 <code>ì„œìš¸</code> Region ì˜ VPN ì •ë³´ í™•ì¸</p><ul><li><p>VPN Tunnel 2ê°œì˜ ìƒíƒœê°€ ì •ìƒ ì‘ë™ì„ í™•ì¸ , ì„¸ë¶€ì •ë³´ì—ì„œ VYOS ì—ì„œ  BGPë¡œ 1ê°œì˜ ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­ì„ ê´‘ê³ í•´ì„œ ì•Œì•„ì™”ìŒì„ í™•ì¸</p><p>  <img src="/images/VPN-SitetoSite-with-Dynamic-Route/2020-05-07-02.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Dynamic%20Route%20BGP%2005b6a5e86b864ae6b876cae1b8184477/_2020-05-07__10.45.34.png"></p></li></ul><br><p>4.2 <code>ì‹±ê°€í´</code> Region ì˜ VYOS ì—ì„œ VPN ì •ë³´ í™•ì¸</p><ul><li><p>Tunnel ì¸í„°í˜ì´ìŠ¤(= vti0, vti1) ì •ë³´ í™•ì¸ ë° VPN ìƒíƒœ í™•ì¸ ë° ë¼ìš°íŒ… í…Œì´ë¸” í™•ì¸, VPN Tunnel IP ë¡œ ping í…ŒìŠ¤íŠ¸</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VYOS ì˜ ê°€ìƒì˜ í„°ë„ ì¸í„°í˜ì´ìŠ¤ ì •ë³´ë¥¼ í™• </span></span><br><span class="line">$ show interfaces vti</span><br><span class="line">Codes: S - State, L - Link, u - Up, D - Down, A - Admin Down</span><br><span class="line">Interface        IP Address                        S/L  Description</span><br><span class="line">---------        ----------                        ---  -----------</span><br><span class="line">vti0             169.254.70.182/30                 u/u  VPC tunnel 1</span><br><span class="line">vti1             169.254.50.254/30                 u/u  VPC tunnel 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># AWS ë‚´ë¶€IP(í„°ë„IP)ì™€ ping í†µì‹  í™•ì¸</span></span><br><span class="line">$ ping 169.254.70.181</span><br><span class="line">64 bytes from 169.254.70.181: icmp_seq=1 ttl=254 time=103 ms</span><br><span class="line">$ ping 169.254.50.253</span><br><span class="line">64 bytes from 169.254.50.253: icmp_seq=1 ttl=254 time=103 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># VYOS ì˜ VPN IPsec ìƒíƒœ ì •ë³´ í™•ì¸ ë° í•´ë‹¹ í„°ë„ì„ í†µí•œ íŠ¸ë˜í”½ í†µê³„ í™•ì¸</span></span><br><span class="line">$ show vpn ipsec sa</span><br><span class="line">Connection                     State    Uptime    Bytes In/Out    Packets In/Out    Remote address    Remote ID    Proposal</span><br><span class="line">-----------------------------  -------  --------  --------------  ----------------  ----------------  -----------  ----------------------------------</span><br><span class="line">peer-52.78.188.212-tunnel-vti  up       8m23s     4K/6K           62/112            52.78.188.212     N/A          AES_CBC_128/HMAC_SHA1_96/MODP_1024</span><br><span class="line">peer-15.164.80.217-tunnel-vti  up       8m23s     5K/6K           84/110            15.164.80.217     N/A          AES_CBC_128/HMAC_SHA1_96/MODP_1024</span><br><span class="line"></span><br><span class="line"><span class="comment"># VYOS ì¥ë¹„ì˜ ë¼ìš°íŒ… í…Œì´ë¸”ì„ í™•ì¸, AWS VGWì— ì—°ê²°ëœ VPCëŒ€ì—­ì— ëŒ€í•œ ë¼ìš°íŒ… ì •ë³´ í™•ì¸</span></span><br><span class="line">$ show ip route</span><br><span class="line">..</span><br><span class="line">S&gt;* 0.0.0.0/0 [210/0] via 10.100.1.1, eth0, 00:52:07</span><br><span class="line">B&gt;* 10.50.0.0/16 [20/100] via 169.254.50.253, vti1, 00:08:31</span><br><span class="line">C&gt;* 10.100.1.0/24 is directly connected, eth0, 00:52:08</span><br><span class="line">C&gt;* 10.100.100.0/24 is directly connected, eth1, 00:47:21</span><br><span class="line">C&gt;* 169.254.50.252/30 is directly connected, vti1, 00:08:33</span><br><span class="line">C&gt;* 169.254.70.180/30 is directly connected, vti0, 00:08:33</span><br><span class="line"></span><br><span class="line"><span class="comment"># VYOSì™€ VGW ê°„ BGP ì •ë³´ í™•ì¸, AWS Tunnel1ê³¼2ì—ì„œ ê°ê° Metric(=MED) 100ê³¼ 200ìœ¼ë¡œ ì¸ì…</span></span><br><span class="line">$ show ip bgp</span><br><span class="line">..</span><br><span class="line">   Network          Next Hop            Metric LocPrf Weight Path</span><br><span class="line">*&gt; 10.50.0.0/16     169.254.50.253         100             0 64512 i</span><br><span class="line">*                   169.254.70.181         200             0 64512 i</span><br><span class="line">*&gt; 10.100.0.0/16  0.0.0.0                  0         32768 i</span><br><span class="line"></span><br><span class="line">sh ip bgp summary</span><br><span class="line">sh ip bgp neighbors 169.254.X.Y advertised-routes</span><br><span class="line">sh ip bgp neighbors 169.254.X.Y received-routes</span><br><span class="line">sh ip bgp neighbors 169.254.X.Y routes</span><br></pre></td></tr></table></figure></li></ul><br><p>4.3 <code>ì‹±ê°€í´</code> ë‚´ë¶€ ëŒ€ì—­ì˜ Route Table ì„¤ì •</p><ul><li><p>[VPC - Route Tables] VPCIDC1 VYOS Internal Subnet Route Table ì„ íƒ í›„ [ë¼ìš°íŒ… í¸ì§‘]ìœ¼ë¡œ ì¶”ê°€</p><ul><li><p>10.50.0.0/16 , Network Interface â†’ VYOS Eth1 í›„ <code>ë¼ìš°íŒ… ì €ì¥</code></p><p>  <img src="/images/VPN-SitetoSite-with-Dynamic-Route/2020-05-07-03.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Dynamic%20Route%20BGP%2005b6a5e86b864ae6b876cae1b8184477/_2020-05-07__10.57.18.png"></p></li></ul></li></ul><br><p>4.4 <code>ì„œìš¸</code> Subnetì— Route Table ì„¤ì •</p><ul><li><p>[VPC - Route Tables] VPCAWS Subnet Route Table ì„ íƒ í›„ [ë¼ìš°íŒ… ì „íŒŒ í¸ì§‘]ìœ¼ë¡œ ì¶”ê°€</p><ul><li><p>ì „íŒŒ ì„ íƒ í›„ <code>ì €ì¥</code></p><p>  <img src="/images/VPN-SitetoSite-with-Dynamic-Route/2020-05-06-01.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Dynamic%20Route%20BGP%2005b6a5e86b864ae6b876cae1b8184477/_2020-05-06__3.44.45.png"></p></li><li><p>ë¼ìš°íŒ… í…Œì´ë¸”ì„ í™•ì¸í•˜ë©´ ìë™ìœ¼ë¡œ ì¶”ê°€ë˜ì–´ ìˆë‹¤</p><p>  <img src="/images/VPN-SitetoSite-with-Dynamic-Route/2020-05-07-04.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Dynamic%20Route%20BGP%2005b6a5e86b864ae6b876cae1b8184477/_2020-05-07__11.05.44.png"></p></li></ul></li></ul><br><p>4.5 ì „ì²´ ë¼ìš°íŒ… ìƒíƒœ í™•ì¸</p><ul><li><p><code>ì„œìš¸</code> Region ê²½ìš° ì‹±ê°€í´ VPCëŒ€ì—­ì¸ 10.100.0.0/16 ì„VGW ë¡œ ë³´ëƒ„</p><p>  â†’ ì´í›„ VGW ëŠ” VPN Tunnel ì„ í†µí•´ VYOS eth0 ìœ¼ë¡œ ë³´ëƒ„</p></li><li><p><code>ì‹±ê°€í´</code> Region ê²½ìš° ë‚´ë¶€ëŒ€ì—­(10.100.100.0/24)ì—ì„œ ì„œìš¸ VPCëŒ€ì—­ì¸ 10.50.0.0/16 ì„ VYOS eth1 ìœ¼ë¡œ ë³´ëƒ„</p><p>  â†’ ì´í›„ VYOSëŠ” 10.50.0.0/16 ì„ vti0, vti1 ì¦‰ VPN Tunnel ì„ í†µí•´ VGW ë¡œ ë³´ëƒ„</p><p>  <img src="/images/VPN-SitetoSite-with-Dynamic-Route/Untitled4.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Dynamic%20Route%20BGP%2005b6a5e86b864ae6b876cae1b8184477/Untitled%204.png"></p></li></ul><br><p>4.6 í†µì‹  í™•ì¸</p><ul><li><p>ì„œìš¸ EC2 ì—ì„œ ì‹±ê°€í´ EC2 ë¡œ ping í†µì‹ , ssh ì ‘ì†ì„ í™•ì¸</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-50-1-175 ~]$ ping -c 1 10.100.100.192</span><br><span class="line">PING 10.100.100.192 (10.100.100.192) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.100.100.192: icmp_seq=1 ttl=254 time=103 ms</span><br><span class="line"></span><br><span class="line">$ ssh root@10.100.100.192</span><br><span class="line">root@10.100.100.192<span class="string">'s password:</span></span><br><span class="line"><span class="string">..</span></span><br><span class="line"><span class="string">[root@ip-10-100-100-192 ~]#</span></span><br></pre></td></tr></table></figure></li><li><p>ìœ„ ping í†µì‹  ì‹œë„ ì‹œ, VYOS ì—ì„œ icmp íŒ¨í‚· í™•ì¸</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vyos@ip-10-100-1-198:~$ sudo tcpdump -i any -nn icmp</span><br><span class="line">..</span><br><span class="line">02:08:35.528632 IP 10.100.100.192 &gt; 10.50.1.175: ICMP <span class="built_in">echo</span> reply, id 32455, seq 14, length 64</span><br><span class="line">02:08:36.529260 IP 10.50.1.175 &gt; 10.100.100.192: ICMP <span class="built_in">echo</span> request, id 32455, seq 15, length 64</span><br><span class="line">..</span><br></pre></td></tr></table></figure></li></ul><br><p>4.7 CloudWatch ëª¨ë‹ˆí„°ë§ ì„¤ì •</p><ul><li><p><code>ì„œìš¸</code> Region [CloudWatch - ëŒ€ì‹œë³´ë“œ ìƒì„±] : ì´ë¦„(VPN)</p><ul><li><p>ìœ„ì ¯ ì¶”ê°€</p><ul><li><p>ìœ í˜• : í–‰</p><ul><li>ì§€í‘œ : VPN í„°ë„ ì§€í‘œ â†’ (VPN Tunnel 1 IP ì…ë ¥ í›„ ê²€ìƒ‰ í›„) TunnelState  ì„ íƒ<ul><li>ê·¸ë˜í”„ë¡œ í‘œì‹œëœ ì§€í‘œ : ë ˆì´ë¸”(VPN Tunnel 1 State), í†µê³„(ìµœì†Œ), ê¸°ê°„(1ë¶„)<ul><li>ê·¸ë˜í”„ì˜µì…˜ : ìœ„ì ¯ ìœ í˜•(ëˆ„ì  ë©´ì )<ul><li>ìƒë‹¨(ì‚¬ìš©ìì§€ì • - 30ë¶„, í˜„ì§€ì‹œê°„ëŒ€)</li><li>ìš°ì¸¡ í•˜ë‹¨ <code>ìœ„ì ¯ ìƒì„±</code></li></ul></li></ul></li></ul></li></ul></li><li><p>ìœ í˜• : í–‰</p><ul><li>ì§€í‘œ : VPN í„°ë„ ì§€í‘œ â†’ (VPN Tunnel 2 IP ì…ë ¥ í›„ ê²€ìƒ‰ í›„) TunnelState  ì„ íƒ<ul><li>ê·¸ë˜í”„ë¡œ í‘œì‹œëœ ì§€í‘œ : ìƒ‰ìƒ(ë³€ê²½), ë ˆì´ë¸”(VPN Tunnel 2 State), í†µê³„(ìµœì†Œ), ê¸°ê°„(1ë¶„)<ul><li>ê·¸ë˜í”„ì˜µì…˜ : ìœ„ì ¯ ìœ í˜•(ëˆ„ì  ë©´ì )<ul><li>ìƒë‹¨(ì‚¬ìš©ìì§€ì • - 30ë¶„, í˜„ì§€ì‹œê°„ëŒ€)</li><li>ìš°ì¸¡ í•˜ë‹¨ <code>ìœ„ì ¯ ìƒì„±</code></li></ul></li></ul></li></ul></li></ul></li><li><p>ìœ í˜• : í–‰</p><ul><li>ì§€í‘œ : VPN í„°ë„ ì§€í‘œ â†’ (VPN Tunnel 1 IP ì…ë ¥ í›„ ê²€ìƒ‰ í›„) TunnelDataIn, TunnelDataOut ì„ íƒ<ul><li>ê·¸ë˜í”„ë¡œ í‘œì‹œëœ ì§€í‘œ : ìƒë‹¨(VPN Tunnel 1 Data In/Out), í†µê³„(í•©ê³„), ê¸°ê°„(1ë¶„)<ul><li>ê·¸ë˜í”„ì˜µì…˜ : ìœ„ì ¯ ìœ í˜•(ëˆ„ì  ë©´ì )<ul><li>ìƒë‹¨(ì‚¬ìš©ìì§€ì • - 30ë¶„, í˜„ì§€ì‹œê°„ëŒ€)</li><li>ìš°ì¸¡ í•˜ë‹¨ <code>ìœ„ì ¯ ìƒì„±</code></li></ul></li></ul></li></ul></li></ul></li><li><p>ìœ í˜• : í–‰</p><ul><li>ì§€í‘œ : VPN í„°ë„ ì§€í‘œ â†’ (VPN Tunnel 2 IP ì…ë ¥ í›„ ê²€ìƒ‰ í›„) TunnelDataIn, TunnelDataOut ì„ íƒ<ul><li>ê·¸ë˜í”„ë¡œ í‘œì‹œëœ ì§€í‘œ : ìƒë‹¨(VPN Tunnel 2 Data In/Out), í†µê³„(í•©ê³„), ê¸°ê°„(1ë¶„)<ul><li>ê·¸ë˜í”„ì˜µì…˜ : ìœ„ì ¯ ìœ í˜•(ëˆ„ì  ë©´ì )<ul><li>ìƒë‹¨(ì‚¬ìš©ìì§€ì • - 30ë¶„, í˜„ì§€ì‹œê°„ëŒ€)</li><li>ìš°ì¸¡ í•˜ë‹¨ <code>ìœ„ì ¯ ìƒì„±</code></li></ul></li></ul></li></ul></li></ul></li><li><p>ìƒë‹¨ - <code>ëŒ€ì‹œë³´ë“œ ì €ì¥</code></p><p>  <img src="/images/VPN-SitetoSite-with-Dynamic-Route/Untitled5.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Dynamic%20Route%20BGP%2005b6a5e86b864ae6b876cae1b8184477/Untitled%205.png"></p></li></ul></li></ul></li></ul><hr><br><h3 id="5-VPN-Failover-Test"><a href="#5-VPN-Failover-Test" class="headerlink" title="5. VPN Failover Test"></a>5. VPN Failover Test</h3><br><p>5.1 <code>ì‹±ê°€í´</code> Region ì˜ VYOS ì¬ë¶€íŒ… í›„ í™•ì¸</p><ul><li><p><code>ì„œìš¸</code> Region ì˜ ë‚´ë¶€ EC2 ì—ì„œ ping ì‹¤í–‰</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ping -i 1 -W 1 10.100.100.192</span><br></pre></td></tr></table></figure></li><li><p>VYOS ì¸ìŠ¤í„´ìŠ¤ ì¬ë¶€íŒ…</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vyos@ip-10-100-1-198:~$ reboot now</span><br></pre></td></tr></table></figure></li><li><p><code>ì„œìš¸</code> Region ì˜ ë‚´ë¶€ EC2 ì—ì„œ ping ê²°ê³¼ í™•ì¸</p><ul><li><p>82 - 23 = 59ê°œë¡œ ëŒ€ëµ 59ì´ˆ(=ëŒ€ëµ 1ë¶„) ì •ë„ì˜ ì ˆì²´ì‹œê°„ì´ ìˆì—ˆë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ping -i 1 -W 1 10.100.100.192</span><br><span class="line">PING 10.100.100.192 (10.100.100.192) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.100.100.192: icmp_seq=1 ttl=254 time=104 ms</span><br><span class="line">..</span><br><span class="line">^C</span><br><span class="line">--- 10.100.100.192 ping statistics ---</span><br><span class="line">82 packets transmitted, 23 received, 71% packet loss, time 82429ms</span><br><span class="line">rtt min/avg/max/mdev = 103.895/104.418/105.911/0.503 ms</span><br></pre></td></tr></table></figure></li></ul></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL3Zwbi9sYXRlc3QvczJzdnBuL21vbml0b3JpbmctY2xvdWR3YXRjaC12cG4uaHRtbA==">CloudWatch ëª¨ë‹ˆí„°ë§<i class="fa fa-external-link-alt"></i></span>ì„ í™•ì¸ : 2ê°œ Tunnel State ê°€ 0 ìœ¼ë¡œ ë‹¤ìš´ë˜ê³  ì •ìƒì´ ë˜ì—ˆë‹¤, íŠ¸ë˜í”½ì€ ì—¬ì „íˆ Tunnel 2 ë¥¼ ì‚¬ìš© ì¤‘ì´ë‹¤</p><p>  <img src="/images/VPN-SitetoSite-with-Dynamic-Route/2020-05-07-05.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Dynamic%20Route%20BGP%2005b6a5e86b864ae6b876cae1b8184477/_2020-05-07__11.36.58.png"></p></li></ul><br><p>5.2 í˜„ì¬ Active VPN Tunnel ì„ Down í›„ í™•ì¸</p><ul><li><p>í˜„ì¬ í†µì‹ ì— ì‚¬ìš©ë˜ëŠ” VPN Tunnel ì„ ê°•ì œë¡œ Down í•˜ì—¬ ë‹¤ë¥¸ VPN Tunnel ì‚¬ìš© ì‹œë¥¼ í…ŒìŠ¤íŠ¸ í•´ë³¸ë‹¤</p><p>  <img src="/images/VPN-SitetoSite-with-Dynamic-Route/Untitled6.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Dynamic%20Route%20BGP%2005b6a5e86b864ae6b876cae1b8184477/Untitled%206.png"></p></li><li><p><code>ì„œìš¸</code> Region ì˜ ë‚´ë¶€ EC2 ì—ì„œ ping ì‹¤í–‰</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ping -i 1 -W 1 10.100.100.192</span><br></pre></td></tr></table></figure></li><li><p>VYOS ì—ì„œ í„°ë„ ì •ë³´ë¥¼ í™•ì¸ í›„ í•´ë‹¹ í„°ë„ë¡œ ë§ºí˜€ìˆëŠ” BGP ë„¤ì´ë²„ë¥¼ ê°•ì œë¡œ Shutdown í•œë‹¤</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ show ip route</span><br><span class="line">B&gt;* 10.50.0.0/16 [20/100] via 169.254.50.253, vti1, 00:00:12</span><br><span class="line"></span><br><span class="line">$ show vpn ipsec sa</span><br><span class="line">Connection                     State    Uptime    Bytes In/Out    Packets In/Out    Remote address    Remote ID    Proposal</span><br><span class="line">-----------------------------  -------  --------  --------------  ----------------  ----------------  -----------  ----------------------------------</span><br><span class="line">peer-52.78.188.212-tunnel-vti  up       15m29s    75K/84K         943/1K            52.78.188.212     N/A          AES_CBC_128/HMAC_SHA1_96/MODP_1024</span><br><span class="line">peer-15.164.80.217-tunnel-vti  up       15m29s    13K/11K         190/194           15.164.80.217     N/A          AES_CBC_128/HMAC_SHA1_96/MODP_1024</span><br><span class="line"></span><br><span class="line">conf</span><br><span class="line"><span class="built_in">set</span> protocols bgp 65000 neighbor 169.254.50.253 shutdown</span><br><span class="line">commit</span><br><span class="line">save</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">$ show ip route</span><br><span class="line">..</span><br><span class="line">B&gt;* 10.50.0.0/16 [20/100] via 169.254.70.181, vti0, 00:04:37</span><br></pre></td></tr></table></figure></li><li><p><code>ì„œìš¸</code> Region ì˜ ë‚´ë¶€ EC2 ì—ì„œ ping ê²°ê³¼ í™•ì¸</p><ul><li><p>22 - 21 = 1ê°œë¡œ ëŒ€ëµ 1ì´ˆ ì´ë‚´ì— ì ˆì²´ì‹œê°„ì´ ìˆì—ˆë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ping -i 1 -W 1 10.100.100.192</span><br><span class="line">PING 10.100.100.192 (10.100.100.192) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.100.100.192: icmp_seq=1 ttl=254 time=104 ms</span><br><span class="line">..</span><br><span class="line">^C</span><br><span class="line">--- 10.100.100.192 ping statistics ---</span><br><span class="line">22 packets transmitted, 21 received, 4% packet loss, time 21029ms</span><br><span class="line">rtt min/avg/max/mdev = 104.003/104.743/105.439/0.621 ms</span><br></pre></td></tr></table></figure></li></ul></li><li><p>CloudWatch ëª¨ë‹ˆí„°ë§ì„ í™•ì¸ : Tunnel 2 ê°€ Down ë˜ìë§ˆì ë°”ë¡œ Tunnel 1 ë¡œ ë°ì´í„° íŠ¸ë˜í”½ í†µì‹ ì„ ì‚¬ìš©í–ˆë‹¤.</p><p>  <img src="/images/VPN-SitetoSite-with-Dynamic-Route/2020-05-07-06.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Dynamic%20Route%20BGP%2005b6a5e86b864ae6b876cae1b8184477/_2020-05-07__11.55.13.png"></p></li></ul><hr><br><h3 id="6-Delete-Infrastructure"><a href="#6-Delete-Infrastructure" class="headerlink" title="6. Delete Infrastructure"></a>6. Delete Infrastructure</h3><ul><li><code>ì‹±ê°€í´</code> Region ì˜ CloudFormation Stack ì‚­ì œ</li><li><code>ì„œìš¸</code> Region ì˜ CloudFormation Stack ì‚­ì œ</li><li><code>ì„œìš¸</code> Region ì˜ CloudWatch ëŒ€ì‹œë³´ë“œ ì‚­ì œ</li></ul><br>]]></content:encoded>
      
      <comments>http://cloudneta.github.io/2020/05/07/VPN-SitetoSite-with-Dynamic-Route/#disqus_thread</comments>
    </item>
    
    <item>
      <title>AWS VPN Site to Site with Static Route</title>
      <link>http://cloudneta.github.io/2020/05/07/VPN-SitetoSite-with-Static-Route/</link>
      <guid>http://cloudneta.github.io/2020/05/07/VPN-SitetoSite-with-Static-Route/</guid>
      <pubDate>Thu, 07 May 2020 09:29:01 GMT</pubDate>
      <description>
      
        &lt;p&gt;&lt;em&gt;ì‘ì„±ì : gasida.cloudnet@&lt;/em&gt;&lt;/p&gt;
      
      </description>
      
      
      <content:encoded><![CDATA[<p><em>ì‘ì„±ì : gasida.cloudnet@</em></p><a id="more"></a><br><details><summary>AWS Document Link</summary><div markdown="1"><ul><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL3Zwbi9sYXRlc3QvczJzdnBuL1ZQQ19WUE4uaHRtbA==">Site-to-Site VPN User Guide<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL3ZwYy9sYXRlc3QvYWRtaW5ndWlkZS9XZWxjb21lLmh0bWw=">Site-to-Site VPN Network Administrator Guide<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93aWtpLnZ5b3MubmV0L3dpa2kvVXNlcl9HdWlkZQ==">VYOS User Guide<i class="fa fa-external-link-alt"></i></span></li></ul></div></details><hr><br><h3 id="1-AWS-VPN-Site-to-Site-with-Static-Route"><a href="#1-AWS-VPN-Site-to-Site-with-Static-Route" class="headerlink" title="1. AWS VPN Site to Site with Static Route"></a>1. AWS VPN Site to Site with Static Route</h3><br><p>1.1 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL3Zwbi9sYXRlc3QvczJzdnBuL1ZQQ19WUE4uaHRtbA==">AWS Site-to-Site VPN<i class="fa fa-external-link-alt"></i></span></p><ul><li>AWS Site-to-Site VPN(S2S VPN) ì€ Amazon VPC ë§ê³¼ ì™¸ë¶€ë§(ex. ê¸°ì—…ë§ ë“±) ì•ˆì „í•œ ì—°ê²°ì„ í•´ì£¼ëŠ” ê²ƒì„ ë§í•¨</li><li>ì£¼ìš” ìš©ì–´<ul><li>VPN ì—°ê²° : ì˜¨í”„ë ˆë¯¸ìŠ¤ ì¥ë¹„(ex. ê¸°ì—…ë§ VPNì¥ë¹„)ì™€ Amazon VPC ê°„ì˜ ë³´ì•ˆ ì—°ê²°</li><li>VPN í„°ë„ : AWS VPC ë„¤íŠ¸ì›Œí¬ì™€ ì˜¨í”„ë ˆë¯¸ìŠ¤ ë„¤íŠ¸ì›Œí¬ ê°„ ì£¼ê³  ë°›ì„ ìˆ˜ ìˆëŠ” ì•”í˜¸í™”ëœ ë§í¬<ul><li>ê³ ê°€ìš©ì„±ì„ ìœ„í•´ì„œ 2ê°œì˜ í„°ë„ì„ ì œê³µí•¨</li></ul></li><li>ê³ ê° ê²Œì´íŠ¸ì›¨ì´ : ì˜¨í”„ë ˆë¯¸ìŠ¤ ì¥ë¹„(ex. ê¸°ì—…ë§ VPNì¥ë¹„)ì— ëŒ€í•œ ì •ë³´ë¥¼ ë§í•¨<ul><li>AWS VGW ì— ì„¤ì •ì„ ìœ„í•´ì„œ ì§€ì •í•¨ (ex. ì˜¨í”„ë ˆë¯¸ìŠ¤ VPN ì¥ë¹„ì˜ IP ë“±)</li></ul></li><li>ê³ ê° ê²Œì´íŠ¸ì›¨ì´ ë””ë°”ì´ìŠ¤ : ì˜¨í”„ë ˆë¯¸ìŠ¤ ì¥ë¹„(ex. ê¸°ì—…ë§ VPNì¥ë¹„) í˜¹ì€ ì†Œí”„íŠ¸ì›¨ì–´ ì• í”Œë¦¬ì¼€ì´ì…˜</li></ul></li><li>ì œì•½ì‚¬í•­ : IPv6 íŠ¸ë˜í”½ ë¯¸ì§€ì›, AWS VPN ì—°ê²° ì‹œ Path MTU discovery ë¯¸ì§€ì› (â†’ MTU ì„¤ì •ì„ ë§ì¶œ ê²ƒì„ ê¶Œì¥)</li></ul><br><p>1.2 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL3Zwbi9sYXRlc3QvczJzdnBuL1ZQQ19WUE4uaHRtbA==">AWS S2S ì‘ë™ ë°©ì‹<i class="fa fa-external-link-alt"></i></span></p><ul><li>AWS VGW ì™€ TGW ì—ì„œ ë™ì‘í•©ë‹ˆë‹¤</li></ul><p><em>AWS VGW(=ê°€ìƒ í”„ë¼ì´ë¹— ê²Œì´íŠ¸ì›¨ì´)</em></p><p><img src="/images/VPN-SitetoSite-with-Static-Route/Untitled.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/Untitled.png"></p><p><em>AWS Transit GW(=ì „ì†¡ ê²Œì´íŠ¸ì›¨ì´)</em></p><p><img src="/images/VPN-SitetoSite-with-Static-Route/Untitled1.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/Untitled%201.png"></p><ul><li><p>S2S VPN Tunnel ì€ 2ê°œê°€ ìˆìœ¼ë©°, í¼ë¸”ë¦­ IPì£¼ì†Œê°€ ê° í„°ë„ì— ì‚¬ìš©ëœë‹¤.</p><ul><li><p>VGWëŠ” í„°ë„ì— ëŒ€í•´ ë‘ê°œì˜ Tunnel Endpointë¥¼ ì œê³µ</p></li><li><p>IPsec tunnels ê³¼ BGP sessions ëŠ” í•­ìƒ ê³ ê°ì¸¡(CGW)ì—ì„œ ì‹œì‘í•œë‹¤</p></li><li><p>ê³ ê°€ìš©ì„±ì„ ìœ„í•´ì„œ ë‘ í„°ë„ ë°˜ë“œì‹œ ëª¨ë‘ êµ¬ì„±í•´ì•¼ í•œë‹¤.</p></li><li><p>íŠ¹íˆ AWS VGW ì •ê¸° ìœ ì§€ ê´€ë¦¬ ì‹œ ìˆœì°¨ì ìœ¼ë¡œ í„°ë„ì´ ë¹„í™œì„±í™” ëœë‹¤</p><p>  â†’ ğŸš§ í•„ìê°€ AWS VPN ìš´ì˜ ì‹œ ì—ë„ ë§¤ë‹¬ 26~28ì¼ ì‚¬ì´ì— Tunnel1, Tunnel 2 ê°€ ì‹œê°„ì°¨ë¥¼ ë‘ê³  Down ë˜ì—ˆì—ˆë‹¤</p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS8vdnBuL3NpdGUtdG8tc2l0ZS12cG4tc2xhLw==">AWS S2S VPN SLA<i class="fa fa-external-link-alt"></i></span> ëŠ” 99.95% ì…ë‹ˆë‹¤. â†’ í•œ ë‹¬ 5ë¶„ 2ì´ˆëŠ” ê³„ì•½ ìƒ ìœ ì§€ ê´€ë¦¬ ë“±ì„ ìœ„í•´ì„œ ë¹„í™œì„±í™”ê°€ ë˜ì–´ë„â€¦</p><p>  <img src="/images/VPN-SitetoSite-with-Static-Route/2020-05-07-01.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/_2020-05-07__2.01.22.png"><br><span class="exturl" data-url="aHR0cHM6Ly91cHRpbWUuaXMv">https://uptime.is/<i class="fa fa-external-link-alt"></i></span> ì°¸ê³ </p></li></ul></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL3Zwbi9sYXRlc3QvczJzdnBuL3lvdXItY2d3Lmh0bWw=">CGW (=ê³ ê° ê²Œì´íŠ¸ì›¨ì´)<i class="fa fa-external-link-alt"></i></span> ëŠ” ê³ ê° ì¸¡ì— ìˆëŠ” ë¬¼ë¦¬ì  ë˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ì–´í”Œë¼ì´ì–¸ìŠ¤ì´ë‹¤.</p><ul><li><p>CGWê°€ 1ëŒ€ì˜ ì¥ë¹„ë¼ë©´ ë…¼ë¦¬ì ì¸ í„°ë„ ì¸í„°í˜ì´ìŠ¤ 2ê°œë¥¼ ì„¤ì •í•˜ì—¬ AWS VPN Tunnel 1,2 ì™€ ì—°ê²° ì„¤ì •í•œë‹¤</p><p>  <img src="/images/VPN-SitetoSite-with-Static-Route/Untitled2.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/Untitled%202.png"></p></li></ul></li><li><p>ì„œë¡œ í†µì‹ ì„ ìœ„í•œ ë¼ìš°íŒ…ì€ <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL3Zwbi9sYXRlc3QvczJzdnBuL2Nndy1zdGF0aWMtcm91dGluZy1leGFtcGxlcy5odG1s">Static<i class="fa fa-external-link-alt"></i></span> ê³¼ <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL3Zwbi9sYXRlc3QvczJzdnBuL2Nndy1keW5hbWljLXJvdXRpbmctZXhhbXBsZXMuaHRtbA==">Dynamic(BGP)<i class="fa fa-external-link-alt"></i></span> ë¥¼ ì§€ì›í•œë‹¤.</p></li></ul><br><p>1.3 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL3Zwbi9sYXRlc3QvczJzdnBuL3NpdGUtc2l0ZS1hcmNoaXRlY2h0dXJlcy5odG1s">S2S VPN ì•„í‚¤í…ì²˜<i class="fa fa-external-link-alt"></i></span></p><ul><li><p>AWS VGW â€”-(S2S VPN) â€”- IDC(CGW)</p><p>  <img src="/images/VPN-SitetoSite-with-Static-Route/Untitled3.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/Untitled%203.png"></p></li><li><p>AWS TGW â€”-(S2S VPN) â€”- IDC(CGW) : VGW ê°€ ì•„ë‹Œ Transit Gateway(TGW)ê°€ VPN ì—°ê²°ë˜ëŠ” ì¢…ë‹¨ì  ì—­í• </p><p>  <img src="/images/VPN-SitetoSite-with-Static-Route/Untitled4.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/Untitled%204.png"></p></li><li><p>ë‹¤ì¤‘ S2S VPN ì—°ê²° : ì—¬ëŸ¬ê°œì˜ ê³ ê° VPN ë§ì´ ì—°ê²° ë˜ëŠ” êµ¬ì„± í™˜ê²½</p><p>  <img src="/images/VPN-SitetoSite-with-Static-Route/Untitled5.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/Untitled%205.png"></p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL3Zwbi9sYXRlc3QvczJzdnBuL3Zwbi1yZWR1bmRhbnQtY29ubmVjdGlvbi5odG1s">S2S VPN ì´ì¤‘í™”ë¥¼ í†µí•œ ê³ ê°€ìš©ì„± êµ¬ì„±<i class="fa fa-external-link-alt"></i></span></p><ul><li><p>1ì•ˆ : CGW ê°€ ì´ì¤‘í™” êµ¬ì„±ì´ë‚˜ í´ëŸ¬ìŠ¤í„° ë™ì‘ì´ ì•„ë‹Œ A-S ë™ì‘ì¸ ê²½ìš° ë‘ê°œì˜ CGW ë¥¼ ë‘ ê°œì˜ VGWì— ì—°ê²°</p><ul><li><p>AWS S2S VGW ë¥¼ 2ê°œë¥¼ ìƒì„±í•˜ê³  ê³ ê°ì¸¡ ì¥ë¹„ë„ 2ëŒ€ë¥¼ êµ¬ì„±í•˜ë©° BGP ë¡œ ê°ê° ë‚´ë¶€ë§ì„ ê´‘ê³ í•˜ëŠ” í˜•íƒœ</p><p><img src="/images/VPN-SitetoSite-with-Static-Route/Untitled6.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/Untitled%206.png"></p></li></ul></li></ul></li><li><p>2ì•ˆ : CGW ê°€ 2ëŒ€ë¡œ ì´ì¤‘í™” êµ¬ì„±ì—ì„œ í´ëŸ¬ìŠ¤í„°ë¡œ ë™ì‘ ì‹œ(ë…¼ë¦¬ì ìœ¼ë¡œ 1ëŒ€)ì—ëŠ” 1ê°œì˜ VGW ì— ê° í„°ë„ ì—”ë“œí¬ì¸íŠ¸ë¡œ ëª¨ë‘ ì—°ê²°</p><ul><li><p>AWS S2S VGW ë¥¼ 1ê°œë§Œ ìƒì„±í•˜ì—¬ ê³ ê°ì¸¡ ì¥ë¹„ì˜ ë…¼ë¦¬1ëŒ€ì˜ ë°©í™”ë²½(ì‹¤ì œ ë¬¼ë¦¬ ë°©í™”ë²½ 2ëŒ€)ìœ¼ë¡œ ì—°ê²°</p><p><img src="/images/VPN-SitetoSite-with-Static-Route/Untitled7.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/Untitled%207.png"></p></li></ul></li></ul><br><p>1.4 VPN Performance</p><ul><li><p>VGW 1ê°œ Tunnel ì€ 1.25Gbps Throughput ì„±ëŠ¥ì„ ê°€ì§</p><p>  â†’ <span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9ibG9ncy9uZXR3b3JraW5nLWFuZC1jb250ZW50LWRlbGl2ZXJ5L3NjYWxpbmctdnBuLXRocm91Z2hwdXQtdXNpbmctYXdzLXRyYW5zaXQtZ2F0ZXdheS8=">TGW ì˜ ECMP ë¥¼ ì‚¬ìš© ì‹œ í•˜ì—¬ Throughput ì„±ëŠ¥ í–¥ìƒ<i class="fa fa-external-link-alt"></i></span>ì„ í•  ìˆ˜ ìˆìŒ</p></li></ul><hr><br><h3 id="2-AWS-VPN-Site-to-Site-with-Static-Route-Lab-Preview"><a href="#2-AWS-VPN-Site-to-Site-with-Static-Route-Lab-Preview" class="headerlink" title="2. AWS VPN Site to Site with Static Route Lab Preview"></a>2. AWS VPN Site to Site with Static Route Lab Preview</h3><br><p>2.1 Lab Topology</p><ul><li><p><code>ì„œìš¸, ì‹±ê°€í´</code> Regionì— ê°ê° AWS í™˜ê²½ê³¼, IDC í™˜ê²½(ê°€ì •)ìœ¼ë¡œ êµ¬ì„±</p><ul><li>IDC í™˜ê²½ì€ ì‹¤ì œ AWS ì˜ì—­ì´ ì•„ë‹ˆë¼ ì¼ë°˜ ê¸°ì—… ë¬¼ë¦¬ë§ì´ì§€ë§Œ ì‹¤ìŠµì˜ í¸ë¦¬ì„±ì„ ìœ„í•´ì„œ AWS í™˜ê²½ì—ì„œ êµ¬ì„±í•¨</li></ul></li><li><p><code>ì„œìš¸</code> Region ì€ AWS VGWë¥¼ ë°°ì¹˜í•˜ê³  Public Subnet ì— í…ŒìŠ¤íŠ¸ ìš©ë„ì˜ EC2ë¥¼ ë°°ì¹˜í•¨</p></li><li><p><code>ì‹±ê°€í´</code> Region (IDCí™˜ê²½)ì€ VPN ì—­í• ì„ VYOS(ì»¤ë®¤ë‹ˆí‹°AMI)ë¡œ í•˜ë©° Private Subnetì— í…ŒìŠ¤íŠ¸ ìš©ë„ì˜ EC2ë¥¼ ë°°ì¹˜í•¨</p><p>  <img src="/images/VPN-SitetoSite-with-Static-Route/Untitled8.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/Untitled%208.png"></p></li></ul><blockquote><p>ğŸ’¡ VYOSëŠ” ë¦¬ëˆ…ìŠ¤(Debian) ê¸°ë°˜ì— ë¼ìš°íŒ…, ë°©í™”ë²½, VPN ê¸°ëŠ¥ì„ ì œê³µí•˜ì—¬ VPN ì—­í• ë¡œ ì„ íƒí•¨. <span class="exturl" data-url="aHR0cHM6Ly93aWtpLnZ5b3MubmV0L3dpa2kvVXNlcl9HdWlkZQ==">ì°¸ê³  ë§í¬<i class="fa fa-external-link-alt"></i></span></p></blockquote><br><p>2.2 ê¸°ë³¸ ì„¤ì •</p><ul><li>ë³¸ ì‹¤ìŠµì—ì„œ í™œìš©í•  AWS Regionì€ <code>ì„œìš¸, ì‹±ê°€í´</code> ì…ë‹ˆë‹¤. í•´ë‹¹ Regionì— ëŒ€í•œ <em>EC2-Key Pair</em>ë¥¼ ìƒì„±</li><li><code>ì‹œë“œë‹ˆ, ìƒíŒŒìš¸ë£¨</code> Region ì— ë¦¬ì†ŒìŠ¤ëŠ” <em>CloudFormation</em>ì— ì˜í•´ 2.1 ê·¸ë¦¼ì˜ ì¸í”„ë¼ë¥¼ ìë™ êµ¬ì¶• (2.3í•­ì—ì„œ ì§„í–‰)</li></ul><br><p>2.3 CloudFormation (Infrastructure as Code)</p><details><summary><b>ì‹±ê°€í´ Regionì—ì„œ CloudFormation ìŠ¤íƒì„ ìƒì„±í•œë‹¤.</summary></b><div markdown="1"><ul><li>1ë‹¨ê³„ í…œí”Œë¦¿ ì§€ì •<ul><li>í…œí”Œë¦¿ ì¤€ë¹„ : ì¤€ë¹„ëœ í…œí”Œë¦¿</li><li>í…œí”Œë¦¿ ì†ŒìŠ¤ : Amazon S3 URL</li><li>Amazon S3 URL : <span class="exturl" data-url="aHR0cHM6Ly9zMy5hcC1ub3J0aGVhc3QtMi5hbWF6b25hd3MuY29tL2Nsb3VkZm9ybWF0aW9uLmNsb3VkbmV0YS5uZXQvVlBOL2dhc2lkYV92cG5faWRjMS55YW1s">https://s3.ap-northeast-2.amazonaws.com/cloudformation.cloudneta.net/VPN/gasida_vpn_idc1.yaml<i class="fa fa-external-link-alt"></i></span><ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ë‹¤ìŒ</code> í´ë¦­</li></ul></li></ul></li><li>2ë‹¨ê³„ ìŠ¤íƒ ì„¸ë¶€ ì •ë³´ ì§€ì •<ul><li>ìŠ¤íƒ ì´ë¦„ : VPN-IDC</li><li>KeyName : ìì‹ ì˜ <em>EC2-Key Pair</em> ë¥¼ ì§€ì •<ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ë‹¤ìŒ</code> í´ë¦­</li></ul></li></ul></li><li>3ë‹¨ê³„ ìŠ¤íƒ ì˜µì…˜ êµ¬ì„±<ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ë‹¤ìŒ</code> í´ë¦­</li></ul></li><li>4ë‹¨ê³„ ê²€í† <ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ìŠ¤íƒ ìƒì„±</code> í´ë¦­</li></ul></li></ul></div></details><details><summary><b>ì‹±ê°€í´ Regionì—ì„œ CloudFormation ìŠ¤íƒ ìƒì„± ì™„ë£Œ í›„ (5ë¶„ ì •ë„ ì†Œìš”) ì¶œë ¥ì—ì„œ VYOSInstancePublicIP ì˜ ê°’(IP)ë¥¼ í™•ì¸í•œë‹¤.</summary></b><div markdown="1"><p><img src="/images/VPN-SitetoSite-with-Static-Route/2020-05-06-01.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/_2020-05-06__1.32.13.png"></p></div></details><details><summary><b>ì„œìš¸ Regionì—ì„œ CloudFormation ìŠ¤íƒì„ ìƒì„±í•œë‹¤.</summary></b><div markdown="1"><ul><li>1ë‹¨ê³„ í…œí”Œë¦¿ ì§€ì •<ul><li>í…œí”Œë¦¿ ì¤€ë¹„ : ì¤€ë¹„ëœ í…œí”Œë¦¿</li><li>í…œí”Œë¦¿ ì†ŒìŠ¤ : Amazon S3 URL</li><li>Amazon S3 URL : <span class="exturl" data-url="aHR0cHM6Ly9zMy5hcC1ub3J0aGVhc3QtMi5hbWF6b25hd3MuY29tL2Nsb3VkZm9ybWF0aW9uLmNsb3VkbmV0YS5uZXQvVlBOL2dhc2lkYV92cG5fYXdzLnlhbWw=">https://s3.ap-northeast-2.amazonaws.com/cloudformation.cloudneta.net/VPN/gasida_vpn_aws.yaml<i class="fa fa-external-link-alt"></i></span><ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ë‹¤ìŒ</code> í´ë¦­</li></ul></li></ul></li><li>2ë‹¨ê³„ ìŠ¤íƒ ì„¸ë¶€ ì •ë³´ ì§€ì •<ul><li>ìŠ¤íƒ ì´ë¦„ : VPN-AWS</li><li>KeyName : ìì‹ ì˜ <em>EC2-Key Pair</em> ë¥¼ ì§€ì •</li><li>StaticRoutesOnlyForVPN : true â† AWS VPN ì™€ IDC VPN ê°„ Static Route ì„¤ì •ì„ í•  ì˜ˆì •ì´ë¯€ë¡œ</li><li>VPCAWSCustomerGatewayIP : 54.255.135.113 â† ìœ„ ì‹±ê°€í´ì—ì„œ ìŠ¤íƒ ì¶œë ¥ì—ì„œ VYOSInstancePublicIP ê°’<ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ë‹¤ìŒ</code> í´ë¦­</li></ul></li></ul></li><li>3ë‹¨ê³„ ìŠ¤íƒ ì˜µì…˜ êµ¬ì„±<ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ë‹¤ìŒ</code> í´ë¦­</li></ul></li><li>4ë‹¨ê³„ ê²€í† <ul><li>ìš°ì¸¡ í•˜ë‹¨ <code>ìŠ¤íƒ ìƒì„±</code> í´ë¦­</li></ul></li></ul></div></details><ul><li>CloudFormationì— ì˜í•´ ìƒì„±ë˜ëŠ” ë¦¬ì†ŒìŠ¤ëŠ” ì•„ë˜ì™€ ê°™ìœ¼ë©°, ê° Region ë³„ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.</li></ul><details><summary>ì‹±ê°€í´ CloudFormation ìƒì„± ì¸í”„ë¼</summary><div markdown="1"><pre><code>- VPC, 2 Subnet, IGW, 2 Route table- EIP, VYOS EC2 Instance (eth0, eth1)- Amazon Linux 2 EC2 Instance (Testìš©)</code></pre></div></details><details><summary>ì„œìš¸ CloudFormation ìƒì„± ì¸í”„ë¼</summary><div markdown="1"><pre><code>- VPC, 2 Subnet, IGW, 2 Route table- VGW, CGW, VPN Connection- EIP, Amazon Linux 2 EC2 Instance (Testìš©)</code></pre></div></details><br><blockquote><p>ğŸ’¡ ì‹¤ë¬´ì—ì„œì˜ AWS VGW ì™€ ì—°ê²° ì‹œ IDC ìœ„ì¹˜í•œ VPN(ì˜ˆ. VYOS)ì„¤ì •ì€ ë³´í†µ â€˜IDC ë„¤íŠ¸ì›Œí¬(í˜¹ì€ ë³´ì•ˆ) ì—”ì§€ë‹ˆì–´â€™ ê°€ ì„¤ì •ì„ í•˜ê²Œ ë˜ì–´ì„œ ê°œë°œì ë¶„ë“¤ì˜ ê²½ìš° ì•„ë˜ Lab ë”°ë¼í•˜ê¸°ê°€ ì–´ë ¤ìš´ ë¶€ë¶„ì´ ìˆë‹¤. ê·¸ë˜ì„œ VYOS ê´€ë ¨ ì„¤ì •ê³¼ IDC1ì— ê´€ë ¨ ì„¤ì •ì€ toggle â€˜â–¶ï¸â€™ ì ‘ì–´ ë‘ì—ˆë‹¤. í•„ìš” ì‹œ toggle í´ë¦­í•˜ì—¬ ìƒì„¸íˆ ë‚´ìš©ì„ ë³´ì‹œê¸° ë°”ë€ë‹¤. VYOS ë‚´ìš©ì„ ì œì™¸í•œ AWS VPN ê´€ë ¨ ì„¤ì • ë‚´ìš©ì„ ìœ„ì£¼ë¡œ ë³´ì‹œë©´ ëœë‹¤.</p></blockquote><br><p>2.4 ê²€ì¦</p><ul><li><p>ì‚¬ìš©ì PCì—ì„œ <code>ì‹±ê°€í´</code> VYOS Public IP ì£¼ì†Œë¡œ SSH ì ‘ê·¼í•œë‹¤. ì¶”ê°€ë¡œ VYOS ì¸í„°í˜ì´ìŠ¤ ì„¤ì •ì„ í•œë‹¤.</p><ul><li><p>VYOS ì„¤ì • ëª¨ë“œ(conf) ë¡œ ì§„ì…í•´ì„œ VYOS eth1 IP(ìŠ¤íƒ ì¶œë ¥ VYOSInstanceINTERNALPrivateIP í™•ì¸)ëŠ” ì„¤ì • í›„ ì ìš©í•œë‹¤.</p></li><li><p>Private Subnet ì— ìˆëŠ” Test EC2 IP ë¡œ ping ë° SSH ì ‘ê·¼í•œë‹¤. ì ‘ì† ê³„ì • root / qwe123</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ìì‹ ì˜ VYOSInstanceINTERNALPrivateIP ë¡œ SSH ì ‘ì†</span></span><br><span class="line">ssh -i <span class="string">'*EC2-Key Pair'</span>* vyos@54.255.135.113</span><br><span class="line">..</span><br><span class="line"></span><br><span class="line"><span class="comment"># í•´ë‹¹ AMI ì´ë¯¸ì§€ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ eth1 IP ê°€ ë¯¸ì„¤ì • ë˜ì–´ ìˆë‹¤</span></span><br><span class="line">vyos@ip-10-100-1-19:~$ show interfaces</span><br><span class="line">Codes: S - State, L - Link, u - Up, D - Down, A - Admin Down</span><br><span class="line">Interface        IP Address                        S/L  Description</span><br><span class="line">---------        ----------                        ---  -----------</span><br><span class="line">eth0             10.100.1.19/24                    u/u</span><br><span class="line">eth1             -                                 u/u</span><br><span class="line">..</span><br><span class="line"></span><br><span class="line"><span class="comment"># VYOS ì„¤ì •ëª¨ë“œ(conf)ë¡œ ì§„ì…í•˜ì—¬ eth1ì˜ IPë¥¼ ì„¤ì • í›„ ì ìš©ê³¼ ì €ì¥ì„ í•œë‹¤</span></span><br><span class="line">vyos@ip-10-100-1-19$ conf</span><br><span class="line">vyos@ip-10-100-1-19<span class="comment"># set interfaces ethernet eth1 address 10.100.100.210/24</span></span><br><span class="line">vyos@ip-10-100-1-19<span class="comment"># commit</span></span><br><span class="line">vyos@ip-10-100-1-19<span class="comment"># exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># VYOSì—ì„œ ë‚´ë¶€ì— ìˆëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤ë¡œ ping í…ŒìŠ¤íŠ¸ë¥¼ í•œë‹¤</span></span><br><span class="line">vyos@ip-10-100-1-19:~$ ping 10.100.100.252</span><br><span class="line">PING 10.100.100.252 (10.100.100.252) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.100.100.252: icmp_seq=1 ttl=255 time=0.600 ms</span><br><span class="line">..</span><br><span class="line"></span><br><span class="line"><span class="comment"># VYOSì—ì„œ ë‚´ë¶€ì— ìˆëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤ë¡œ SSH ì ‘ì† í™•ì¸ì„ í•œë‹¤.</span></span><br><span class="line">vyos@ip-10-100-1-19:~$ ssh root@10.100.100.252</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ì‚¬ìš©ì PCì—ì„œ <code>ì„œìš¸</code> EC2 Instance EIP ì£¼ì†Œë¡œ SSH ì ‘ê·¼í•œë‹¤. ì ‘ì† ê³„ì • root / qwe123</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@15.165.117.201</span><br></pre></td></tr></table></figure></li><li><p>ì°¸ê³ ë¡œ CloudFormationì— ì˜í•´ ë¦¬ì†ŒìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ì˜¬ë¼ì˜¤ê¸° ê¹Œì§€ ì•½ê°„ì˜ ì‹œê°„ì´ í•„ìš”í•˜ë‹ˆ ì¼ì • ì‹œê°„ ëŒ€ê¸°ê°€ í•„ìš”í•˜ë‹¤.</p></li></ul><blockquote><p>ğŸ’¡ ë³¸ê²©ì ì¸ ì‹¤ìŠµì— ì•ì„œ, Site to Site VPN ë¦¬ì†ŒìŠ¤ëŠ” ì†ŒëŸ‰ì˜ ê³¼ê¸ˆì´ ë¶ˆê°€í”¼ í•˜ë‹¤. (VPN ì—°ê²° ì‹œê°„ ë‹¨ìœ„ ìš”ê¸ˆ ë¶€ê³¼ - ì‹œê°„ ë‹¹ $0.05 ë“±)<br>ìì„¸í•œ ì‚¬í•­ì€ <span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9nbG9iYWwtYWNjZWxlcmF0b3IvcHJpY2luZy9odHRwczovL2F3cy5hbWF6b24uY29tL2tvL3Zwbi9wcmljaW5nLw==">ìš”ê¸ˆ ë§í¬<i class="fa fa-external-link-alt"></i></span>ë¥¼ ì°¸ê³  ë°”ë€ë‹¤.</p></blockquote><hr><br><h3 id="3-Configuration-Site-to-Site-VPN"><a href="#3-Configuration-Site-to-Site-VPN" class="headerlink" title="3. Configuration Site to Site VPN"></a>3. Configuration Site to Site VPN</h3><br><p>3.1 <code>ì„œìš¸</code> Region ì˜ VPN ì •ë³´ í™•ì¸</p><ul><li><p>VPN Tunnel 1 ê³¼  Tunnel 2 ì˜ ì™¸ë¶€IPì™€  ë‚´ë¶€IP CIDRì„ í™•ì¸ í•œë‹¤.</p><p>  <img src="/images/VPN-SitetoSite-with-Static-Route/Untitled9.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/Untitled%209.png"></p></li></ul><br><p>3.2 <code>ì„œìš¸</code> Region ì˜ ê³ ê° VPN ì¥ë¹„ ì„¤ì •ì„ ìœ„í•œ êµ¬ì„± ë‹¤ìš´ë¡œë“œ í›„ <code>ì‹±ê°€í´</code> Region ì— VYOS ì— VPN Config ì„¤ì •</p><ul><li><p>ğŸ’ğŸ»â€â™‚ï¸ VPN êµ¬ì„± ë‹¤ìš´ë¡œë“œ?  AWS VGW ì— ì—°ê²°ë˜ëŠ” ê³ ê°VPN ì¥ë¹„(ê³µê¸‰ì—…ì²´ ë³„)ì˜ VPN ê´€ë ¨ ì„¤ì •ì„ AWS ì—ì„œ ì œê³µ</p></li><li><p>[AWS VPN ì‚¬ì´íŠ¸ ê°„ VPN ì—°ê²° - êµ¬ì„± ë‹¤ìš´ë¡œë“œ] ì„ íƒ í›„ Generic ì„ íƒ í›„ <code>ë‹¤ìš´ë¡œë“œ</code></p><ul><li><p>ë‹¤ìš´ë¡œë“œ íŒŒì¼ ì˜ˆì‹œ</p><p>  <a href="/images/VPN-SitetoSite-with-Static-Route/vpn-006dfdf3f4989c4df.txt">vpn-006dfdf3f4989c4df.txt</a></p></li></ul></li><li><p>ë‹¤ìš´ ë°›ì€ config íŒŒì¼ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì•„ë˜ ìƒ˜í”Œ VYOS VPN Config ì— ë³€ê²½ í›„ VYOS ì— ì ìš©í•œë‹¤</p></li></ul><details><summary>ìƒ˜í”Œ VYOS VPN Config</summary><div markdown="1"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS lifetime <span class="string">'28800'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS proposal 1 dh-group <span class="string">'2'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS proposal 1 encryption <span class="string">'aes128'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS proposal 1 <span class="built_in">hash</span> <span class="string">'sha1'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ipsec-interfaces interface <span class="string">'eth0'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS compression <span class="string">'disable'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS lifetime <span class="string">'3600'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS mode <span class="string">'tunnel'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS pfs <span class="string">'enable'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS proposal 1 encryption <span class="string">'aes128'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS proposal 1 <span class="built_in">hash</span> <span class="string">'sha1'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS dead-peer-detection action <span class="string">'restart'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS dead-peer-detection interval <span class="string">'10'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS dead-peer-detection timeout <span class="string">'30'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'IPSec Tunnel #1 ì˜ Virtual Private Gateway IP'</span> authentication mode <span class="string">'pre-shared-secret'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'IPSec Tunnel #1 ì˜ Virtual Private Gateway IP'</span> authentication pre-shared-secret <span class="string">'IPSec Tunnel #1 ì˜ Pre-Shared Key'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'IPSec Tunnel #1 ì˜ Virtual Private Gateway IP'</span> description <span class="string">'VPC tunnel 1'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'IPSec Tunnel #1 ì˜ Virtual Private Gateway IP'</span> ike-group <span class="string">'AWS'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'IPSec Tunnel #1 ì˜ Virtual Private Gateway IP'</span> <span class="built_in">local</span>-address <span class="string">'VYOS Eth0 IP (EIPê°€ ì•„ë‹˜)'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'IPSec Tunnel #1 ì˜ Virtual Private Gateway IP'</span> vti <span class="built_in">bind</span> <span class="string">'vti0'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'IPSec Tunnel #1 ì˜ Virtual Private Gateway IP'</span> vti esp-group <span class="string">'AWS'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti0 address <span class="string">'IPSec Tunnel #1 ì˜ Customer Gateway ì˜ Inside IP Addresses'</span></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti0 description <span class="string">'VPC tunnel 1'</span></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti0 mtu <span class="string">'1436'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'IPSec Tunnel #2 ì˜ Virtual Private Gateway IP'</span> authentication mode <span class="string">'pre-shared-secret'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'IPSec Tunnel #2 ì˜ Virtual Private Gateway IP'</span> authentication pre-shared-secret <span class="string">'IPSec Tunnel #2 ì˜ Pre-Shared Key'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'IPSec Tunnel #2 ì˜ Virtual Private Gateway IP'</span> description <span class="string">'VPC tunnel 2'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'IPSec Tunnel #2 ì˜ Virtual Private Gateway IP'</span> ike-group <span class="string">'AWS'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'IPSec Tunnel #2 ì˜ Virtual Private Gateway IP'</span> <span class="built_in">local</span>-address <span class="string">'VYOS Eth0 IP (EIPê°€ ì•„ë‹˜)'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'IPSec Tunnel #2 ì˜ Virtual Private Gateway IP'</span> vti <span class="built_in">bind</span> <span class="string">'vti1'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'IPSec Tunnel #2 ì˜ Virtual Private Gateway IP'</span> vti esp-group <span class="string">'AWS'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti1 address <span class="string">'IPSec Tunnel #2 ì˜ Customer Gateway ì˜ Inside IP Addresses'</span></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti1 description <span class="string">'VPC tunnel 2'</span></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti1 mtu <span class="string">'1436'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> protocols static interface-route <span class="string">'VPNìœ¼ë¡œ í†µì‹ í•´ì•¼ ë  AWS VPN ë‚´ë¶€ ëŒ€ì—­'</span> next-hop-interface <span class="string">'vti0'</span></span><br><span class="line"><span class="built_in">set</span> protocols static interface-route <span class="string">'VPNìœ¼ë¡œ í†µì‹ í•´ì•¼ ë  AWS VPN ë‚´ë¶€ ëŒ€ì—­'</span> next-hop-interface <span class="string">'vti1'</span></span><br><span class="line"></span><br><span class="line">commit</span><br><span class="line">save</span><br></pre></td></tr></table></figure></div></details><details><summary>ë³€ê²½ ì ìš© í•œ VYOS VPN Config â†’ VYOS conf ëª¨ë“œì— ë³µì‚¬ ë¶™ì—¬ë„£ê¸°ë¥¼ í•œë‹¤</summary><div markdown="1"><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">conf</span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS lifetime <span class="string">'28800'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS proposal 1 dh-group <span class="string">'2'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS proposal 1 encryption <span class="string">'aes128'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS proposal 1 <span class="built_in">hash</span> <span class="string">'sha1'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ipsec-interfaces interface <span class="string">'eth0'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS compression <span class="string">'disable'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS lifetime <span class="string">'3600'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS mode <span class="string">'tunnel'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS pfs <span class="string">'enable'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS proposal 1 encryption <span class="string">'aes128'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec esp-group AWS proposal 1 <span class="built_in">hash</span> <span class="string">'sha1'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS dead-peer-detection action <span class="string">'restart'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS dead-peer-detection interval <span class="string">'10'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec ike-group AWS dead-peer-detection timeout <span class="string">'30'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'13.209.231.134'</span> authentication mode <span class="string">'pre-shared-secret'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'13.209.231.134'</span> authentication pre-shared-secret <span class="string">'bIben5l33KgXpzShJdwNKlO3rG3ryq01'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'13.209.231.134'</span> description <span class="string">'VPC tunnel 1'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'13.209.231.134'</span> ike-group <span class="string">'AWS'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'13.209.231.134'</span> <span class="built_in">local</span>-address <span class="string">'10.100.1.19'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'13.209.231.134'</span> vti <span class="built_in">bind</span> <span class="string">'vti0'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'13.209.231.134'</span> vti esp-group <span class="string">'AWS'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti0 address <span class="string">'169.254.191.154/30'</span></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti0 description <span class="string">'VPC tunnel 1'</span></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti0 mtu <span class="string">'1436'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'15.164.154.116'</span> authentication mode <span class="string">'pre-shared-secret'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'15.164.154.116'</span> authentication pre-shared-secret <span class="string">'abs4CQtJ63ryaw9KaFiix12_us7Vje.r'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'15.164.154.116'</span> description <span class="string">'VPC tunnel 2'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'15.164.154.116'</span> ike-group <span class="string">'AWS'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'15.164.154.116'</span> <span class="built_in">local</span>-address <span class="string">'10.100.1.19'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'15.164.154.116'</span> vti <span class="built_in">bind</span> <span class="string">'vti1'</span></span><br><span class="line"><span class="built_in">set</span> vpn ipsec site-to-site peer <span class="string">'15.164.154.116'</span> vti esp-group <span class="string">'AWS'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti1 address <span class="string">'169.254.213.202/30'</span></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti1 description <span class="string">'VPC tunnel 2'</span></span><br><span class="line"><span class="built_in">set</span> interfaces vti vti1 mtu <span class="string">'1436'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> protocols static interface-route <span class="string">'10.50.0.0/16'</span> next-hop-interface <span class="string">'vti0'</span></span><br><span class="line"><span class="built_in">set</span> protocols static interface-route <span class="string">'10.50.0.0/16'</span> next-hop-interface <span class="string">'vti1'</span></span><br><span class="line"></span><br><span class="line">commit</span><br><span class="line">save</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure></code></pre></div></details><ul><li><p>VPN ê´€ë ¨ Tunnel, Interface , IP ë¥¼ í‘œí˜„</p><p>  <img src="/images/VPN-SitetoSite-with-Static-Route/Untitled10.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/Untitled%2010.png"></p></li></ul><hr><br><h3 id="4-Verify-Site-to-Site-VPN"><a href="#4-Verify-Site-to-Site-VPN" class="headerlink" title="4. Verify Site to Site VPN"></a>4. Verify Site to Site VPN</h3><br><p>4.1 <code>ì„œìš¸</code> Region ì˜ VPN ì •ë³´ í™•ì¸</p><ul><li><p>VPN Tunnel 2ê°œì˜ ìƒíƒœê°€ ì •ìƒ ì‘ë™ì„ í™•ì¸</p><p>  <img src="/images/VPN-SitetoSite-with-Static-Route/2020-05-06-02.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/_2020-05-06__3.26.50.png"></p></li></ul><br><p>4.2 <code>ì‹±ê°€í´</code> Region ì˜ VYOS ì—ì„œ VPN ì •ë³´ í™•ì¸</p><details><summary>Tunnel ì¸í„°í˜ì´ìŠ¤(= vti0, vti1) ì •ë³´ í™•ì¸ ë° VPN ìƒíƒœ í™•ì¸ ë° ë¼ìš°íŒ… í…Œì´ë¸” í™•ì¸</summary><div markdown="1"><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VYOS ì˜ ê°€ìƒì˜ í„°ë„ ì¸í„°í˜ì´ìŠ¤ ì •ë³´ë¥¼ í™•ì¸</span></span><br><span class="line">$ sh interfaces vti</span><br><span class="line">Codes: S - State, L - Link, u - Up, D - Down, A - Admin Down</span><br><span class="line">Interface        IP Address                        S/L  Description</span><br><span class="line">---------        ----------                        ---  -----------</span><br><span class="line">vti0             169.254.191.154/30                u/u  VPC tunnel 1</span><br><span class="line">vti1             169.254.213.202/30                u/u  VPC tunnel 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># AWS ë‚´ë¶€IP(í„°ë„IP)ì™€ ping í†µì‹  í™•ì¸</span></span><br><span class="line">$ ping 169.254.191.153</span><br><span class="line">4 bytes from 169.254.191.153: icmp_seq=1 ttl=254 time=98.5 ms</span><br><span class="line">$ ping 169.254.213.201</span><br><span class="line">64 bytes from 169.254.213.201: icmp_seq=1 ttl=254 time=102 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># VYOS ì˜ VPN IPsec ìƒíƒœ ì •ë³´ í™•ì¸ ë° í•´ë‹¹ í„°ë„ì„ í†µí•œ íŠ¸ë˜í”½ í†µê³„ í™•ì¸</span></span><br><span class="line">$ show vpn ipsec sa</span><br><span class="line">Connection                      State    Uptime    Bytes In/Out    Packets In/Out    Remote address    Remote ID    Proposal</span><br><span class="line">------------------------------  -------  --------  --------------  ----------------  ----------------  -----------  ----------------------------------</span><br><span class="line">peer-15.164.154.116-tunnel-vti  up       14m12s    0B/0B           0/0               15.164.154.116    N/A          AES_CBC_128/HMAC_SHA1_96/MODP_1024</span><br><span class="line">peer-13.209.231.134-tunnel-vti  up       14m12s    0B/0B           0/0               13.209.231.134    N/A          AES_CBC_128/HMAC_SHA1_96/MODP_1024</span><br><span class="line"></span><br><span class="line"><span class="comment"># VYOS ì¥ë¹„ì˜ ë¼ìš°íŒ… í…Œì´ë¸”ì„ í™•ì¸, AWS VGWì— ì—°ê²°ëœ VPCëŒ€ì—­ì— ëŒ€í•œ ë¼ìš°íŒ… ì •ë³´ í™•ì¸</span></span><br><span class="line">$ sh ip route</span><br><span class="line">..</span><br><span class="line">S&gt;* 0.0.0.0/0 [210/0] via 10.100.1.1, eth0, 02:02:04</span><br><span class="line">S&gt;* 10.50.0.0/16 [1/0] is directly connected, vti0, 00:00:06</span><br><span class="line">  *                    is directly connected, vti1, 00:00:06</span><br><span class="line">C&gt;* 10.100.1.0/24 is directly connected, eth0, 02:02:05</span><br><span class="line">C&gt;* 10.100.100.0/24 is directly connected, eth1, 01:31:39</span><br><span class="line">C&gt;* 169.254.191.152/30 is directly connected, vti0, 00:17:41</span><br><span class="line">C&gt;* 169.254.213.200/30 is directly connected, vti1, 00:17:41</span><br><span class="line">..</span><br></pre></td></tr></table></figure></code></pre></div></details><br><p>4.3 <code>ì‹±ê°€í´</code> ë‚´ë¶€ ëŒ€ì—­ì˜ Route Table ì„¤ì •</p><details><summary>[VPC - Route Tables] VPCIDC1 VYOS Internal Subnet Route Table ì„ íƒ í›„ [ë¼ìš°íŒ… í¸ì§‘]ìœ¼ë¡œ ì¶”ê°€</summary><div markdown="1"><ul><li><p>10.50.0.0/16 , Network Interface â†’ VYOS Eth1 í›„ <code>ë¼ìš°íŒ… ì €ì¥</code></p><p>  <img src="/images/VPN-SitetoSite-with-Static-Route/2020-05-06-03.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/_2020-05-06__3.42.10.png"></p></li></ul></div></details><br><p>4.4 <code>ì„œìš¸</code> Subnetì— Route Table ì„¤ì •</p><ul><li><p>[AWS VPN ì‚¬ì´íŠ¸ ê°„ VPN ì—°ê²° - (í•˜ë‹¨) ì •ì  ë¼ìš°íŒ…] í¸ì§‘ í›„ 10.100.0.0/16 í›„ <code>ì €ì¥</code></p><p>  <img src="/images/VPN-SitetoSite-with-Static-Route/2020-05-06-04.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/_2020-05-06__3.47.59.png"></p></li><li><p>[VPC - Route Tables] VPCAWS Subnet Route Table ì„ íƒ í›„ [ë¼ìš°íŒ… ì „íŒŒ í¸ì§‘]ìœ¼ë¡œ ì¶”ê°€</p><ul><li><p>ì „íŒŒ ì„ íƒ í›„ <code>ì €ì¥</code></p><p>  <img src="/images/VPN-SitetoSite-with-Static-Route/2020-05-06-05.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/_2020-05-06__3.44.45.png"></p></li></ul></li></ul><br><p>4.5 ì „ì²´ ë¼ìš°íŒ… ìƒíƒœ í™•ì¸</p><ul><li><p><code>ì„œìš¸</code> Region ê²½ìš° ì‹±ê°€í´ VPCëŒ€ì—­ì¸ 10.100.0.0/16 ì„VGW ë¡œ ë³´ëƒ„</p><p>  â†’ ì´í›„ VGW ëŠ” VPN Tunnel ì„ í†µí•´ VYOS eth0 ìœ¼ë¡œ ë³´ëƒ„</p></li><li><p><code>ì‹±ê°€í´</code> Region ê²½ìš° ë‚´ë¶€ëŒ€ì—­(10.100.100.0/24)ì—ì„œ ì„œìš¸ VPCëŒ€ì—­ì¸ 10.50.0.0/16 ì„ VYOS eth1 ìœ¼ë¡œ ë³´ëƒ„</p><p>  â†’ ì´í›„ VYOSëŠ” 10.50.0.0/16 ì„ vti0, vti1 ì¦‰ VPN Tunnel ì„ í†µí•´ VGW ë¡œ ë³´ëƒ„</p><p>  <img src="/images/VPN-SitetoSite-with-Static-Route/Untitled11.png" alt="AWS%20VPN%20Site%20to%20Site%20with%20Static%20Route%2078d272b9998c46a4875aa9c090b80ccf/Untitled%2011.png"></p></li></ul><br><p>4.6 í†µì‹  í™•ì¸</p><ul><li><p>ì„œìš¸ EC2 ì—ì„œ ì‹±ê°€í´ EC2 ë¡œ ping í†µì‹ , ssh ì ‘ì†ì„ í™•ì¸</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-50-1-80 ~]$ ping -c 1 10.100.100.252</span><br><span class="line">PING 10.100.100.252 (10.100.100.252) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.100.100.252: icmp_seq=1 ttl=254 time=104 ms</span><br><span class="line"></span><br><span class="line">$ ssh root@10.100.100.252</span><br><span class="line">root@10.100.100.252<span class="string">'s password:</span></span><br><span class="line"><span class="string">..</span></span><br><span class="line"><span class="string">[root@ip-10-100-100-252 ~]#</span></span><br></pre></td></tr></table></figure></li></ul><details><summary>ìœ„ ping í†µì‹  ì‹œë„ ì‹œ, VYOS ì—ì„œ icmp íŒ¨í‚· í™•ì¸</summary><div markdown="1"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vyos@ip-10-100-1-19:~$ sudo tcpdump -i any -nn icmp</span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on any, link-type LINUX_SLL (Linux cooked), capture size 262144 bytes</span><br><span class="line">06:57:58.578074 IP 10.50.1.80 &gt; 10.100.100.252: ICMP <span class="built_in">echo</span> request, id 32561, seq 1, length 64</span><br><span class="line">06:57:58.578456 IP 10.100.100.252 &gt; 10.50.1.80: ICMP <span class="built_in">echo</span> reply, id 32561, seq 1, length 64</span><br></pre></td></tr></table></figure></div></details><hr><br><h3 id="5-Delete-Infrastructure"><a href="#5-Delete-Infrastructure" class="headerlink" title="5. Delete Infrastructure"></a>5. Delete Infrastructure</h3><ul><li><code>ì‹±ê°€í´</code> Region ì˜ CloudFormation Stack Delete</li><li><code>ì„œìš¸</code> Region ì˜ CloudFormation Stack Delete</li></ul><br>]]></content:encoded>
      
      <comments>http://cloudneta.github.io/2020/05/07/VPN-SitetoSite-with-Static-Route/#disqus_thread</comments>
    </item>
    
    <item>
      <title>LabGuide - AWS Global Accelerator</title>
      <link>http://cloudneta.github.io/2020/05/06/Accelerator/</link>
      <guid>http://cloudneta.github.io/2020/05/06/Accelerator/</guid>
      <pubDate>Wed, 06 May 2020 10:52:54 GMT</pubDate>
      <description>
      
        &lt;p&gt;&lt;em&gt;ì‘ì„±ì : ongja.cloudnet@&lt;/em&gt;&lt;/p&gt;
      
      </description>
      
      
      <content:encoded><![CDATA[<p><em>ì‘ì„±ì : ongja.cloudnet@</em></p><a id="more"></a><br><details><summary>AWS Global Accelerator ì°¸ê³  ë§í¬</summary><div markdown="1"><p><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9nbG9iYWwtYWNjZWxlcmF0b3IvP2Jsb2dzLWdsb2JhbC1hY2NlbGVyYXRvci5zb3J0LWJ5PWl0ZW0uYWRkaXRpb25hbEZpZWxkcy5jcmVhdGVkRGF0ZSZibG9ncy1nbG9iYWwtYWNjZWxlcmF0b3Iuc29ydC1vcmRlcj1kZXNjJmF3cy1nbG9iYWwtYWNjZWxlcmF0b3Itd24uc29ydC1ieT1pdGVtLmFkZGl0aW9uYWxGaWVsZHMucG9zdERhdGVUaW1lJmF3cy1nbG9iYWwtYWNjZWxlcmF0b3Itd24uc29ydC1vcmRlcj1kZXNj">Global Accelerator ê°œìš”<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9ibG9ncy9rb3JlYS9uZXctYXdzLWdsb2JhbC1hY2NlbGVyYXRvci1mb3ItYXZhaWxhYmlsaXR5LWFuZC1wZXJmb3JtYW5jZS8=">Global Accelertor ì†Œê°œ (AWS í•œêµ­ ë¸”ë¡œê·¸)<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2dsb2JhbC1hY2NlbGVyYXRvci9sYXRlc3QvZGcvd2hhdC1pcy1nbG9iYWwtYWNjZWxlcmF0b3IuaHRtbA==">Global Accelerator Developer Guide (ì„¤ëª…ì„œ)<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9ibG9ncy9uZXR3b3JraW5nLWFuZC1jb250ZW50LWRlbGl2ZXJ5L3RyYWZmaWMtbWFuYWdlbWVudC13aXRoLWF3cy1nbG9iYWwtYWNjZWxlcmF0b3Iv">Traffic management with AWS Global Accelerator<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9nbG9iYWwtYWNjZWxlcmF0b3IvcHJpY2luZy8=">Global Accelerator ìš”ê¸ˆ<i class="fa fa-external-link-alt"></i></span></p></div></details><blockquote><p>ğŸ’¡ AWS ì„œë¹„ìŠ¤ ê´€ë ¨í•´ì„œëŠ” í•­ìƒ ìµœìš°ì„ ìœ¼ë¡œ â€˜AWS ì„¤ëª…ì„œâ€™ë¥¼ ì½ì–´ë³´ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.<br>   í•œê¸€ ë²ˆì—­ì´ ë§¤ë„ëŸ½ì§€ ëª»í•˜ë©´ English ë¡œ ë³€ê²½ í›„ ì½ì–´ë³´ê¸¸ ë°”ë€ë‹¤.</p></blockquote><hr><br><h3 id="1-AWS-Global-Accelerator-Theory"><a href="#1-AWS-Global-Accelerator-Theory" class="headerlink" title="1. AWS Global Accelerator Theory"></a>1. AWS Global Accelerator Theory</h3><br><p><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9nbG9iYWwtYWNjZWxlcmF0b3IvP2Jsb2dzLWdsb2JhbC1hY2NlbGVyYXRvci5zb3J0LWJ5PWl0ZW0uYWRkaXRpb25hbEZpZWxkcy5jcmVhdGVkRGF0ZSZibG9ncy1nbG9iYWwtYWNjZWxlcmF0b3Iuc29ydC1vcmRlcj1kZXNjJmF3cy1nbG9iYWwtYWNjZWxlcmF0b3Itd24uc29ydC1ieT1pdGVtLmFkZGl0aW9uYWxGaWVsZHMucG9zdERhdGVUaW1lJmF3cy1nbG9iYWwtYWNjZWxlcmF0b3Itd24uc29ydC1vcmRlcj1kZXNj">1.1 AWS Global Accelerator ë€?<i class="fa fa-external-link-alt"></i></span></p><ul><li>AWS Global AcceleratorëŠ” ë¡œì»¬ ë˜ëŠ” ê¸€ë¡œë²Œ ì‚¬ìš©ìë¥¼ ëŒ€ìƒìœ¼ë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ê°€ìš©ì„±ê³¼ ì„±ëŠ¥ì„ ê°œì„ í•˜ëŠ” ì„œë¹„ìŠ¤ì´ë‹¤.</li><li>AWS Global AcceleratorëŠ” AWS ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì‚¬ìš©ìì—ì„œ ì–´í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì´ì–´ì§„ ê²½ë¡œë¥¼ ìµœì í™”í•˜ì—¬ íŠ¸ë˜í”½ì˜ ì„±ëŠ¥ì„ ê°œì„ í•œë‹¤.</li></ul><br><p><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9ibG9ncy9rb3JlYS9uZXctYXdzLWdsb2JhbC1hY2NlbGVyYXRvci1mb3ItYXZhaWxhYmlsaXR5LWFuZC1wZXJmb3JtYW5jZS8=">1.2 AWS Global Accelerator Key Words<i class="fa fa-external-link-alt"></i></span></p><ul><li><p><em>ê³ ì • Anycast IP</em> â€“ AWS Global AcceleratorëŠ” í•˜ë‚˜ ì´ìƒì˜ AWS ë¦¬ì „ì—ì„œ í˜¸ìŠ¤íŒ…ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ ê³ ì • ì§„ì…ì  ì—­í• ì„ í•˜ëŠ” ì •ì  IP ì£¼ì†Œë¥¼ ì‚¬ìš©í•œë‹¤. ì´ IP ì£¼ì†ŒëŠ” AWS ì—£ì§€ ë¡œì¼€ì´ì…˜ì—ì„œ í• ë‹¹ë˜ëŠ” Anycastì…ë‹ˆë‹¤. ì¦‰, ì´ IP ì£¼ì†Œê°€ ì—¬ëŸ¬ AWS ì—£ì§€ ë¡œì¼€ì´ì…˜ì—ì„œ ë°œí‘œë˜ë¯€ë¡œ íŠ¸ë˜í”½ì´ ì‚¬ìš©ìì—ê²Œ ìµœëŒ€í•œ ê°€ê¹Œìš´ ìœ„ì¹˜ì—ì„œ AWS ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ì— ì§„ì…í•  ìˆ˜ ìˆë‹¤.</p></li><li><p><em>AWSì˜ ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬</em> â€“ AWS Global Acceleratorë¥¼ í†µí•´ ë¼ìš°íŒ…ë˜ëŠ” íŠ¸ë˜í”½ì€ ê³µìš© ì¸í„°ë„·ì´ ì•„ë‹ˆë¼ AWS ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ë¥¼ ë”°ë¼ ì´ë™í•œë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” í´ë¼ì´ì–¸íŠ¸ ìœ„ì¹˜, ìƒíƒœ ê²€ì‚¬ ê²°ê³¼ ë° êµ¬ì„±ëœ ê°€ì¤‘ì¹˜ì— ë”°ë¼ ìµœì ì˜ ë¦¬ì „ìœ¼ë¡œ ë¼ìš°íŒ…ëœë‹¤.</p></li><li><p><em>í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ</em> â€“ AWS Global Acceleratorë¥¼ í™œìš©í•˜ë©´ í•„ìˆ˜ ìš”ê±´ìœ¼ë¡œ ìƒíƒœë¥¼ ì €ì¥í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ìƒíƒœ ì €ì¥ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì´ˆê¸° ì—°ê²° í›„ì— ë™ì¼í•œ EndPointë¡œ ì‚¬ìš©ìë¥¼ ë¼ìš°íŒ…í•œë‹¤. AWS Global AcceleratorëŠ” ì´ë¥¼ ìœ„í•´ í¬íŠ¸ì™€ í”„ë¡œí† ì½œì— ê´€ê³„ì—†ì´ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ìì˜ Source IP ìƒíƒœ ìœ ì§€ë¥¼ ìœ„í•œ ì‹ë³„ìë¡œ ì„¤ì •í•œë‹¤.</p></li><li><p><em>AWS Global Accelerator êµ¬ì„±</em></p><ul><li><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2dsb2JhbC1hY2NlbGVyYXRvci9sYXRlc3QvZGcvaW50cm9kdWN0aW9uLWNvbXBvbmVudHMuaHRtbA==">Listener<i class="fa fa-external-link-alt"></i></span> â€“ í”„ë¡œí† ì½œê³¼ í¬íŠ¸ë¥¼ ê¸°ë°˜í•˜ì—, AWS Global Acceleratorë¡œ ì¸ë°”ìš´ë“œ ì—°ê²°ì„ ì²˜ë¦¬í•˜ëŠ” Listenerë¥¼ êµ¬ì„±</p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2dsb2JhbC1hY2NlbGVyYXRvci9sYXRlc3QvZGcvaW50cm9kdWN0aW9uLWNvbXBvbmVudHMuaHRtbA==">EndPoint Group<i class="fa fa-external-link-alt"></i></span> â€“ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ë˜ëŠ” AWS ë¦¬ì „ì„ ì •ì˜</p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2dsb2JhbC1hY2NlbGVyYXRvci9sYXRlc3QvZGcvYWJvdXQtZW5kcG9pbnQtZ3JvdXBzLXRyYWZmaWMtZGlhbC5odG1s">Traffic Dial<i class="fa fa-external-link-alt"></i></span> â€“ EndPoint Groupì´ ìˆ˜ì‹  í•  ìˆ˜ìˆëŠ” íŠ¸ë˜í”½ì˜ ë¹„ìœ¨ì„ ì˜ë¯¸</p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2dsb2JhbC1hY2NlbGVyYXRvci9sYXRlc3QvZGcvaW50cm9kdWN0aW9uLWNvbXBvbmVudHMuaHRtbA==">EndPoint<i class="fa fa-external-link-alt"></i></span> â€“ EndPoint Groupì— ì—°ê²°ëœ EC2-Instance, Elastic IP, Network Load Balancer ë˜ëŠ” Application Load Balancerì´ë‹¤.</p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2dsb2JhbC1hY2NlbGVyYXRvci9sYXRlc3QvZGcvaW50cm9kdWN0aW9uLWNvbXBvbmVudHMuaHRtbA==">EndPoint Weight<i class="fa fa-external-link-alt"></i></span> â€“ ë‹¤ìˆ˜ì˜ EndPointê°€ ìˆëŠ” EndPoint Groupì—ì„œ ê°€ì¤‘ì¹˜ë¥¼ ë¶€ì—¬í•˜ì—¬ ë¶„ë°°</p></li></ul></li></ul><br><p>1.3 AWS Global Accelerator ì‘ë™ ë°©ì‹</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled.png"><br>ê·¸ë¦¼ 1-1 AWS Global Accelerator Diagram</p><ul><li>Edge Locationì—ì„œ ì•Œë¦¬ëŠ” 2ê°œì˜ ê³ ì • Anycast IP ì£¼ì†Œë¥¼ í†µí•´, ì‚¬ìš©ìì—ê²Œ ê°€ì¥ ê°€ê¹Œìš´ Edge Locationìœ¼ë¡œ íŠ¸ë˜í”½ì´ ì „ì†¡ëœë‹¤.</li><li>AWS ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ AWS Global Acceleratorë¡œ ìš”ì²­ì´ ë¼ìš°íŒ…ë˜ë©´, ê°€ì¥ ê°€ê¹Œìš´ ì •ìƒ ìƒíƒœì˜ EndPoint Groupì„ ì„ íƒí•˜ì—¬ ì„œë¹„ìŠ¤ í•œë‹¤.</li></ul><blockquote><p>ğŸ’¡ AWS Global Acceleratorì˜ í•µì‹¬ì€ ê³ ì • Anycast IPì„ ì œê³µí•˜ì—¬ ì‚¬ìš©ì ì…ì¥ì—ì„œ ê³ ì • IP ì£¼ì†Œë¡œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë©°, AWS ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ë¥¼ ê²½ìœ í•˜ì—¬ ì•ˆì •ì ì´ê³  ë¹ ë¥¸ ì„œë¹„ìŠ¤ê°€ ê°€ëŠ¥í•˜ëŠ” ì ì´ë‹¤.</p></blockquote><hr><br><h3 id="2-AWS-Global-Accelerator-Lab-Preview"><a href="#2-AWS-Global-Accelerator-Lab-Preview" class="headerlink" title="2. AWS Global Accelerator Lab Preview"></a>2. AWS Global Accelerator Lab Preview</h3><br><p>2.1 Lab Topology</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled1.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%201.png"></p><p>ê·¸ë¦¼ 2-1 AWS Global Accelerator Lab Topology</p><ul><li><code>ì‹œë“œë‹ˆ, ìƒíŒŒìš¸ë£¨</code> Regionì— Web ì„œë²„ìš© EC2-Instance 2ëŒ€ì”© ë°°ì¹˜</li><li>Global Acceleratorì—ì„œ HTTP ì„œë¹„ìŠ¤ì˜ ì¸ë°”ìš´ë“œ ì²˜ë¦¬ë¥¼ ìœ„í•œ Listenerë¥¼ êµ¬ì„±í•˜ê³ , 2ê°œì˜ Anycast IPë¥¼ í• ë‹¹</li><li>Global Acceleratorì—ì„œ ì‹œë“œë‹ˆ, ìƒíŒŒìš¸ë£¨ Regionì— ëŒ€í•œ EndPoint Groupì„ êµ¬ë¶„</li><li>EndPoint Groupì˜ EndPoint ì§€ì • (<code>ì‹œë“œë‹ˆ</code> : ALB, <code>ìƒíŒŒìš¸ë£¨</code> : EC2-Instance 2ëŒ€)</li><li><code>ì„œìš¸, ë²„ì§€ë‹ˆì•„</code> Regionì— Clientë¥¼ í†µí•´ ìƒì„±ëœ Anycast IPë¡œ Web ì ‘ê·¼í•˜ì—¬ ë™ì‘ í™•ì¸</li></ul><br><p>2.2 AWS ê¸°ë³¸ ì„¤ì •</p><ul><li>ë³¸ ì‹¤ìŠµì—ì„œ í™œìš©í•  AWS Regionì€ <code>ì„œìš¸, ë²„ì§€ë‹ˆì•„ë¶ë¶€, ì‹œë“œë‹ˆ, ìƒíŒŒìš¸ë£¨</code> ì´ë‹¤. í•´ë‹¹ Regionì— ëŒ€í•œ <em>EC2-Key Pair</em>ë¥¼ ìƒì„±</li><li><code>ì„œìš¸, ë²„ì§€ë‹ˆì•„ë¶ë¶€</code> Regionì€ í´ë¼ì´ì–¸íŠ¸ ì˜ì—­ìœ¼ë¡œ, ì‹¤ìŠµìš© <em>EC2-Instanceë¥¼ 1ëŒ€ì”© êµ¬ì¶•</em> (Default VPC ë‚´ EC2-Instance ìƒì„±)</li><li><code>ì‹œë“œë‹ˆ, ìƒíŒŒìš¸ë£¨</code> Regionì€ ì„œë¹„ìŠ¤ ì˜ì—­ìœ¼ë¡œ, <em>CloudFormation</em>ì— ì˜í•´ ì¸í”„ë¼ë¥¼ ìë™ êµ¬ì¶• (2.3í•­ì—ì„œ ì§„í–‰)</li></ul><br><p>2.3 CloudFormation (Infrastructure as Code)</p><p>â¤µ <span class="exturl" data-url="aHR0cHM6Ly9zMy5hcC1ub3J0aGVhc3QtMi5hbWF6b25hd3MuY29tL2Nsb3VkZm9ybWF0aW9uLmNsb3VkbmV0YS5uZXQvR0EvR2xvYmFsQWNjZWxlcmF0b3JfTGFiX0NGLnlhbWw=">Download GlobalAccelerator_Lab_CF.yaml<i class="fa fa-external-link-alt"></i></span></p><details><summary>GlobalAccelerator_Lab_CF.yaml Template Code View</summary><div markdown="1"><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">Parameters:</span><br><span class="line">  KeyName:</span><br><span class="line">    Description: Name of an existing EC2 KeyPair to enable SSH access to the instances. Linked to AWS Parameter</span><br><span class="line">    Type: AWS::EC2::KeyPair::KeyName</span><br><span class="line">    ConstraintDescription: must be the name of an existing EC2 KeyPair.</span><br><span class="line"></span><br><span class="line">Mappings:</span><br><span class="line">  AWSRegionArch2AMI:</span><br><span class="line">    ap-southeast-2:</span><br><span class="line">      HVM64: ami-dc361ebf</span><br><span class="line">    sa-east-1:</span><br><span class="line">      HVM64: ami-6dd04501</span><br><span class="line"></span><br><span class="line">Conditions:</span><br><span class="line">  CreateSydneyResources: !Equals [ !Ref &#39;AWS::Region&#39;, ap-southeast-2 ]</span><br><span class="line"></span><br><span class="line">Resources:</span><br><span class="line">  VPC01:</span><br><span class="line">    Type: AWS::EC2::VPC</span><br><span class="line">    Properties:</span><br><span class="line">     CidrBlock: 10.0.0.0&#x2F;16</span><br><span class="line">  InternetGateway0101:</span><br><span class="line">    Type: AWS::EC2::InternetGateway</span><br><span class="line">    Properties: &#123;&#125;</span><br><span class="line">  InternetGatewayAttachment0101:</span><br><span class="line">    Type: AWS::EC2::VPCGatewayAttachment</span><br><span class="line">    Properties:</span><br><span class="line">      InternetGatewayId: !Ref InternetGateway0101</span><br><span class="line">      VpcId: !Ref VPC01</span><br><span class="line">  PublicRouteTable0101:</span><br><span class="line">    Type: AWS::EC2::RouteTable</span><br><span class="line">    Properties:</span><br><span class="line">      VpcId: !Ref VPC01</span><br><span class="line">  DefaultPublicRoute0101:</span><br><span class="line">    Type: AWS::EC2::Route</span><br><span class="line">    DependsOn: InternetGatewayAttachment0101</span><br><span class="line">    Properties:</span><br><span class="line">      RouteTableId: !Ref PublicRouteTable0101</span><br><span class="line">      DestinationCidrBlock: 0.0.0.0&#x2F;0</span><br><span class="line">      GatewayId: !Ref InternetGateway0101</span><br><span class="line">  Subnet0101:</span><br><span class="line">    Type: AWS::EC2::Subnet</span><br><span class="line">    Properties:</span><br><span class="line">      VpcId: !Ref VPC01</span><br><span class="line">      AvailabilityZone: !Select [ 0, !GetAZs &#39;&#39; ]</span><br><span class="line">      CidrBlock: 10.0.0.0&#x2F;24</span><br><span class="line">  Subnet0102:</span><br><span class="line">    Type: AWS::EC2::Subnet</span><br><span class="line">    Properties:</span><br><span class="line">      VpcId: !Ref VPC01</span><br><span class="line">      AvailabilityZone: !Select [ 2, !GetAZs &#39;&#39; ]</span><br><span class="line">      CidrBlock: 10.0.1.0&#x2F;24</span><br><span class="line">  Subnet0101RouteTableAssociation:</span><br><span class="line">    Type: AWS::EC2::SubnetRouteTableAssociation</span><br><span class="line">    Properties:</span><br><span class="line">      RouteTableId: !Ref PublicRouteTable0101</span><br><span class="line">      SubnetId: !Ref Subnet0101</span><br><span class="line">  Subnet0102RouteTableAssociation:</span><br><span class="line">    Type: AWS::EC2::SubnetRouteTableAssociation</span><br><span class="line">    Properties:</span><br><span class="line">      RouteTableId: !Ref PublicRouteTable0101</span><br><span class="line">      SubnetId: !Ref Subnet0102</span><br><span class="line"></span><br><span class="line">  WebSecurityGroup:</span><br><span class="line">    Type: AWS::EC2::SecurityGroup</span><br><span class="line">    Properties:</span><br><span class="line">      GroupDescription: Enable HTTP access via port 80 and SSH access via port 22</span><br><span class="line">      VpcId: !Ref VPC01</span><br><span class="line">      SecurityGroupIngress:</span><br><span class="line">      - IpProtocol: tcp</span><br><span class="line">        FromPort: &#39;80&#39;</span><br><span class="line">        ToPort: &#39;80&#39;</span><br><span class="line">        CidrIp: 0.0.0.0&#x2F;0</span><br><span class="line">      - IpProtocol: tcp</span><br><span class="line">        FromPort: &#39;22&#39;</span><br><span class="line">        ToPort: &#39;22&#39;</span><br><span class="line">        CidrIp: 0.0.0.0&#x2F;0</span><br><span class="line"></span><br><span class="line">  EC2Instance1:</span><br><span class="line">    Type: AWS::EC2::Instance</span><br><span class="line">    Properties:</span><br><span class="line">      InstanceType: t2.micro</span><br><span class="line">      ImageId: !FindInMap [AWSRegionArch2AMI, !Ref &#39;AWS::Region&#39;, HVM64]</span><br><span class="line">      KeyName: !Ref KeyName</span><br><span class="line">      NetworkInterfaces:</span><br><span class="line">        - DeviceIndex: 0</span><br><span class="line">          SubnetId: !Ref Subnet0101</span><br><span class="line">          GroupSet:</span><br><span class="line">          - !Ref WebSecurityGroup</span><br><span class="line">          AssociatePublicIpAddress: true</span><br><span class="line">      UserData:</span><br><span class="line">        Fn::Base64:</span><br><span class="line">          !Sub |</span><br><span class="line">            #!&#x2F;bin&#x2F;bash</span><br><span class="line">            yum install httpd -y</span><br><span class="line">            service httpd start</span><br><span class="line">            chkconfig httpd on</span><br><span class="line">            echo &quot;&lt;h1&gt;CloudNeta Web Server_1 [Region&#x3D; $&#123;AWS::Region&#125;] &lt;&#x2F;h1&gt;&quot; &gt; &#x2F;var&#x2F;www&#x2F;html&#x2F;index.html</span><br><span class="line">  EC2Instance2:</span><br><span class="line">    Type: AWS::EC2::Instance</span><br><span class="line">    Properties:</span><br><span class="line">      InstanceType: t2.micro</span><br><span class="line">      ImageId: !FindInMap [AWSRegionArch2AMI, !Ref &#39;AWS::Region&#39;, HVM64]</span><br><span class="line">      KeyName: !Ref KeyName</span><br><span class="line">      NetworkInterfaces:</span><br><span class="line">        - DeviceIndex: 0</span><br><span class="line">          SubnetId: !Ref Subnet0102</span><br><span class="line">          GroupSet:</span><br><span class="line">          - !Ref WebSecurityGroup</span><br><span class="line">          AssociatePublicIpAddress: true</span><br><span class="line">      UserData:</span><br><span class="line">        Fn::Base64:</span><br><span class="line">          !Sub |</span><br><span class="line">            #!&#x2F;bin&#x2F;bash</span><br><span class="line">            yum install httpd -y</span><br><span class="line">            service httpd start</span><br><span class="line">            chkconfig httpd on</span><br><span class="line">            echo &quot;&lt;h1&gt;CloudNeta Web Server_2 [Region&#x3D; $&#123;AWS::Region&#125;] &lt;&#x2F;h1&gt;&quot; &gt; &#x2F;var&#x2F;www&#x2F;html&#x2F;index.html</span><br><span class="line"></span><br><span class="line">  ALBTargetGroup:</span><br><span class="line">    Type: AWS::ElasticLoadBalancingV2::TargetGroup</span><br><span class="line">    Condition: CreateSydneyResources</span><br><span class="line">    Properties:</span><br><span class="line">      Name: CloudNetaTG</span><br><span class="line">      Port: 80</span><br><span class="line">      Protocol: HTTP</span><br><span class="line">      VpcId: !Ref VPC01</span><br><span class="line">      Targets:</span><br><span class="line">        - Id: !Ref EC2Instance1</span><br><span class="line">          Port: 80</span><br><span class="line">        - Id: !Ref EC2Instance2</span><br><span class="line">          Port: 80</span><br><span class="line">  ApplicationLoadBalancer:</span><br><span class="line">    Type: AWS::ElasticLoadBalancingV2::LoadBalancer</span><br><span class="line">    Condition: CreateSydneyResources</span><br><span class="line">    Properties:</span><br><span class="line">      Scheme: internet-facing</span><br><span class="line">      SecurityGroups:</span><br><span class="line">        - !Ref WebSecurityGroup</span><br><span class="line">      Subnets:</span><br><span class="line">        - !Ref Subnet0101</span><br><span class="line">        - !Ref Subnet0102</span><br><span class="line">  ALBListener:</span><br><span class="line">    Type: AWS::ElasticLoadBalancingV2::Listener</span><br><span class="line">    Condition: CreateSydneyResources</span><br><span class="line">    Properties:</span><br><span class="line">      DefaultActions:</span><br><span class="line">        - Type: forward</span><br><span class="line">          TargetGroupArn: !Ref ALBTargetGroup</span><br><span class="line">      LoadBalancerArn: !Ref ApplicationLoadBalancer</span><br><span class="line">      Port: 80</span><br><span class="line">      Protocol: HTTP</span><br></pre></td></tr></table></figure></code></pre></div></details><hr><ul><li>í…œí”Œë¦¿ íŒŒì¼ì„ ë‹¤ìš´ë°›ì€ í›„ <code>ì‹œë“œë‹ˆ, ìƒíŒŒìš¸ë£¨</code> Regionì—ì„œ CloudFormation ìŠ¤íƒì„ ìƒì„±í•œë‹¤.</li><li>CloudFormation ìŠ¤íƒ ìƒì„± ì‹œ KeyName íŒŒë¼ë¯¸í„° ê°’ì„ ì…ë ¥í•œë‹¤. (EC2-Key Pair ìƒì„±ì„ í•˜ì§€ ì•Šì•˜ë‹¤ë©´ ìƒì„±)</li><li>CloudFormationì— ì˜í•´ ìƒì„±ë˜ëŠ” ë¦¬ì†ŒìŠ¤ëŠ” ì•„ë˜ì™€ ê°™ìœ¼ë©°, ê° Region ë³„ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.</li></ul><details><summary>ì‹œë“œë‹ˆ CF ìƒì„± ì¸í”„ë¼</summary><div markdown="1"><pre><code>- Web ì„œë²„ìš© EC2-Instance 2ê°œ- VPC 1ê°œ, Subnet 2ê°œ, Public Route Table 1ê°œ, IGW 1ê°œ- Security Group 1ê°œ- Application Load Balancer, Listener, Target Group 1ê°œì”©</code></pre></div></details><details><summary>ìƒíŒŒìš¸ë£¨ CF ìƒì„± ì¸í”„ë¼</summary><div markdown="1"><pre><code>- Web ì„œë²„ìš© EC2-Instance 2ê°œ- VPC 1ê°œ, Subnet 2ê°œ, Public Route Table 1ê°œ, IGW 1ê°œ- Security Group 1ê°œ</code></pre></div></details><br><p>2.4 ê²€ì¦</p><ul><li>ì‚¬ìš©ì PCì—ì„œ <code>ì‹œë“œë‹ˆ</code> ALB DNS ì£¼ì†Œë¡œ Web ì ‘ê·¼í•œë‹¤. (ìƒˆë¡œê³ ì¹¨ì„ í•˜ì—¬ ì •ìƒì ì¸ ë¡œë“œë°¸ëŸ°ì‹± í™•ì¸)</li><li>ì‚¬ìš©ì PCì—ì„œ <code>ìƒíŒŒìš¸ë£¨</code> EC2-Instance IP ì£¼ì†Œë¡œ Web ì ‘ê·¼í•œë‹¤. (2ëŒ€ ëª¨ë‘ í™•ì¸)</li><li>ì°¸ê³ ë¡œ CFì— ì˜í•´ ë¦¬ì†ŒìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ì˜¬ë¼ì˜¤ê¸° ê¹Œì§€ ì•½ê°„ì˜ ì‹œê°„ì´ í•„ìš”í•˜ë‹ˆ ì¼ì • ì‹œê°„ ëŒ€ê¸°ê°€ í•„ìš”í•˜ë‹¤.</li></ul><blockquote><p>ğŸ’¡ ë³¸ê²©ì ì¸ ì‹¤ìŠµì— ì•ì„œ, Global Accelerator ë¦¬ì†ŒìŠ¤ëŠ” ì†ŒëŸ‰ì˜ ê³¼ê¸ˆì´ ë¶ˆê°€í”¼ í•˜ë‹¤. (ìµœì´ˆ ë¦¬ì†ŒìŠ¤ ìƒì„± ì‹œ ì‹œê°„ë‹¹ ì•½ 0.025$)<br>ìì„¸í•œ ì‚¬í•­ì€ <span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9nbG9iYWwtYWNjZWxlcmF0b3IvcHJpY2luZy8=">Global Accelerator ìš”ê¸ˆ<i class="fa fa-external-link-alt"></i></span> ë§í¬ë¥¼ ì°¸ê³  ë°”ë€ë‹¤.</p></blockquote><hr><br><h3 id="3-Create-AWS-Global-Accelerator"><a href="#3-Create-AWS-Global-Accelerator" class="headerlink" title="3. Create AWS Global Accelerator"></a>3. Create AWS Global Accelerator</h3><br><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2dsb2JhbC1hY2NlbGVyYXRvci9sYXRlc3QvZGcvZ2V0dGluZy1zdGFydGVkLmh0bWwjZ2V0dGluZy1zdGFydGVkLWFjY2VsZXJhdG9y">3.1 AWS Global Accelerator ìƒì„±<i class="fa fa-external-link-alt"></i></span></p><p>[STEP 1] Enter Name</p><p>1) Global Accelerator ë¦¬ì†ŒìŠ¤ ì ‘ê·¼</p><ul><li>Global AcceleratorëŠ” ì˜¤ë ˆê³¤ Region(us-west-2)ì—ì„œ ê´€ë¦¬</li></ul><p>2) <code>Create Accelerator</code></p><p>3) Enter Name</p><ul><li>Accelerator Name: <code>CloudNeta-GA</code></li></ul><p>[STEP 2] Add Listeners</p><ul><li>Port Info: <code>80</code></li><li>Protocol Info: <code>TCP</code></li><li>Client affinity Info: <code>None</code></li></ul><p>[STEP 3] Add EndPoint Groups</p><ul><li><p>Region Info: <code>ap-southeast-2</code>, Traffic Dial Info: <code>100</code></p><ul><li><p>Configure Health Checks</p><ul><li>Health Check Protocol: <code>HTTP</code>, ë‚˜ë¨¸ì§€ Default</li></ul></li></ul></li><li><p><code>Add EndPoint Group</code></p></li><li><p>Region Info: <code>sa-east-1</code>, Traffic Dial Info: <code>100</code></p><ul><li><p>Configure Health Checks</p><ul><li>Health Check Protocol: <code>HTTP</code>, ë‚˜ë¨¸ì§€ Default</li></ul></li></ul></li></ul><p>[STEP 4] Add EndPoints</p><ul><li><p>Endpoint group: ap-southeast-2</p><ul><li><p><code>Add endpoint</code></p></li><li><p>Endpoint type Info: <code>Application Load Balancer</code></p></li><li><p>Endpoint Info: <em><code>ALB ëŒ€ìƒ ì§€ì •</code></em></p></li><li><p>Weight Info: <code>128</code></p></li></ul></li></ul><details><summary>View Screenshot</summary><div markdown="1"><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled2.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%202.png"><br>ê·¸ë¦¼ 3-1 ì‹œë“œë‹ˆ EndPoint Groupì˜ EndPoint ì„¤ì • í™”ë©´ (ALB)</p></div></details><ul><li><p>Endpoint group: sa-east-1</p><ul><li><p><code>Add endpoint</code></p></li><li><p>Endpoint type Info: <code>EC2 instance</code></p></li><li><p>Endpoint Info: <em><code>EC2-Instance-1 ëŒ€ìƒ ì§€ì •</code></em></p></li><li><p>Weight Info: <code>128</code></p></li><li><p><code>Add endpoint</code></p></li><li><p>Endpoint type Info: <code>EC2 instance</code></p></li><li><p>Endpoint Info: <em><code>EC2-Instance-2 ëŒ€ìƒ ì§€ì •</code></em></p></li><li><p>Weight Info: <code>128</code></p></li></ul></li></ul><details><summary>View Screenshot</summary><div markdown="1"><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled3.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%203.png"><br>ê·¸ë¦¼ 3-2 ìƒíŒŒìš¸ë£¨ EndPoint Groupì˜ EndPoint ì„¤ì • í™”ë©´ (EC2-Instance)</p></div></details><ul><li><code>Create Accelerator</code></li></ul><br><p>3.2 AWS Global Accelerator ì •ë³´ í™•ì¸</p><p>[STEP 1] Accelerator &amp; Listener ì •ë³´</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled4.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%204.png"><br>ê·¸ë¦¼ 3-3 Accelerator ì •ë³´ì™€ ì´ì— ì†í•œ Listener ì •ë³´</p><ul><li>Accelerator Provisioning StatusëŠ” <code>Deployed</code> ìƒíƒœë¡œ ì „í™˜ë˜ì—ˆë‹¤.</li><li>Acceleratorì— Staticí•œ <code>Anycast IP 2ê°œ</code>ë¥¼ í• ë‹¹ ë°›ëŠ”ë‹¤.</li><li>TCP 80ì— ëŒ€í•œ Listenerê°€ ìƒì„±ë˜ì—ˆê³  <code>All Healthy</code> í•œ ìƒíƒœì´ë‹¤.</li></ul><p>[STEP 2] EndPoint Group í™•ì¸</p><ul><li>Listener ë¥¼ ì„ íƒ í›„ <code>View Details</code>ì— ì ‘ê·¼ í•œë‹¤.</li></ul><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled5.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%205.png"><br>ê·¸ë¦¼ 3-4 ìƒì„±ëœ Listener ì •ë³´ì™€ ì´ì— ì†í•œ Endpoint Group ì •ë³´</p><ul><li>TCP 80ì— ëŒ€í•œ Listener ì •ë³´ì´ë‹¤. (Client AffinityëŠ” ë¹„í™œì„±í™” ìƒíƒœ)</li><li>í•´ë‹¹ Listenerì— ì†í•œ EndPoint Groupì„ í™•ì¸í•œë‹¤. (ap-soutcheast-2ì˜ EndPoint Group, sa-east-1ì˜ EndPoint Group)</li><li>í˜„ì¬ ê° EndPoint Groupì— ëŒ€í•œ <code>Traffic Dial</code>ì€ ëª¨ë‘ 100%ì´ë‹¤. (íŠ¸ë˜í”½ ìˆ˜ìš©ë ¥ 100%)</li></ul><p>[STEP 3] EndPoint í™•ì¸</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled6.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%206.png"><br>ê·¸ë¦¼ 3-5 ì‹œë“œë‹ˆ Endpoint Group ì •ë³´ì™€ ì´ì— ì†í•œ Endpoint ì •ë³´</p><ul><li>ap-southeast-2ì˜ EndPoint Groupì— ëŒ€í•œ EndPoint ì •ë³´ë¥¼ í™•ì¸í•œë‹¤. (EndPoint Type: <code>ALB</code>)</li></ul><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled7.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%207.png"><br>ê·¸ë¦¼ 3-6 ìƒíŒŒìš¸ë£¨ Endpoint Group ì •ë³´ì™€ ì´ì— ì†í•œ Endpoint ì •ë³´</p><ul><li>sa-east-1ì˜ EndPoint Groupì— ëŒ€í•œ EndPoint 2ëŒ€ì˜ ì •ë³´ë¥¼ í™•ì¸í•œë‹¤. (EndPoint Type: <code>EC2</code>)</li></ul><hr><br><h3 id="4-Verify-AWS-Global-Accelerator"><a href="#4-Verify-AWS-Global-Accelerator" class="headerlink" title="4. Verify AWS Global Accelerator"></a>4. Verify AWS Global Accelerator</h3><br><h3 id="4-1-Web-ì ‘ì†-ë¶€í•˜-Test"><a href="#4-1-Web-ì ‘ì†-ë¶€í•˜-Test" class="headerlink" title="4.1 Web ì ‘ì† ë¶€í•˜ Test"></a>4.1 Web ì ‘ì† ë¶€í•˜ Test</h3><p>Web ì ‘ì† í…ŒìŠ¤íŠ¸ëŠ” <code>ì„œìš¸, ë²„ì§€ë‹ˆì•„</code> Regionì— ìƒì„±í•œ EC2-Instanceë¥¼ í™œìš©í•œë‹¤.</p><ul><li>Web ì ‘ì† í…ŒìŠ¤íŠ¸ëŠ” ë¦¬ëˆ…ìŠ¤ì˜ curl ëª…ë ¹ì–´ë¥¼ í†µí•´ ë°˜ë³µ ì‘ì—…ê³¼ ì§€ì—° ì‹œê°„ ì²´í¬ë¥¼ í•œë‹¤.</li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9ibG9ncy9uZXR3b3JraW5nLWFuZC1jb250ZW50LWRlbGl2ZXJ5L3RyYWZmaWMtbWFuYWdlbWVudC13aXRoLWF3cy1nbG9iYWwtYWNjZWxlcmF0b3Iv">Traffic management with AWS Global Accelerator | Amazon Web Services<i class="fa fa-external-link-alt"></i></span></p><p>ì°¸ê³ ë§í¬: Global Accelerator Traffic Management</p><p>4.1.1) <code>ì„œìš¸</code> EC2-Instanceì—ì„œ í…ŒìŠ¤íŠ¸</p><p>4.1.1-1) Web ì ‘ê·¼ 100íšŒ ë°˜ë³µ í…ŒìŠ¤íŠ¸ (Target GA Anycast IP)</p><ul><li><p>View Configuration</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">     50 &lt;h1&gt;CloudNeta Web Server_1 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">     50 &lt;h1&gt;CloudNeta Web Server_2 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">[root@ip-172-31-36-23 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>100íšŒ ì‹œí—˜ ê²°ê³¼ 100% ëª¨ë‘ <code>ì‹œë“œë‹ˆ (ap-southeast-2)</code>ì— ìœ„ì¹˜í•œ Web ì„œë²„ë¡œ ì ‘ê·¼</li></ul></li></ul><p>4.1.1-2) Web ì§€ì—° ì‹œê°„ 10íšŒ ë°˜ë³µ í…ŒìŠ¤íŠ¸ (Target GA Anycast IP)</p><ul><li><p>View Configuration</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ((i=0;i&lt;10;i++)); <span class="keyword">do</span> curl -w <span class="string">"%&#123;time_total&#125;\n"</span> 75.2.44.82 ; <span class="keyword">done</span> ;</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_1 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">0.298549</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_2 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">0.300328</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_2 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">0.299850</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_1 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">0.298484</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_1 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">0.299389</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_2 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">0.299195</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_2 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">0.299922</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_1 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">0.300531</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_2 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">0.299018</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_2 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">0.300288</span><br><span class="line">[root@ip-172-31-36-23 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>Web ì„œë²„ ì ‘ê·¼ ì§€ì—° ì‹œê°„ì„ 10íšŒ ë°˜ë³µ ì‹œ í‰ê·  0.3ì´ˆ ê°€ëŸ‰ ì†Œìš” (10íšŒ ëª¨ë‘ <code>ì‹œë“œë‹ˆ</code>ë¡œ í–¥í•¨)</li></ul></li></ul><p>4.1.1-3) Traceroute ê²½ë¡œ í™•ì¸ (Target ì‹œë“œë‹ˆ Region EC2-Instance)</p><ul><li><p>View Configuration</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">traceroute -I 13.239.18.205</span><br><span class="line">traceroute to 13.239.18.205 (13.239.18.205), 30 hops max, 60 byte packets</span><br><span class="line"> 1  * * *</span><br><span class="line"> 2  * * *</span><br><span class="line"> 3  * * *</span><br><span class="line"> 4  * * *</span><br><span class="line"> 5  * * *</span><br><span class="line"> 6  100.65.11.1 (100.65.11.1)  2.153 ms  9.538 ms  4.807 ms</span><br><span class="line"> 7  54.239.122.39 (54.239.122.39)  1.893 ms  1.922 ms  1.848 ms</span><br><span class="line"> 8  54.239.122.244 (54.239.122.244)  2.705 ms  2.776 ms  2.790 ms</span><br><span class="line"> 9  54.239.122.235 (54.239.122.235)  1.989 ms  1.947 ms  1.949 ms</span><br><span class="line">10  52.93.134.2 (52.93.134.2)  152.098 ms  148.786 ms  148.490 ms</span><br><span class="line">11  54.239.43.246 (54.239.43.246)  148.300 ms  148.447 ms  148.310 ms</span><br><span class="line">12  52.95.37.70 (52.95.37.70)  150.962 ms  149.034 ms  149.132 ms</span><br><span class="line">13  150.222.112.215 (150.222.112.215)  149.895 ms  148.703 ms  148.656 ms</span><br><span class="line">14  150.222.112.216 (150.222.112.216)  149.277 ms  149.290 ms  149.482 ms</span><br><span class="line">15  52.95.37.91 (52.95.37.91)  149.298 ms  148.914 ms  149.624 ms</span><br><span class="line">16  150.222.112.18 (150.222.112.18)  153.129 ms  149.476 ms  148.866 ms</span><br><span class="line">17  * * *</span><br><span class="line">18  * * *</span><br><span class="line">19  * * *</span><br><span class="line">20  * * *</span><br><span class="line">21  * * *</span><br><span class="line">22  * * *</span><br><span class="line">23  * * *</span><br><span class="line">24  * * *</span><br><span class="line">25  * * *</span><br><span class="line">26  * * *</span><br><span class="line">27  * * *</span><br><span class="line">28  * * *</span><br><span class="line">29  * * *</span><br><span class="line">30  * * *</span><br><span class="line">[root@ip-172-31-36-23 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ul><p>4.1.1-4) Traceroute ê²½ë¡œ í™•ì¸ (Target GA Anycast IP)</p><ul><li><p>View Configuration</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">traceroute -I 75.2.44.82</span><br><span class="line">traceroute to 75.2.44.82 (75.2.44.82), 30 hops max, 60 byte packets</span><br><span class="line"> 1  * * *</span><br><span class="line"> 2  * * *</span><br><span class="line"> 3  * * *</span><br><span class="line"> 4  * * *</span><br><span class="line"> 5  * * *</span><br><span class="line"> 6  100.65.8.161 (100.65.8.161)  1.184 ms  0.275 ms  0.261 ms</span><br><span class="line"> 7  54.239.122.43 (54.239.122.43)  0.604 ms  0.651 ms  0.630 ms</span><br><span class="line"> 8  54.239.122.68 (54.239.122.68)  1.121 ms  1.590 ms  1.117 ms</span><br><span class="line"> 9  a848faec6df617b94.awsglobalaccelerator.com (75.2.44.82)  0.268 ms  0.256 ms  0.265 ms</span><br><span class="line">[root@ip-172-31-36-23 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>ëª©ì ì§€ Targetì— ë”°ë¥¸ Traceroute ë¹„êµ (1-3í•­ vs 1-4í•­)</p></li></ul><p>a) Global Accelerator ë¯¸ì‚¬ìš©</p><p>b) Global Accelerator ì‚¬ìš©</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled8.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%208.png"></p><p>ê·¸ë¦¼ ì¶œì²˜: <span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9nbG9iYWwtYWNjZWxlcmF0b3IvP2Jsb2dzLWdsb2JhbC1hY2NlbGVyYXRvci5zb3J0LWJ5PWl0ZW0uYWRkaXRpb25hbEZpZWxkcy5jcmVhdGVkRGF0ZSZibG9ncy1nbG9iYWwtYWNjZWxlcmF0b3Iuc29ydC1vcmRlcj1kZXNjJmF3cy1nbG9iYWwtYWNjZWxlcmF0b3Itd24uc29ydC1ieT1pdGVtLmFkZGl0aW9uYWxGaWVsZHMucG9zdERhdGVUaW1lJmF3cy1nbG9iYWwtYWNjZWxlcmF0b3Itd24uc29ydC1vcmRlcj1kZXNj">AWS Global Accelerator ê°œìš”<i class="fa fa-external-link-alt"></i></span></p><ul><li>ì„œë¹„ìŠ¤ë¥¼ ìœ„í•´ ìˆ˜ë§ì€ ë„¤íŠ¸ì›Œí¬ë¥¼ ê±°ì³ê°€ë©°, ê° Hopì€ ì„±ëŠ¥ì— ì˜í–¥ì„ ì£¼ë©° ìœ„í—˜ì„ ì´ˆë˜í•  ìˆ˜ ìˆë‹¤.</li></ul><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled9.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%209.png"></p><p>ê·¸ë¦¼ ì¶œì²˜: <span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9nbG9iYWwtYWNjZWxlcmF0b3IvP2Jsb2dzLWdsb2JhbC1hY2NlbGVyYXRvci5zb3J0LWJ5PWl0ZW0uYWRkaXRpb25hbEZpZWxkcy5jcmVhdGVkRGF0ZSZibG9ncy1nbG9iYWwtYWNjZWxlcmF0b3Iuc29ydC1vcmRlcj1kZXNjJmF3cy1nbG9iYWwtYWNjZWxlcmF0b3Itd24uc29ydC1ieT1pdGVtLmFkZGl0aW9uYWxGaWVsZHMucG9zdERhdGVUaW1lJmF3cy1nbG9iYWwtYWNjZWxlcmF0b3Itd24uc29ydC1vcmRlcj1kZXNj">AWS Global Accelerator ê°œìš”<i class="fa fa-external-link-alt"></i></span></p><ul><li>AWS Global Acceleratorë¥¼ ì¶”ê°€í•˜ë©´ AWS ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ë¥¼ í™œìš©í•˜ë¯€ë¡œ ì„±ëŠ¥ì´ ê°œì„  ë° íš¨ìœ¨ì ì¸ í†µì‹ ì„ ë³´ì¥í•œë‹¤.</li></ul><br><p>4.1.2) <code>ë²„ì§€ë‹ˆì•„</code> EC2-Instanceì—ì„œ í…ŒìŠ¤íŠ¸</p><p>4.1.2-1) Web ì ‘ê·¼ 100íšŒ ë°˜ë³µ í…ŒìŠ¤íŠ¸ (Target GA Anycast IP)</p><ul><li><p>View Configuration</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">     51 &lt;h1&gt;CloudNeta Web Server_2 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">     49 &lt;h1&gt;CloudNeta Web Server_1 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">[root@ip-172-31-82-0 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>100íšŒ ì‹œí—˜ ê²°ê³¼ 100% ëª¨ë‘ <code>ìƒíŒŒìš¸ë£¨ (sa-east-1)</code>ì— ìœ„ì¹˜í•œ Web ì„œë²„ë¡œ ì ‘ê·¼</li></ul></li></ul><p>4.1.2-2) Web ì§€ì—° ì‹œê°„ 10íšŒ ë°˜ë³µ í…ŒìŠ¤íŠ¸ (Target GA Anycast IP)</p><ul><li><p>View Configuration</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ((i=0;i&lt;10;i++)); <span class="keyword">do</span> curl -w <span class="string">"%&#123;time_total&#125;\n"</span> 75.2.44.82 ; <span class="keyword">done</span> ;</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_2 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">0.227008</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_1 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">0.227156</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_2 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">0.225631</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_1 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">0.227213</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_1 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">0.224898</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_2 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">0.225725</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_2 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">0.225744</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_2 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">0.226330</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_1 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">0.227288</span><br><span class="line">&lt;h1&gt;CloudNeta Web Server_1 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">0.226509</span><br><span class="line">[root@ip-172-31-82-0 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>Web ì„œë²„ ì ‘ê·¼ ì§€ì—° ì‹œê°„ì„ 10íšŒ ë°˜ë³µ ì‹œ í‰ê·  0.22ì´ˆ ê°€ëŸ‰ ì†Œìš” (10íšŒ ëª¨ë‘ <code>ìƒíŒŒìš¸ë£¨</code>ë¡œ í–¥í•¨)</li></ul></li></ul><p>4.1.2-3) Traceroute ê²½ë¡œ í™•ì¸ (Target GA Anycast IP)</p><ul><li><p>View Configuration</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">traceroute -I 75.2.44.82</span><br><span class="line">traceroute to 75.2.44.82 (75.2.44.82), 30 hops max, 60 byte packets</span><br><span class="line"> 1  216.182.238.211 (216.182.238.211)  1.183 ms  1.183 ms  1.181 ms</span><br><span class="line"> 2  * * *</span><br><span class="line"> 3  * * *</span><br><span class="line"> 4  * * *</span><br><span class="line"> 5  * * *</span><br><span class="line"> 6  * * *</span><br><span class="line"> 7  100.65.12.65 (100.65.12.65)  0.323 ms  0.324 ms  0.299 ms</span><br><span class="line"> 8  52.93.28.239 (52.93.28.239)  0.530 ms  0.485 ms  0.431 ms</span><br><span class="line"> 9  100.100.10.28 (100.100.10.28)  0.595 ms  1.151 ms  1.033 ms</span><br><span class="line">10  100.95.2.131 (100.95.2.131)  20.297 ms  83.331 ms  69.912 ms</span><br><span class="line">11  a848faec6df617b94.awsglobalaccelerator.com (75.2.44.82)  0.432 ms  0.488 ms  0.446 ms</span><br><span class="line">[root@ip-172-31-82-0 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ul><br><p>4.1.3) Web ì ‘ì† íë¦„</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled10.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2010.png"></p><p>ê·¸ë¦¼ 4-1 ë¦¬ì „ ë³„ Userì—ì„œ Web ì„œë²„ë¡œ ì ‘ê·¼ ì‹œ ë…¼ë¦¬ì ì¸ íë¦„</p><ul><li>Userì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ Edge Locationìœ¼ë¡œ íŠ¸ë˜í”½ì´ ì „ì†¡í•œë‹¤. (Target: Anycast IP ì‚¬ìš©)</li><li>AWS ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ìµœì ì˜ EndPoint Groupìœ¼ë¡œ ì „ì†¡í•˜ì—¬ ì„œë¹„ìŠ¤í•œë‹¤.</li><li>ì˜ˆë¥¼ ë“¤ì–´ í•œêµ­ì—ì„œ ì ‘ê·¼í•˜ëŠ” ì‚¬ìš©ìëŠ” ì¸ì ‘í•œ Edge Locationìœ¼ë¡œ Web ì ‘ê·¼ ìš”ì²­ì„ ë³´ë‚´ê³ ,  Edge Locationì—ì„œ ê°€ì¥ ê°€ê¹ê³  Healthyí•œ EndPoint Groupì¸ <code>ì‹œë“œë‹ˆ (ap-southeast-2)</code>ë¡œ AWS ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì„œë¹„ìŠ¤í•œë‹¤.</li></ul><br><h3 id="4-2-Traffic-Dial-amp-Weight-ì¡°ì •-Test"><a href="#4-2-Traffic-Dial-amp-Weight-ì¡°ì •-Test" class="headerlink" title="4.2 Traffic Dial &amp; Weight ì¡°ì • Test"></a>4.2 Traffic Dial &amp; Weight ì¡°ì • Test</h3><ul><li>Traffic Dialì€ EndPoint Groupì— ëŒ€í•œ íŠ¸ë˜í”½ ìˆ˜ìš©ë ¥ì´ë©°, WeightëŠ” EndPoint ë³„ íŠ¸ë˜í”½ ì „ì†¡ ê°€ì¤‘ì¹˜ì´ë‹¤.</li></ul><p>4.2.1) Traffic Dial ì¡°ì •</p><ul><li><p>í˜„ì¬ EndPoint Groupì˜ Traffic Dialì€ 100%ë¡œ ì„¤ì •ë˜ì–´ ëª¨ë“  íŠ¸ë˜í”½ì„ ìˆ˜ìš©í•˜ê³  ìˆë‹¤.</p><p>  ì¦‰, <code>ì„œìš¸</code> â€”&gt; <code>ì‹œë“œë‹ˆ</code> 100%, <code>ë²„ì§€ë‹ˆì•„</code> â€”&gt; <code>ìƒíŒŒìš¸ë£¨</code> 100%</p></li></ul><p>4.2.1-1) Traffic Dial: <code>ì‹œë“œë‹ˆ</code> 50%, <code>ìƒíŒŒìš¸ë£¨</code> 100% (<code>ì„œìš¸</code> ì—ì„œ í…ŒìŠ¤íŠ¸)</p><ul><li>Accelerator ì„ íƒ â€”&gt; Listener ì„ íƒ í›„ view detail â€”&gt; endpoint groupì„ ì„ íƒ í›„ edit</li></ul><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled11.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2011.png"></p><p>ê·¸ë¦¼ 4-2 ì‹œë“œë‹ˆ EndPoint Groupì˜ Traffic Dialì„ 50%ë¡œ ì¡°ì •</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">     27 &lt;h1&gt;CloudNeta Web Server_2 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">     27 &lt;h1&gt;CloudNeta Web Server_1 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">     23 &lt;h1&gt;CloudNeta Web Server_2 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">     23 &lt;h1&gt;CloudNeta Web Server_1 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">[root@ip-172-31-36-23 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>í•œêµ­ ì‚¬ìš©ì ê¸°ì¤€ìœ¼ë¡œ ì•½ 50%ì •ë„ëŠ” <code>ì‹œë“œë‹ˆ(ap-southeast-2)</code>ì—ì„œ ì²˜ë¦¬ë˜ê³  ë‚˜ë¨¸ì§€ëŠ” <code>ìƒíŒŒìš¸ë£¨(sa-east-1)</code>ì—ì„œ ì²˜ë¦¬ëœë‹¤.</li></ul><p>4.2.1-2) Traffic Dial: <code>ì‹œë“œë‹ˆ</code> 0%, <code>ìƒíŒŒìš¸ë£¨</code> 100% (<code>ì„œìš¸</code> ì—ì„œ í…ŒìŠ¤íŠ¸)</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled12.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2012.png"></p><p>ê·¸ë¦¼ 4-3 ì‹œë“œë‹ˆ EndPoint Groupì˜ Traffic Dialì„ 0%ë¡œ ì¡°ì •</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">     50 &lt;h1&gt;CloudNeta Web Server_2 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">     50 &lt;h1&gt;CloudNeta Web Server_1 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">[root@ip-172-31-36-23 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>í•œêµ­ ì‚¬ìš©ì ê¸°ì¤€ìœ¼ë¡œ 100% ëª¨ë‘ <code>ìƒíŒŒìš¸ë£¨(sa-east-1)</code>ì—ì„œ ì²˜ë¦¬ëœë‹¤. (ë¹„ë¡ ì‚¬ìš©ì ì…ì¥ì—ì„œ <code>ì‹œë“œë‹ˆ</code>ê°€ ì¸ì ‘í•´ ìˆì§€ë§Œ Traffic Dialì´ 0% ì´ê¸° ë•Œë¬¸ì—)</li><li>í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ Traffic Dial ê°’ ì›ìƒ ë³µêµ¬ (100%)</li></ul><blockquote><p>ğŸ’¡ Traffic Dial 0%ëŠ” ì–¸ì œ ì‚¬ìš©í• ê¹Œ?<br>Traffic Dial 0% ì„¤ì •ì€ Region ë‚´ì—ì„œ ì‘ìš© í”„ë¡œê·¸ë¨ì„ ì—…ê·¸ë ˆì´ë“œí•˜ê±°ë‚˜ ìœ ì§€ ê´€ë¦¬ê°€ í•„ìš”í• ë•Œ, ë¨¼ì € Traffic Dialì„ 0%ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ íŠ¸ë˜í”½ì„ ì°¨ë‹¨í•œë‹¤. ì‘ì—…ì„ ì™„ë£Œí•˜ê³  ë‹¤ì‹œ ì‚¬ìš©í•  ì¤€ë¹„ê°€ ë˜ë©´, Traffic Dialì„ 100ìœ¼ë¡œ ì¡°ì •í•˜ì—¬ íŠ¸ë˜í”½ì„ ë‹¤ì‹œ ìˆ˜ìš©í•œë‹¤.</p></blockquote><br><p>4.2.2) Weight ì¡°ì •</p><ul><li><p>í˜„ì¬ ìƒíŒŒìš¸ë£¨ EndPoint Groupì˜ 2ê°œì˜ EndPointì˜ Weight ê°’ì€ ê°ê° 128ë¡œ ë™ì¼í•œ ë¹„ì¤‘ì„ ì„¤ì •í•˜ê³  ìˆë‹¤.</p></li><li><p>Weightì— ëŒ€í•œ íŠ¸ë˜í”½ ì²˜ë¦¬ ê³µì‹ì€ ì•„ë˜ì™€ ê°™ë‹¤. (<code>ìì‹ ì˜ Weight</code> / <code>ì „ì²´ Weight í•©</code>)</p><p>  ì¦‰, EndPoint#1 ê³„ì‚°ê°’: 128 / (128+128) = 1/2, EndPoint#2 ê³„ì‚°ê°’: 128 / (128+128) = 1/2</p></li></ul><p>4.2.2-1) <code>ìƒíŒŒìš¸ë£¨</code> EndPoint#1 Weight: 64, <code>ìƒíŒŒìš¸ë£¨</code> EndPoint#2 Weight: 128 (<code>ë²„ì§€ë‹ˆì•„</code> ì—ì„œ í…ŒìŠ¤íŠ¸)</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled13.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2013.png"></p><p>ê·¸ë¦¼ 4-4 ìƒíŒŒìš¸ë£¨ EndPoint Groupì˜ EndPoint#1ì˜ Weight ê°’ì„ 64ë¡œ ì¡°ì •</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">     67 &lt;h1&gt;CloudNeta Web Server_2 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">     33 &lt;h1&gt;CloudNeta Web Server_1 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">[root@ip-172-31-95-200 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>ê³„ì‚°ì„ í•´ë³´ë©´ EP#1 = 64 / (64+128) = 1/3 ì´ê³ , EP#2 = 128 / (64+128) = 2/3 ì´ë‹¤.</li></ul><p>4.2.2-2) <code>ìƒíŒŒìš¸ë£¨</code> EndPoint#1 Weight: 0, <code>ìƒíŒŒìš¸ë£¨</code> EndPoint#2 Weight: 128 (<code>ë²„ì§€ë‹ˆì•„</code> ì—ì„œ í…ŒìŠ¤íŠ¸)</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled14.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2014.png"></p><p>ê·¸ë¦¼ 4-5 ìƒíŒŒìš¸ë£¨ EndPoint Groupì˜ EndPoint#1ì˜ Weight ê°’ì„ 0ìœ¼ë¡œ ì¡°ì •</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">    100 &lt;h1&gt;CloudNeta Web Server_2 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">[root@ip-172-31-95-200 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>EP#1ì˜ Weightê°€ 0ì´ë¯€ë¡œ íŠ¸ë˜í”½ì´ ì „ë‹¬ë˜ì§€ ì•Šê³  EP#2ë¡œ ëª¨ë‘ ì „ë‹¬ëœë‹¤.</li><li>í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ Weight ê°’ ì›ìƒ ë³µêµ¬ (128)</li></ul><blockquote><p>ğŸ’¡ Traffic Dial ê°’ì„ ì¡°ì •í•˜ì—¬ EndPoint Groupì˜ íŠ¸ë˜í”½ ì²˜ë¦¬ ë¹„ì¤‘ì„ ì¡°ì ˆí•  ìˆ˜ ìˆìœ¼ë©°,<br>Weight ê°’ì„ ì¡°ì •í•˜ì—¬ EndPointì˜ íŠ¸ë˜í”½ ì²˜ë¦¬ ë¹„ì¤‘ì„ ì¡°ì ˆí•  ìˆ˜ ìˆë‹¤.</p></blockquote><br><h3 id="4-3-Client-Affinity-Test"><a href="#4-3-Client-Affinity-Test" class="headerlink" title="4.3 Client Affinity Test"></a>4.3 Client Affinity Test</h3><ul><li>AWS Global Acceleratorì—ì„œ íŠ¹ì • Source IP ì£¼ì†Œì˜ ì‚¬ìš©ì ìš”ì²­ì„ ë™ì¼í•œ EndPoint ìì›ìœ¼ë¡œ ë³´ë‚´ ì ‘ì† ì„ í˜¸ë„ë¥¼ ìœ ì§€í•˜ë„ë¡ ì„ íƒí•  ìˆ˜ ìˆë‹¤.</li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2dsb2JhbC1hY2NlbGVyYXRvci9sYXRlc3QvZGcvYWJvdXQtbGlzdGVuZXJzLmh0bWwjYWJvdXQtbGlzdGVuZXJzLWNsaWVudC1hZmZpbml0eQ==">Listeners in AWS Global Accelerator<i class="fa fa-external-link-alt"></i></span></p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled15.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2015.png"></p><p>ê·¸ë¦¼ 4-6 Listenerì—ì„œ Client Affinity ì„¤ì •ì„ Source IPë¡œ ë³€ê²½</p><ul><li><p>GAì—ì„œ ìƒì„±í•œ Listenerë¥¼ Edití•˜ì—¬ Client Affinityë¥¼ Noneì—ì„œ Source IPë¡œ ìˆ˜ì •í•œë‹¤.</p><p>  ì¦‰, Source IP ê¸°ì¤€ìœ¼ë¡œ íŠ¹ì • EndPoint ëŒ€ìƒìœ¼ë¡œ ì§€ì†ì ì¸ ì—°ê²°ì„ ë³´ì¥í•œë‹¤. (ë§ˆì¹˜ Sticky Session)</p></li><li><p>Test Targetì€ 2ê°œì˜ EndPointê°€ ì¡´ì¬í•˜ëŠ” <code>ìƒíŒŒìš¸ë£¨</code>ë¡œ í–¥í•˜ë„ë¡ í•œë‹¤.</p></li></ul><p>4.3.1) <code>ë²„ì§€ë‹ˆì•„</code>ì—ì„œ Web ì ‘ì†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">    100 &lt;h1&gt;CloudNeta Web Server_1 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">[root@ip-172-31-95-200 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li><code>ìƒíŒŒìš¸ë£¨</code>ì—ì„œ í•˜ë‚˜ì˜ EndPointë¡œë§Œ ì ‘ì†ì´ ì´ë£¨ì–´ ì§„ë‹¤. (EP#1 - Web Server_1)</li></ul><p>4.3.2) <code>ì„œìš¸</code>ì—ì„œ Web ì ‘ì†</p><ul><li><code>ì„œìš¸</code>ì—ì„œ ì ‘ì† ì‹œ <code>ì‹œë“œë‹ˆ</code> Web Serverë¡œë§Œ ì ‘ì†ë˜ë¯€ë¡œ, Traffic Dialì„ 0ìœ¼ë¡œ ì¡°ì •í•˜ì—¬ <code>ìƒíŒŒìš¸ë£¨</code>ë¡œ í–¥í•˜ê²Œ ì„¤ì •í•œ í›„ í…ŒìŠ¤íŠ¸ í•œë‹¤.</li></ul><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled12.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2012.png"></p><p>ê·¸ë¦¼ 4-7 ì‹œë“œë‹ˆ EndPoint Groupì˜ Traffic Dialì„ 0%ë¡œ ì¡°ì •</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">    100 &lt;h1&gt;CloudNeta Web Server_2 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">[root@ip-172-31-37-218 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li><code>ìƒíŒŒìš¸ë£¨</code>ì—ì„œ í•˜ë‚˜ì˜ EndPointë¡œë§Œ ì ‘ì†ì´ ì´ë£¨ì–´ ì§„ë‹¤. (EP#2 - Web Server_2)</li><li>í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ Traffic Dialê³¼ Client Affinity ê°’ ë³µêµ¬</li></ul><br><h3 id="4-4-Preserve-Client-IP-Test"><a href="#4-4-Preserve-Client-IP-Test" class="headerlink" title="4.4 Preserve Client IP Test"></a>4.4 Preserve Client IP Test</h3><ul><li><p>AWS Global Acceleratorì˜ ì¶”ê°€ëœ ê¸°ëŠ¥ìœ¼ë¡œ Client IP ì£¼ì†Œë¥¼ ìœ ì§€í•˜ì—¬ ë³´ì¡´í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤.</p></li><li><p>EndPoint ë³„ Client IP ë³´ì¡´ ê¸°ëŠ¥</p><ul><li><p>EC2 : í•­ìƒ í™œì„±í™”</p></li><li><p>ALB : ì„ íƒ ê°€ëŠ¥ (í™œì„±í™”/ë¹„í™œì„±í™”)</p></li><li><p>EIP, NLB : í•­ìƒ ë¹„í™œì„±í™”</p></li></ul></li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2dsb2JhbC1hY2NlbGVyYXRvci9sYXRlc3QvZGcvcHJlc2VydmUtY2xpZW50LWlwLWFkZHJlc3MuaHRtbA==">Preserve Client IP Addresses in AWS Global Accelerator<i class="fa fa-external-link-alt"></i></span></p><p>ì°¸ê³ ë§í¬ : í´ë¼ì´ì–¸íŠ¸ IP ë³´ì¡´ ê´€ë ¨ ë¬¸ì„œ</p><p>4.4.1) EC2 EndPoint ëŒ€ìƒ Client IP ë³´ì¡´ (<code>ìƒíŒŒìš¸ë£¨</code>)</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled16.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2016.png"><br>ê·¸ë¦¼ 4-8 EC2 EndPoint Typeì—ì„œ Client IP ë³´ì¡´ ìƒíƒœ (í™œì„±í™”)</p><ul><li>EndPoint íƒ€ì…ì´ EC2 ì¼ ê²½ìš°  Client IP ë³´ì¡´ ê¸°ëŠ¥ì€ í•­ìƒ í™œì„±í™” ìƒíƒœì´ë‹¤.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">     54 &lt;h1&gt;CloudNeta Web Server_1 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">     46 &lt;h1&gt;CloudNeta Web Server_2 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">[root@ip-172-31-95-200 ec2-user]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">curl ifconfig.me</span><br><span class="line">54.163.161.100</span><br><span class="line">[root@ip-172-31-95-200 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li><code>ë²„ì§€ë‹ˆì•„</code>ì—ì„œ GA Anycast IP íƒ€ê²Ÿìœ¼ë¡œ Web ì ‘ê·¼ ì‹œë„ ë° ìì‹ ì˜ ê³µì¸ IP í™•ì¸</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tail -f /var/<span class="built_in">log</span>/httpd/access_log</span><br><span class="line">:</span><br><span class="line">54.163.161.100 - - [05/May/2020:03:31:23 +0000] <span class="string">"GET / HTTP/1.1"</span> 200 53 <span class="string">"-"</span> <span class="string">"curl/7.61.1"</span></span><br><span class="line">54.163.161.100 - - [05/May/2020:03:31:24 +0000] <span class="string">"GET / HTTP/1.1"</span> 200 53 <span class="string">"-"</span> <span class="string">"curl/7.61.1"</span></span><br><span class="line">54.163.161.100 - - [05/May/2020:03:31:24 +0000] <span class="string">"GET / HTTP/1.1"</span> 200 53 <span class="string">"-"</span> <span class="string">"curl/7.61.1"</span></span><br><span class="line">:</span><br><span class="line">[root@ip-10-0-1-252 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li><code>ìƒíŒŒìš¸ë£¨</code> Web ì„œë²„ì—ì„œ HTTP ë¡œê·¸ë¥¼ í™•ì¸í•´ ë³´ë©´ Client IP (<code>ë²„ì§€ë‹ˆì•„</code>)ê°€ ë³´ì¡´ë˜ì–´ ê·¸ëŒ€ë¡œ ì¸ì…ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</li></ul><br><p>4.4.2) ALB EndPoint ëŒ€ìƒ Client IP ë³´ì¡´ (<code>ì‹œë“œë‹ˆ</code>)</p><ul><li>EndPoint íƒ€ì…ì´ ALB ì¼ ê²½ìš°  Client IP ë³´ì¡´ ê¸°ëŠ¥ì€ ì„ íƒí•  ìˆ˜ ìˆë‹¤. (í™œì„±í™”/ë¹„í™œì„±í™”)</li><li>ALB Backendì— ì¡´ì¬í•˜ëŠ” EC2ì—ì„œ  Client IP ì£¼ì†Œë¥¼ í™•ì¸í•˜ë ¤ë©´ <code>X-Forwarded-For í—¤ë”</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ìº¡ì³í•´ì•¼ í•œë‹¤.</li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9wcmVtaXVtc3VwcG9ydC9rbm93bGVkZ2UtY2VudGVyL2VsYi1jYXB0dXJlLWNsaWVudC1pcC1hZGRyZXNzZXMv">ELB ì•¡ì„¸ìŠ¤ ë¡œê·¸ì—ì„œ í´ë¼ì´ì–¸íŠ¸ IP ì£¼ì†Œ ìº¡ì²˜<i class="fa fa-external-link-alt"></i></span></p><p>ì°¸ê³ ë§í¬ : ELB ì—‘ì„¸ìŠ¤ ë¡œê·¸ì—ì„œ í´ë¼ì´ì–¸íŠ¸ IP ì£¼ì†Œ í™•ì¸</p><p>4.4.2.1) Client IP ë³´ì¡´ í™œì„±í™”</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled17.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2017.png"><br>ê·¸ë¦¼ 4-9 ALB EndPoint Typeì—ì„œ Client IP ë³´ì¡´ ìƒíƒœ (í™œì„±í™”)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/httpd/conf/httpd.conf</span><br><span class="line">:</span><br><span class="line">LogFormat <span class="string">"%&#123;X-Forwarded-For&#125;i %h %l %u %t \"%r\" %&gt;s %b \"%&#123;Referer&#125;i\" \"%&#123;User-Agent&#125;i\""</span> combined</span><br><span class="line">LogFormat <span class="string">"%h %l %u %t \"%r\" %&gt;s %b"</span> common</span><br><span class="line">:</span><br><span class="line">[root@ip-10-0-0-211 ec2-user]<span class="comment"># service httpd reload</span></span><br><span class="line">Reloading httpd:</span><br><span class="line">[root@ip-10-0-0-211 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li><code>ì‹œë“œë‹ˆ</code> Web ì„œë²„ì—ì„œ /etc/httpd/conf/httpd.conf íŒŒì¼ì˜ LogFormat ì„¹ì…˜ì—ì„œ ìœ„ ë‚´ìš©ì„ ì¶”ê°€ í•œë‹¤. (http ë°ëª¬ reload)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">     50 &lt;h1&gt;CloudNeta Web Server_2 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">     50 &lt;h1&gt;CloudNeta Web Server_1 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">[ec2-user@ip-172-31-37-218 ~]$</span><br><span class="line"></span><br><span class="line">curl ifconfig.me</span><br><span class="line">15.164.93.22</span><br><span class="line">[ec2-user@ip-172-31-37-218 ~]$</span><br></pre></td></tr></table></figure><ul><li><code>ì„œìš¸</code> ì—ì„œ GA Anycast IP íƒ€ê²Ÿìœ¼ë¡œ Web ì ‘ê·¼ ì‹œë„ ë° ìì‹ ì˜ ê³µì¸ IP í™•ì¸</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tail -f /var/<span class="built_in">log</span>/httpd/access_log</span><br><span class="line">:</span><br><span class="line">15.164.93.22 10.0.1.18 - - [05/May/2020:04:13:05 +0000] <span class="string">"GET / HTTP/1.1"</span> 200 58 <span class="string">"-"</span> <span class="string">"curl/7.61.1"</span></span><br><span class="line">15.164.93.22 10.0.0.76 - - [05/May/2020:04:13:05 +0000] <span class="string">"GET / HTTP/1.1"</span> 200 58 <span class="string">"-"</span> <span class="string">"curl/7.61.1"</span></span><br><span class="line">15.164.93.22 10.0.0.76 - - [05/May/2020:04:13:06 +0000] <span class="string">"GET / HTTP/1.1"</span> 200 58 <span class="string">"-"</span> <span class="string">"curl/7.61.1"</span></span><br><span class="line">:</span><br><span class="line">[root@ip-10-0-0-211 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li><code>ì‹œë“œë‹ˆ</code> Web ì„œë²„ì—ì„œ HTTP ë¡œê·¸ë¥¼ í™•ì¸í•´ ë³´ë©´ Client IP (<code>ì„œìš¸</code>)ê°€ ë³´ì¡´ë˜ì–´ ê·¸ëŒ€ë¡œ ì¸ì…ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</li></ul><p>4.4.2.2) Client IP ë³´ì¡´ ë¹„í™œì„±í™”</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled18.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2018.png"><br>ê·¸ë¦¼ 4-10 ALB EndPoint Typeì—ì„œ Client IP ë³´ì¡´ ì„¤ì • ë³€ê²½ (ë¹„í™œì„±í™”)</p><ul><li><code>ì‹œë“œë‹ˆ</code>ì˜ ALB EndPoint Typeì„ Edití•˜ì—¬ Preserve Client IP address ì²´í¬ë¥¼ í•´ì œí•œë‹¤. (Client IP ë³´ì¡´ ë¹„í™œì„±í™”)</li><li>Global Accelerator ê°€ ì¬ì‹œë™ ë˜ì–´ ì•½ê°„ì˜ ëŒ€ê¸°ê°€ í•„ìš”í•˜ë‹¤.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">     50 &lt;h1&gt;CloudNeta Web Server_2 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">     50 &lt;h1&gt;CloudNeta Web Server_1 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">[ec2-user@ip-172-31-37-218 ~]$</span><br><span class="line"></span><br><span class="line">curl ifconfig.me</span><br><span class="line">15.164.93.22</span><br><span class="line">[ec2-user@ip-172-31-37-218 ~]$</span><br></pre></td></tr></table></figure><ul><li><code>ì„œìš¸</code> ì—ì„œ GA Anycast IP íƒ€ê²Ÿìœ¼ë¡œ Web ì ‘ê·¼ ì‹œë„ ë° ìì‹ ì˜ ê³µì¸ IP í™•ì¸</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tail -f /var/<span class="built_in">log</span>/httpd/access_log</span><br><span class="line">:</span><br><span class="line">99.82.168.137 10.0.0.76 - - [05/May/2020:04:24:21 +0000] <span class="string">"GET / HTTP/1.1"</span> 200 58 <span class="string">"-"</span> <span class="string">"curl/7.61.1"</span></span><br><span class="line">99.82.168.139 10.0.1.18 - - [05/May/2020:04:24:22 +0000] <span class="string">"GET / HTTP/1.1"</span> 200 58 <span class="string">"-"</span> <span class="string">"curl/7.61.1"</span></span><br><span class="line">99.82.168.137 10.0.0.76 - - [05/May/2020:04:24:23 +0000] <span class="string">"GET / HTTP/1.1"</span> 200 58 <span class="string">"-"</span> <span class="string">"curl/7.61.1"</span></span><br><span class="line">[root@ip-10-0-0-211 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li><code>ì‹œë“œë‹ˆ</code> Web ì„œë²„ì—ì„œ HTTP ë¡œê·¸ë¥¼ í™•ì¸í•´ ë³´ë©´ Client IP (<code>ì„œìš¸</code>)ê°€ ë³´ì¡´ë˜ì§€ ì•Šê³ , GAì—ì„œ ì‚¬ìš©í•˜ëŠ” ë‚´ë¶€ ì£¼ì†Œ ëŒ€ì—­ì´ Source IPë¡œ ë“¤ì–´ ì˜¨ë‹¤.</li></ul><blockquote><p>ğŸ’¡ Client IP ë³´ì¡´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´?<br>IP ë³„ í•„í„°ë§ì„ ìˆ˜ì›”í•˜ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆê³ , íŠ¹ì • IPë§ˆë‹¤ ì œê³µ ì»¨í…ì¸  ë¶„ë¥˜í•˜ê±°ë‚˜ í†µê³„ ì •ë³´ í™œìš©ì— ìœ ìš©í•˜ë‹¤.</p></blockquote><br><h3 id="4-5-Failover-Test"><a href="#4-5-Failover-Test" class="headerlink" title="4.5 Failover Test"></a>4.5 Failover Test</h3><ul><li><code>ì‹œë“œë‹ˆ(ap-southeast-2)</code>ì— ìœ„ì¹˜í•˜ëŠ” Web ì„œë²„ë¥¼ í•œëŒ€ ì”© Stop í›„ ë™ì‘ì„ í™•ì¸í•œë‹¤.</li><li>ClientëŠ” <code>ì„œìš¸</code>ì„ ê¸°ì¤€ìœ¼ë¡œ í•œë‹¤.</li></ul><p>4.5.1) <code>ì‹œë“œë‹ˆ</code> Web ì„œë²„ 1ëŒ€ Stop</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled19.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2019.png"><br>ê·¸ë¦¼ 4-11 ì‹œë“œë‹ˆ Web Server 1ëŒ€ ì¤‘ì§€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">    100 &lt;h1&gt;CloudNeta Web Server_1 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">[root@ip-172-31-37-218 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>ALBì— ì˜í•˜ì—¬ Load Balancing ë˜ëŠ” í™˜ê²½ì´ë¼ ë‹¤ë¥¸ Web ì„œë²„ê°€ ëª¨ë‘ ì²˜ë¦¬ í•´ ì¤€ë‹¤.</li></ul><br><p>4.5.2) <code>ì‹œë“œë‹ˆ</code> Web ì„œë²„ ëª¨ë‘ Stop</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled20.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2020.png"><br>ê·¸ë¦¼ 4-12 ì‹œë“œë‹ˆ ë‚˜ë¨¸ì§€ Web Server 1ëŒ€ ì¤‘ì§€ (ì „ì²´ ì¤‘ì§€)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">     50 &lt;h1&gt;CloudNeta Web Server_2 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">     50 &lt;h1&gt;CloudNeta Web Server_1 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">[root@ip-172-31-37-218 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li><code>ì‹œë“œë‹ˆ(ap-southeast-2)</code>ì˜ Web ì„œë²„ ëª¨ë“  ìì›ì´ Stop ë˜ì <code>ìƒíŒŒìš¸ë£¨(sa-east-1)</code>ë¡œ ê²½ë¡œë¥¼ ë³€ê²½í•˜ì—¬ ëª¨ë‘ ì²˜ë¦¬í•œë‹¤.</li></ul><br><p>4.5.3) Global Accelerator ìƒíƒœ í™•ì¸</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled21.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2021.png"><br>ê·¸ë¦¼ 4-13 Lisener ìƒíƒœ í™•ì¸</p><ul><li>ë¦¬ìŠ¤ë„ˆì˜ ìƒíƒœë¥¼ í™•ì¸í•´ë³´ë©´ <code>1 Unhealthy endpoints</code> ìƒíƒœì´ë‹¤.</li></ul><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled22.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2022.png"><br>ê·¸ë¦¼ 4-14 EndPoints Health Check ìƒíƒœ í™•ì¸</p><ul><li>Unhealthy ìƒíƒœì˜ Endpointë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</li></ul><br><p>4.5.4) <code>ì‹œë“œë‹ˆ</code> Web ì„œë²„ ëª¨ë‘ Start</p><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled23.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2023.png"><br>ê·¸ë¦¼ 4-15 ì‹œë“œë‹ˆ Web Server ëª¨ë‘ í™œì„±í™”</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">     46 &lt;h1&gt;CloudNeta Web Server_1 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">     44 &lt;h1&gt;CloudNeta Web Server_2 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">      5 &lt;h1&gt;CloudNeta Web Server_2 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">      5 &lt;h1&gt;CloudNeta Web Server_1 [Region= sa-east-1] &lt;/h1&gt;</span><br><span class="line">[root@ip-172-31-37-218 ec2-user]<span class="comment">#</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span> curl -s -q 75.2.44.82 ; <span class="keyword">done</span> | sort | uniq -c | sort -nr</span><br><span class="line">     51 &lt;h1&gt;CloudNeta Web Server_2 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">     49 &lt;h1&gt;CloudNeta Web Server_1 [Region= ap-southeast-2] &lt;/h1&gt;</span><br><span class="line">[root@ip-172-31-37-218 ec2-user]<span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>Health Checkì— ì˜í•˜ì—¬ <code>ì‹œë“œë‹ˆ</code> ìª½ EndPoint Groupì´ Healthy ìƒíƒœë¡œ ì „í™˜ë˜ê¸° ê¹Œì§€ <code>ìƒíŒŒìš¸ë£¨</code>ì—ì„œ ì²˜ë¦¬í•˜ë©°, ì´ í›„ <code>ì‹œë“œë‹ˆ</code>ì—ì„œ ëª¨ë‘ ì²˜ë¦¬í•œë‹¤.</li></ul><p><img src="/images/LabGuide-AWS-Global-Accelerator/Untitled24.png" alt="LabGuide%20AWS%20Global%20Accelerator%2086f3714d71d24b4c940958dfd90b2d52/Untitled%2024.png"><br>ê·¸ë¦¼ 4-16 Lisener ìƒíƒœ í™•ì¸</p><ul><li>All Healthy ìƒíƒœë¡œ ì „í™˜</li></ul><hr><br><h3 id="5-Delete-Infrastructure"><a href="#5-Delete-Infrastructure" class="headerlink" title="5. Delete Infrastructure"></a>5. Delete Infrastructure</h3><p>1) AWS Global Accelerator Disable</p><p>2) AWS Global Accelerator Delete</p><ul><li>AWS Global Acceleratorì— ëŒ€í•´ Delete ë²„íŠ¼ì„ ëˆ„ë¥´ê³ , Disable í›„ Delete</li></ul><p>3) ì‹œë“œë‹ˆ CloudFormation Stack Delete</p><p>4) ìƒíŒŒìš¸ë£¨ CloudFormation Stack Delete</p><p>5) í•œêµ­ EC2-Instance Shutdown</p><p>6) ë²„ì§€ë‹ˆì•„ EC2-Instance Shutdown</p><blockquote><p>ğŸ”” CloudFormation ìŠ¤íƒì„ ì‚­ì œ ì‹œ ì¼ì • ì‹œê°„ì´ ì†Œìš”ë˜ëŠ”ë°, ë„ˆë¬´ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦°ë‹¤ë©´ ìˆ˜ë™ìœ¼ë¡œ ê´€ë ¨ ì¸í”„ë¼ë¥¼ ì‚­ì œí•´ì•¼ í•œë‹¤.<br>ë°˜ë“œì‹œ, ì‹¤ìŠµì„ ìœ„í•´ ìƒì„±í•œ ë¦¬ì†ŒìŠ¤ëŠ” ì‚­ì œí•œë‹¤.</p></blockquote><br>]]></content:encoded>
      
      <comments>http://cloudneta.github.io/2020/05/06/Accelerator/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Route53 Geoproximity</title>
      <link>http://cloudneta.github.io/2020/05/06/Route53-Geoproximity/</link>
      <guid>http://cloudneta.github.io/2020/05/06/Route53-Geoproximity/</guid>
      <pubDate>Wed, 06 May 2020 03:49:11 GMT</pubDate>
      <description>
      
        &lt;p&gt;&lt;em&gt;ì‘ì„±ì : gasida.cloudnet@&lt;/em&gt;&lt;/p&gt;
      
      </description>
      
      
      <content:encoded><![CDATA[<p><em>ì‘ì„±ì : gasida.cloudnet@</em></p><a id="more"></a><br><details><summary>AWS Document Route53</summary><div markdown="1"><ul><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL1JvdXRlNTMvbGF0ZXN0L0RldmVsb3Blckd1aWRlL3JvdXRpbmctcG9saWN5Lmh0bWwjcm91dGluZy1wb2xpY3ktZ2VvcHJveGltaXR5">ì§€ë¦¬ ê·¼ì ‘ ë¼ìš°íŒ…(íŠ¸ë˜í”½ íë¦„ ì „ìš©)<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL1JvdXRlNTMvbGF0ZXN0L0RldmVsb3Blckd1aWRlL3RyYWZmaWMtZmxvdy5odG1s">íŠ¸ë˜í”½ íë¦„ì„ ì‚¬ìš©í•˜ì—¬ DNS íŠ¸ë˜í”½ ë¼ìš°íŒ…<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly95b3V0dS5iZS82SU82aFc3eWcybw==">Youtube 1<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly95b3V0dS5iZS96eFNEUlBRUmQ1MA==">Youtube 2<i class="fa fa-external-link-alt"></i></span></li></ul></div></details><br><blockquote><p>ğŸ’¡ AWS ì„œë¹„ìŠ¤ ê´€ë ¨í•´ì„œëŠ” í•­ìƒ ìµœìš°ì„ ìœ¼ë¡œ â€˜AWS ì„¤ëª…ì„œâ€™ ë¥¼ ì½ì–´ë³´ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤. í•œê¸€ ë²ˆì—­ì´ ë§¤ë„ëŸ½ì§€ ëª»í•˜ë©´ English ë¡œ ë³€ê²½ í›„ ì½ì–´ë³´ê¸°ë¥¼ ë°”ë€ë‹¤.</p></blockquote><hr><br><h3 id="1-Geoproximity-Routing-Policy"><a href="#1-Geoproximity-Routing-Policy" class="headerlink" title="1. Geoproximity Routing Policy"></a>1. Geoproximity Routing Policy</h3><ul><li>ê¸°ë³¸ì ì¸ ë™ì‘ì€ Geolocation Policy ì˜ ë‚´ìš©ì„ ê°€ì ¸ê°„ë‹¤ - ìœ„ì¹˜ê¸°ë°˜, EDNS ì§€ì› <span class="exturl" data-url="aHR0cHM6Ly93d3cubm90aW9uLnNvL0xhYkd1aWRlLVJvdXRlNTMtR2VvbG9jYXRpb24tMDRiOTZmMjdjNGUwNDllZmFmMTdkMzQ5ZjQ3ZmY5NzM=">LabGuide - Route53 Geolocation<i class="fa fa-external-link-alt"></i></span></li><li>ì‚¬ìš©ì ìœ„ì¹˜(IP)ì™€ ë¦¬ì†ŒìŠ¤(íƒ€ê²Ÿ ì„œë²„ ìì›) ìœ„ì¹˜(IP)ì˜ ìœ„ë„ ê²½ë„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê·¼ì ‘ ì˜ì—­ ë‚´ë¡œ ë¼ìš°íŒ…<ul><li>EDNS Client Subnet ë¥¼ ì´ìš©í•œ ì‚¬ìš©ì ìœ„ì¹˜(IP) ê¸°ë°˜ íŠ¸ë˜í”½ ë¼ìš°íŒ… ì„ íƒ ê°€ëŠ¥<ul><li>EDNS ë¯¸ ë™ì‘ ì‹œ Local DNS ì„œë²„ì˜ ìœ„ì¹˜(IP)ë¥¼ ê¸°ë°˜í•¨</li></ul></li></ul></li><li>Bias ë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì˜ ê·¼ì ‘ ì˜ì—­(ì˜í–¥ë ¥)ì„ ëŠ˜ë¦¬ê±°ë‚˜ ì¤„ì„</li></ul><p><img src="/images/Route53-Geoproximity/Untitled.png" alt="Route53%20Geoproximity%2071d2807e015f4272a1fd106310b3096c/Untitled.png"></p><p>3ê°œì˜ ë¦¬ì†ŒìŠ¤(íƒ€ì¼“ ì—”ë“œí¬ì¸íŠ¸)ê°€ ì „ë¶€ Bias 0</p><br><p><img src="/images/Route53-Geoproximity/Untitled1.png" alt="Route53%20Geoproximity%2071d2807e015f4272a1fd106310b3096c/Untitled%201.png"></p><p>3ë²ˆ ë¦¬ì „(ì—”ë“œí¬ì¸íŠ¸) Bias +25 ì˜í–¥ë ¥ ì˜¬ë¦¼</p><br><p><img src="/images/Route53-Geoproximity/Untitled2.png" alt="Route53%20Geoproximity%2071d2807e015f4272a1fd106310b3096c/Untitled%202.png"></p><p>3ë²ˆ ë¦¬ì „(ì—”ë“œí¬ì¸íŠ¸) Bias -25 ì˜í–¥ë ¥ ë‚´ë¦¼</p><br><ul><li><p>Custom Coordinates ë¦¬ì†ŒìŠ¤(íƒ€ì¼“ ì„œë²„ ìì›)ì˜ ìœ„ì¹˜ë¥¼ ì§ì ‘ ì¢Œí‘œ(ìœ„ë„, ê²½ë„)ë¥¼ ì…ë ¥ í•  ìˆ˜ ìˆìŒ</p><p>  <img src="/images/Route53-Geoproximity/Untitled3.png" alt="Route53%20Geoproximity%2071d2807e015f4272a1fd106310b3096c/Untitled%203.png"></p></li></ul><hr><br><h3 id="2-Lab-Topology"><a href="#2-Lab-Topology" class="headerlink" title="2. Lab Topology"></a>2. Lab Topology</h3><p><strong>Lab ì •ë³´</strong></p><ul><li>Seoul ì›¹ì„œë²„ : 13.124.1.104</li><li>Virginia ì›¹ì„œë²„ : 18.206.155.179</li><li>gcp-seoul ë‹¨ë§ : 34.64.78.168</li><li>gcp-virginia ë‹¨ë§ : 35.186.188.100</li><li>gcp-london ë‹¨ë§ : 34.89.118.195<ul><li>bias ì— ë”°ë¼ì„œ ì ‘ì† ë¦¬ì†ŒìŠ¤ê°€ ë³€ê²½ë¨ì„ í™•ì¸</li></ul></li></ul><hr><br><h3 id="3-Config-Geoproximity-Policy-amp-Verify"><a href="#3-Config-Geoproximity-Policy-amp-Verify" class="headerlink" title="3. Config Geoproximity Policy &amp; Verify"></a>3. Config Geoproximity Policy &amp; Verify</h3><ul><li><p>[Route53 - íŠ¸ë˜í”½ ì •ì±… ìƒì„±]</p><ul><li><p>ì •ì±… ì´ë¦„ : geoproximity</p></li><li><p>ë²„ì „ ì„¤ëª… : geoproximity test</p><ul><li><code>ë‹¤ìŒ</code> í´ë¦­</li></ul></li><li><p>ì‹œì‘ ì§€ì  : A: IPv4</p><ul><li><p><code>+</code> ì—°ê²° ëŒ€ìƒ í´ë¦­ â†’ <code>ì§€ë¦¬ ê·¼ì ‘ ê·œì¹™</code> ì„ íƒ</p><ul><li><p>ë¦¬ì „ <code>1</code></p><ul><li>ì—”ë“œ í¬ì¸íŠ¸ ìœ„ì¹˜ : ì•„ì‹œì•„ íƒœí‰ì–‘(ì„œìš¸)</li><li><code>+</code> ì—°ê²° ëŒ€ìƒ í´ë¦­ â†’ <code>ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸</code> ì„ íƒ<ul><li>ìœ í˜• : ê°’</li><li>ê°’ : 13.124.1.104</li></ul></li></ul></li><li><p>ë¦¬ì „ <code>2</code></p><ul><li>ì—”ë“œ í¬ì¸íŠ¸ ìœ„ì¹˜ : ë¯¸êµ­ ë™ë¶€(ë²„ì§€ë‹ˆì•„ ë¶êµ¬)</li><li><code>+</code> ì—°ê²° ëŒ€ìƒ í´ë¦­ â†’ <code>ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸</code> ì„ íƒ<ul><li>ìœ í˜• : ê°’</li><li>ê°’ : 18.206.155.179</li></ul></li></ul></li><li><p>ì§€ë¦¬ ê·¼ì ‘ ë§µ í‘œì‹œ ìš°ì¸¡ì— <code>ğŸ´</code> í´ë¦­</p><p>  <img src="/images/Route53-Geoproximity/Untitled4.png" alt="Route53%20Geoproximity%2071d2807e015f4272a1fd106310b3096c/Untitled%204.png"></p><p>  ëŸ°ë˜ ë‹¨ë§ì€ ë²„ì§€ë‹ˆì•„ì— ìœ„ì¹˜í•œ ì˜í–¥ê¶Œì— ìˆì–´ì„œ ë²„ì§€ë‹ˆì•„ ì›¹ì„œë²„ì— ì—°ê²°ëœë‹¤</p></li><li><p>í•˜ë‹¨ <code>íŠ¸ë˜í”½ ì •ì±… ìƒì„±</code> í´ë¦­</p></li></ul></li></ul></li><li><p>íŠ¸ë˜í”½ ì •ì±…ìœ¼ë¡œ ì •ì±… ë ˆì½”ë“œ ìƒì„±</p><ul><li>ì •ì±… ë ˆì½”ë“œ<ul><li>ì •ì±… ë ˆì½”ë“œ DNS ì´ë¦„ : geop1<ul><li>í•˜ë‹¨ <code>ì •ì±… ë ˆì½”ë“œ ìƒì„±</code> í´ë¦­</li></ul></li></ul></li></ul></li></ul></li><li><p>ë‹¨ë§ ì ‘ì† í™•ì¸ : ì„œìš¸, ë²„ì§€ë‹ˆì•„, ëŸ°ë˜</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ëŸ°ë˜ ë‹¨ë§</span></span><br><span class="line">curl geop1.gasida.net</span><br><span class="line">&lt;html&gt;&lt;h1&gt;Hello from Web Server - Virgina Area&lt;/h1&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ë²„ì§€ë‹ˆì•„ ë‹¨ë§</span></span><br><span class="line">curl geop1.gasida.net</span><br><span class="line">&lt;html&gt;&lt;h1&gt;Hello from Web Server - Virgina Area&lt;/h1&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ì„œìš¸ ë‹¨ë§</span></span><br><span class="line">curl geop1.gasida.net</span><br><span class="line">&lt;html&gt;&lt;h1&gt;Hello from Web Server - Seoul Area&lt;/h1&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure><ul><li>Cloudwatch Log ì—ë„ geop1 ìœ¼ë¡œ DNS ì¿¼ë¦¬ ë¡œê·¸ í™•ì¸</li></ul></li></ul><hr><br><h3 id="4-Geoproximity-Bias-Modify-amp-Verify"><a href="#4-Geoproximity-Bias-Modify-amp-Verify" class="headerlink" title="4. Geoproximity Bias Modify &amp; Verify"></a>4. Geoproximity Bias Modify &amp; Verify</h3><ul><li><p>[Route53 - íŠ¸ë˜í”½ ì •ì±…] í´ë¦­ â†’ í•˜ë‹¨ì— ë²„ì „ ë²ˆí˜¸ <code>1</code> í´ë¦­</p><ul><li><p>ìƒë‹¨ì— <code>ìƒˆ ë²„ì „ìœ¼ë¡œ ì •ì±… í¸ì§‘</code> í´ë¦­</p><ul><li><p>ìƒˆ ë²„ì „ ì„¤ëª… : geoproximity bias modify</p><ul><li>í•˜ë‹¨ <code>ë‹¤ìŒ</code> í´ë¦­</li></ul></li><li><p>ì§€ë¦¬ ê·¼ì ‘ ë§µ í‘œì‹œ ìš°ì¸¡ì— <code>ğŸ´</code> í´ë¦­ â†’ ì•„ë˜ ë°”ì´ì–´ìŠ¤ ì…ë ¥ í›„ ì§€ë„ ë³€í™” í™•ì¸</p><ul><li><p>ë¦¬ì „ <code>2</code></p><ul><li><p>ë°”ì´ì–´ìŠ¤ : -50</p><p>  <img src="/images/Route53-Geoproximity/Untitled5.png" alt="Route53%20Geoproximity%2071d2807e015f4272a1fd106310b3096c/Untitled%205.png"></p><p>  ëŸ°ë˜ ë‹¨ë§ì€ ì„œìš¸ì— ìœ„ì¹˜í•œ ì˜í–¥ê¶Œì— ìˆì–´ì„œ ì„œìš¸ ì›¹ì„œë²„ì— ì—°ê²°ëœë‹¤</p><ul><li>í•˜ë‹¨ì— <code>ìƒˆ ë²„ì „ìœ¼ë¡œ ì €ì¥</code> í´ë¦­</li></ul></li></ul></li></ul></li><li><p>íŠ¸ë˜í”½ ì •ì±…ìœ¼ë¡œ ì •ì±… ë ˆì½”ë“œ ìƒì„±</p><ul><li>ì •ì±… ë ˆì½”ë“œ<ul><li>ì •ì±… ë ˆì½”ë“œ DNS ì´ë¦„ : geop2<ul><li>í•˜ë‹¨ <code>ì •ì±… ë ˆì½”ë“œ ìƒì„±</code> í´ë¦­</li></ul></li></ul></li></ul></li></ul></li></ul></li><li><p>ë‹¨ë§ ì ‘ì† í™•ì¸ : ì„œìš¸, ë²„ì§€ë‹ˆì•„, ëŸ°ë˜</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ëŸ°ë˜ ë‹¨ë§</span></span><br><span class="line">curl geop2.gasida.net</span><br><span class="line">&lt;html&gt;&lt;h1&gt;Hello from Web Server - Seoul Area&lt;/h1&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## geop1 ëŠ” version 1 ë¡œ ê¸°ì¡´ geoproximity ì •ì±…ì´ë‹¤</span></span><br><span class="line">curl geop1.gasida.net</span><br><span class="line">&lt;html&gt;&lt;h1&gt;Hello from Web Server - Virgina Area&lt;/h1&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure><ul><li>Cloudwatch Log ì—ë„ geop2 ìœ¼ë¡œ DNS ì¿¼ë¦¬ ë¡œê·¸ í™•ì¸</li></ul></li></ul><hr><br><h3 id="5-Route-53-Policy-Delete"><a href="#5-Route-53-Policy-Delete" class="headerlink" title="5. Route 53 Policy Delete"></a>5. Route 53 Policy Delete</h3><ul><li>[Route53 - ì •ì±… ë ˆì½”ë“œ] ì •ì±… 2ê°œ ì„ íƒ í›„ <code>ì •ì±… ë ˆì½”ë“œ ì‚­ì œ</code></li><li>[Route53 - íŠ¸ë˜í”½ ì •ì±…] íŠ¸ë˜í”½ ì •ì±… ì„ íƒ í›„ <code>íŠ¸ë˜í”½ ì •ì±… ì‚­ì œ</code></li><li>[Route53 - í˜¸ìŠ¤íŒ… ì˜ì—­] ë„ë©”ì¸ ì˜† âšªï¸ ì„ íƒ í›„ ìš°ì¸¡ì— <code>ì¿¼ë¦¬ ë¡œê¹… ì‚­ì œ</code><ul><li>(ë²„ì§€ë‹ˆì•„ ë¦¬ì „) [Cloudwatch - ë¡œê·¸ê·¸ë£¹] aws/route53/ë„ë©”ì¸ ì„ íƒ í›„ <code>ì‘ì—… - ë¡œê·¸ ê·¸ë£¹ ì‚­ì œ</code></li></ul></li></ul><br>]]></content:encoded>
      
      <comments>http://cloudneta.github.io/2020/05/06/Route53-Geoproximity/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Route53 Geolocation</title>
      <link>http://cloudneta.github.io/2020/05/06/Route53-Geolocation/</link>
      <guid>http://cloudneta.github.io/2020/05/06/Route53-Geolocation/</guid>
      <pubDate>Wed, 06 May 2020 03:02:10 GMT</pubDate>
      <description>
      
        &lt;p&gt;&lt;em&gt;ì‘ì„±ì : gasida.cloudnet@&lt;/em&gt;&lt;/p&gt;
      
      </description>
      
      
      <content:encoded><![CDATA[<p><em>ì‘ì„±ì : gasida.cloudnet@</em></p><a id="more"></a><br><details><summary>AWS Document Route53</summary><div markdown="1"><ul><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL1JvdXRlNTMvbGF0ZXN0L0RldmVsb3Blckd1aWRlL1dlbGNvbWUuaHRtbA==">Route53 ì„¤ëª…ì„œ<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL1JvdXRlNTMvbGF0ZXN0L0RldmVsb3Blckd1aWRlL3JlZ2lzdHJhci10bGQtbGlzdC5odG1s">Route53 ë“±ë¡ ê°€ëŠ¥ ë„ë©”ì¸<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL1JvdXRlNTMvbGF0ZXN0L0RldmVsb3Blckd1aWRlL3JvdXRpbmctcG9saWN5Lmh0bWw=">Route53 ë¼ìš°íŒ… ì •ì±…<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL1JvdXRlNTMvbGF0ZXN0L0RldmVsb3Blckd1aWRlL3JvdXRpbmctcG9saWN5Lmh0bWwjcm91dGluZy1wb2xpY3ktZWRuczA=">Amazon Route 53ì—ì„œ EDNS0ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ìœ„ì¹˜ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ë°©ë²•<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9wcmVtaXVtc3VwcG9ydC9rbm93bGVkZ2UtY2VudGVyL3Ryb3VibGVzaG9vdC1yb3V0ZTUzLWdlb2xvY2F0aW9uLw==">Route53 ì ê²€ë°©ë²•1<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9wcmVtaXVtc3VwcG9ydC9rbm93bGVkZ2UtY2VudGVyL3Ryb3VibGVzaG9vdC1sYXRlbmN5LWJhc2VkLXJlY29yZHMv">Route53 ì ê²€ë°©ë²•2<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL1JvdXRlNTMvbGF0ZXN0L0RldmVsb3Blckd1aWRlL3F1ZXJ5LWxvZ3MuaHRtbA==">Route53 ì¿¼ë¦¬ ë¡œê¹… ì„¤ì •<i class="fa fa-external-link-alt"></i></span></li></ul></div></details><br><details><summary>DNS GeoLocation ë° ê¸°íƒ€</summary><div markdown="1"><ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cubmV0bWFuaWFzLmNvbS9rby9wb3N0L2Jsb2cvNTM1OS9ha2FtYWktY2RuLWRucy1nb29nbGUtbmV0d29yay1wcm90b2NvbC9hbnN3ZXItZ29vZ2xlLWRucy1ha2FtYWktY2Ru">DNS ì™€ CDN ì˜ ë™ì‘<i class="fa fa-external-link-alt"></i></span> (ë„·ë§¤ë‹ˆì•„ì¦ˆ 2011)</li><li><span class="exturl" data-url="aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzc4NzE=">RFC 7871 - Client Subnet in DNS Queries<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20va28ta3Ivd2luZG93cy1zZXJ2ZXIvbmV0d29ya2luZy9kbnMvZGVwbG95L3ByaW1hcnktZ2VvLWxvY2F0aW9u">Windows DNS - ìœ„ì¹˜ê¸°ë°˜<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cudGVjbWludC5jb20vZmluZC1saW51eC1zZXJ2ZXItZ2VvZ3JhcGhpYy1sb2NhdGlvbi8=">IP ë¡œ ìœ„ì¹˜ ì°¾ê¸°<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9wdWJsaWMtZG5zLmluZm8vbmFtZXNlcnZlci91cy5odG1s">Public DNS List<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9jYWNoZWNoZWNrLm9wZW5kbnMuY29tLw==">DNS Cache check (OpenDNS)<i class="fa fa-external-link-alt"></i></span></li></ul></div></details><br><blockquote><p>ğŸ’¡ AWS ì„œë¹„ìŠ¤ ê´€ë ¨í•´ì„œëŠ” í•­ìƒ ìµœìš°ì„ ìœ¼ë¡œ â€˜AWS ì„¤ëª…ì„œâ€™ ë¥¼ ì½ì–´ë³´ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤. í•œê¸€ ë²ˆì—­ì´ ë§¤ë„ëŸ½ì§€ ëª»í•˜ë©´ English ë¡œ ë³€ê²½ í›„ ì½ì–´ë³´ê¸°ë¥¼ ë°”ë€ë‹¤.</p></blockquote><hr><br><h3 id="1-AWS-Route-53-amp-Geolocation-Routing-Policy"><a href="#1-AWS-Route-53-amp-Geolocation-Routing-Policy" class="headerlink" title="1. AWS Route 53 &amp; Geolocation Routing Policy"></a>1. AWS Route 53 &amp; Geolocation Routing Policy</h3><ul><li>AWS Route 53 ì€ AWS ê´€ë¦¬í˜•ì˜ DNS(Domain Name Server) ì´ë‹¤.<ul><li>Hosted private or public zones (including subdomains)</li><li>Health checks, routing policies and failovers</li></ul></li><li>ë„ë©”ì¸ ë“±ë¡, DNS ë¼ìš°íŒ…, ìƒíƒœ í™•ì¸ì„ ì¡°í•©í•˜ì—¬ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.</li></ul><br><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL1JvdXRlNTMvbGF0ZXN0L0RldmVsb3Blckd1aWRlL3dlbGNvbWUtZG5zLXNlcnZpY2UuaHRtbCN3ZWxjb21lLWRucy1zZXJ2aWNlLWhvdy1yb3V0ZS01My1yb3V0ZXMtdHJhZmZpYw==">1.1 Amazon Route 53ì´ ë„ë©”ì¸ì˜ íŠ¸ë˜í”½ì„ ë¼ìš°íŒ…í•˜ëŠ” ë°©ë²•<i class="fa fa-external-link-alt"></i></span></p><ul><li><p>ì‚¬ìš©ìê°€ ì›¹ ì„œë²„ì— ì ‘ì† ì‹œ DNS ì„œë²„ë¥¼ í†µí•˜ì—¬ ë„ë©”ì¸ ì£¼ì†Œë¥¼ IP ì£¼ì†Œë¡œ ì „ë‹¬ ë°›ì€ í›„ í•´ë‹¹ IPë¡œ ì ‘ì†ì„ í•œë‹¤</p><p>  <img src="/images/Route53-Geolocation/Untitled.png" alt="Route53%20Geolocation%20247d8a8c113e42e29a751d6e98ff864f/Untitled.png"></p><p>  ê·¸ë¦¼ ì¶œì²˜ <span class="exturl" data-url="aHR0cHM6Ly9hbXpuLnRvLzNhRE9keks=">https://amzn.to/3aDOdzK<i class="fa fa-external-link-alt"></i></span></p></li></ul><br><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL1JvdXRlNTMvbGF0ZXN0L0RldmVsb3Blckd1aWRlL3JvdXRpbmctcG9saWN5Lmh0bWwjcm91dGluZy1wb2xpY3ktZ2Vv">1.2 Geolocation Routing Policy<i class="fa fa-external-link-alt"></i></span></p><ul><li>EDNS ë¥¼ ì§€ì›í•˜ëŠ” Local DNS ì„œë²„ì— ë”°ë¼ì„œ ë™ì‘ ë°©ì‹ì´ ë‹¬ë¼ì§„ë‹¤</li></ul><p>1.2.1 Local DNS ì„œë²„ê°€ EDNS ë¥¼ ë¯¸ì§€ì› í•˜ëŠ” ê²½ìš°</p><ul><li><p>Geolocation ì •ì±…ì€ ê¸°ë³¸ì ìœ¼ë¡œ DNS ì§ˆì˜(Query)ë¥¼ í•˜ëŠ” Local DNS Server(ì˜ˆ, KT DNS ë“±)ì˜ IPì˜ ìœ„ì¹˜ë¥¼ ê¸°ë°˜í•˜ì—¬ AWS Route 53ì— ì§€ì •ëœ IP ì •ë³´ë¥¼ ì „ë‹¬(Answer)í•œë‹¤</p></li><li><p>ì•„ë˜ì²˜ëŸ¼ í•œêµ­ì— PCì—ì„œ í•œêµ­ DNSì„œë²„(168.126.63.1)ë¡œ <span class="exturl" data-url="aHR0cDovL3d3dy5nc2lkYS5uZXQ=">www.gsida.net<i class="fa fa-external-link-alt"></i></span> ì§ˆì˜ ì‹œ í•œêµ­ DNSì„œë²„ëŠ” ìì‹ ì˜ IPë¡œ AWS Route53ì— ì§ˆì˜í•˜ê²Œ ëœë‹¤.</p></li><li><p>ì´ë•Œ Route53ì€ í•œêµ­DNS ì„œë²„ì˜ IPë¥¼ í™•ì¸í•˜ê³  ìœ„ì¹˜ê°€ í•œêµ­ì¸ ê²ƒì„ ì•Œê³  Seoul-Web ì˜ IPì •ë³´ì¸ 60.1.1.1 ì„ ì „ë‹¬í•œë‹¤.</p><p>  <img src="/images/Route53-Geolocation/Untitled1.png" alt="Route53%20Geolocation%20247d8a8c113e42e29a751d6e98ff864f/Untitled%201.png"></p></li></ul><p>1.2.2 Local DNS ì„œë²„ê°€ EDNS ë¥¼ ì§€ì› í•˜ëŠ” ê²½ìš°</p><ul><li><p>DNS ì„œë²„(ì˜ˆ. êµ¬ê¸€DNS 8.8.8.8)ê°€ ENDS ë¥¼ ì§€ì›í•˜ëŠ” ê²½ìš° ì‚¬ìš©ìê°€ DNS ì§ˆì˜ ì‹œ ì‚¬ìš©ìì˜ IPëŒ€ì—­ì„ DNS í™•ì¥ í—¤ë”ì— ë‹´ì•„ì„œ AWS Route 53ì— ì§ˆì˜ë¥¼ í•˜ê²Œ ëœë‹¤.</p></li><li><p>AWS Route 53 ì—­ì‹œ EDNS ë¥¼ ì§€ì›í•˜ë¯€ë¡œ DNS í™•ì¥ í—¤ë”ì˜ Client-Subnet ì˜ ëŒ€ì—­ì˜ IPì˜ ìœ„ì¹˜ë¥¼ ê¸°ì¤€í•˜ì—¬ ê²°ì •í•œë‹¤</p><p>  <img src="/images/Route53-Geolocation/Untitled2.png" alt="Route53%20Geolocation%20247d8a8c113e42e29a751d6e98ff864f/Untitled%202.png"></p></li></ul><hr><br><h3 id="2-DNS-ë™ì‘ì—-ëŒ€í•œ-ì˜¤í•´"><a href="#2-DNS-ë™ì‘ì—-ëŒ€í•œ-ì˜¤í•´" class="headerlink" title="2. DNS ë™ì‘ì— ëŒ€í•œ ì˜¤í•´"></a>2. DNS ë™ì‘ì— ëŒ€í•œ ì˜¤í•´</h3><ul><li>DNS ì„œë²„ë¡œ ë°ì´í„° íŠ¸ë˜í”½(ì›¹ íŠ¸ë˜í”½)ì´ ì „ë‹¬ ëœë‹¤.<ul><li>ğŸ™…ğŸ»â€â™€ï¸No! ìœ„ ê·¸ë¦¼ ë™ì‘ì„ ë³´ë©´ ì•Œê² ì§€ë§Œ DNS íŠ¸ë˜í”½ì€ ì‚¬ëŒì´ ì•Œê¸° ì‰¬ìš´ â€˜ë„ë©”ì¸ ì£¼ì†Œ(ì˜ˆ. <span class="exturl" data-url="aHR0cDovL3d3dy5kYXVtLm5ldCkmIzM5Ow==">www.daum.net)&#39;<i class="fa fa-external-link-alt"></i></span> ì— ëŒ€í•œ â€˜IP ì£¼ì†Œâ€™ë¥¼ ì•Œì•„ì˜¤ëŠ” ê³¼ì •ì´ë‹¤.</li><li>ì‹¤ì œ â€˜IPì£¼ì†Œâ€™ ë¥¼ ì•Œì•„ì˜¨ ì´í›„ì—ëŠ”  í•´ë‹¹ ë‹¨ë§PCì—ì„œ â€˜ì›¹ì„œë²„ IPâ€™ ë¡œ ì§ì ‘ ë°ì´í„° íŠ¸ë˜í”½(ì›¹ íŠ¸ë˜í”½) í†µì‹ ì„ ì‹œì‘í•œë‹¤.</li></ul></li><li>DNS ì„œë²„ëŠ” ì‚¬ìš©ìì˜ IPë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì •í™•í•œ ìœ„ì¹˜ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤.<ul><li>ğŸ™…ğŸ»â€â™€ï¸ê¼­ ê·¸ë ‡ì§€ë§Œì€ ì•ŠëŠ”ë‹¤. ì˜ˆë¥¼ ë“¤ë©´ í•œêµ­ì— ë‹¨ë§PCì— ë¯¸êµ­DNSì„œë²„ë¥¼ ì„¤ì •í•˜ê²Œ ë˜ë©´ DNSì§ˆì˜ ì‹œ ë¯¸êµ­DNSì„œë²„ IPì´ë¯€ë¡œ ë¯¸êµ­ì›¹ì„œë²„ IPë¥¼ ì•Œë ¤ì¤€ë‹¤.</li><li>ì¦‰, Geolocation ì˜ ê¸°ë³¸ ë™ì‘ì€ ìµœì¢… DNS Query í•˜ëŠ” ì†ŒìŠ¤IPì˜ ìœ„ì¹˜(ì¼ë°˜ì ì¸ ë¡œì»¬DNSì„œë²„)ë¥¼ ê¸°ë°˜í•˜ì—¬ â€˜IPì£¼ì†Œâ€™ ê°’ì„ ë°˜í™˜í•œë‹¤</li></ul></li><li>ê·¸ëŸ¼ ì‚¬ìš©ìì˜ IPë¥¼ ì•Œ ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì—†ë‚˜ìš”?<ul><li>ê·¸ë˜ì„œ DNSì— í™•ì¥ í•„ë“œ EDNS ì— Client Subnet í•„ë“œë¥¼ í†µí•´ì„œ â€˜ìµœì¢… ì‚¬ìš©ìâ€™ì˜ IP ëŒ€ì—­ ì •ë³´ë¥¼ ì „ë‹¬í•¨ìœ¼ë¡œì¨ DNSì„œë²„ê°€ ì‚¬ìš©ìì˜ ìœ„ì¹˜ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤</li></ul></li></ul><hr><br><h3 id="3-Lab-Topology"><a href="#3-Lab-Topology" class="headerlink" title="3. Lab Topology"></a>3. Lab Topology</h3><ul><li><p>Route 53 DNS - GeoLocation Policy â†’ <span class="exturl" data-url="aHR0cDovL2dlb2xvLmdhc2lkYS5uZXQ=">geolo.gasida.net<i class="fa fa-external-link-alt"></i></span></p><ul><li>Query IPê°€ í•œêµ­ ì¼ ê²½ìš° â†’ í•œêµ­ ìœ„ì¹˜í•œ ì›¹ì„œë²„ IP ì •ë³´ë¥¼ ì „ë‹¬</li><li>Query IPê°€ ë¯¸êµ­ ì¼ ê²½ìš° â†’ ë¯¸êµ­ ìœ„ì¹˜í•œ ì›¹ì„œë²„ IP ì •ë³´ë¥¼ ì „ë‹¬</li></ul></li><li><p>ë‹¨ë§</p><ul><li><p>í•œêµ­ ìœ„ì¹˜ ë‹¨ë§ : IPì£¼ì†Œ(í•œêµ­ ìœ„ì¹˜ IP), DNSì„œë²„(í•œêµ­ ìœ„ì¹˜í•œ DNS ì„œë²„ IP)</p></li><li><p>ë¯¸êµ­ ìœ„ì¹˜ ë‹¨ë§ : IPì£¼ì†Œ(ë¯¸êµ­ ìœ„ì¹˜ IP), DNSì„œë²„(ë¯¸êµ­ ìœ„ì¹˜í•œ DNS ì„œë²„ IP)</p><p>  <img src="/images/Route53-Geolocation/Untitled3.png" alt="Route53%20Geolocation%20247d8a8c113e42e29a751d6e98ff864f/Untitled%203.png"></p></li></ul></li></ul><hr><br><h3 id="4-Config-Geolocation-Policy-amp-Logging"><a href="#4-Config-Geolocation-Policy-amp-Logging" class="headerlink" title="4. Config Geolocation Policy &amp; Logging"></a>4. Config Geolocation Policy &amp; Logging</h3><br><p>4.1 AWS Web EC2 ì„¤ì •</p><ul><li>Seoul-Web : ì„œìš¸ë¦¬ì „, Public Subnet ì— ìƒì„± ë° ì›¹ ì„œë²„ ì„¤ì¹˜ â†’ EC2 Public IP <strong>3.34.3.33</strong></li></ul><details><summary>EC2 ìƒì„± ì‹œ User Data ì— ì…ë ¥ : ì›¹ ì„œë²„ ì„¤ì¹˜, index.html ìƒì„±</summary><div markdown="1"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">AZ=`curl -s http://169.254.169.254/latest/meta-data/placement/availability-zone`</span><br><span class="line">IP=`curl -s http://169.254.169.254/latest/meta-data/<span class="built_in">local</span>-ipv4`</span><br><span class="line">yum install -y httpd</span><br><span class="line">service httpd start</span><br><span class="line">chkconfig httpd on</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;html&gt;&lt;h1&gt;Hello from Web Server - Region ( "</span><span class="variable">$AZ</span><span class="string">" ) - Private IP ( "</span><span class="variable">$IP</span><span class="string">" )&lt;/h1&gt;&lt;/html&gt;"</span> &gt; /var/www/html/index.html</span><br></pre></td></tr></table></figure></div></details><br><ul><li>Virginia-Web : ë²„ì§€ë‹ˆì•„ë¦¬ì „, Public Subnet ì— ìƒì„± ë° ì›¹ ì„œë²„ ì„¤ì¹˜ â†’ EC2 Public IP <strong>18.206.97.145</strong></li></ul><details><summary>EC2 ìƒì„± ì‹œ User Data ì— ì…ë ¥ : ì›¹ ì„œë²„ ì„¤ì¹˜, index.html ìƒì„±</summary><div markdown="1"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">AZ=`curl -s http://169.254.169.254/latest/meta-data/placement/availability-zone`</span><br><span class="line">IP=`curl -s http://169.254.169.254/latest/meta-data/<span class="built_in">local</span>-ipv4`</span><br><span class="line">yum install -y httpd</span><br><span class="line">service httpd start</span><br><span class="line">chkconfig httpd on</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;html&gt;&lt;h1&gt;Hello from Web Server - Region ( "</span><span class="variable">$AZ</span><span class="string">" ) - Private IP ( "</span><span class="variable">$IP</span><span class="string">" )&lt;/h1&gt;&lt;/html&gt;"</span> &gt; /var/www/html/index.html</span><br></pre></td></tr></table></figure></div></details><br><p>4.2 ë‹¨ë§ ì„¤ì •</p><ul><li>í•œêµ­ ìœ„ì¹˜ ë‹¨ë§ : ìì‹ ì˜ PCë¥¼ í™œìš©, DNSì„œë²„ (168.126.63.1) â†’ 220.117.X.Y</li><li>ë¯¸êµ­ ìœ„ì¹˜ ë‹¨ë§ : í•„ìëŠ” GCP í™œìš©, DNSì„œë²„(192.221.159.0) â†’ 35.186.188.100</li></ul><details><summary>VM Instance ìƒì„± ì‹œ ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸ì— ì…ë ¥ : DNS ê´€ë ¨ íˆ´ ì„¤ì¹˜, ê¸°ë³¸ DNSë¥¼ ë³€ê²½</summary><div markdown="1"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">yum -y install <span class="built_in">bind</span>-utils traceroute dig jq</span><br><span class="line">sed -i <span class="string">"s/^nameserver 169.254.169.254/nameserver 192.221.159.0/g"</span> /etc/resolv.conf</span><br></pre></td></tr></table></figure></div></details><br><p>4.3 AWS Route 53 ì„¤ì •</p><ul><li>[Route 53 - í˜¸ìŠ¤íŒ… ì˜ì—­ - ë ˆì½”ë“œ ì„¸íŠ¸ ìƒì„±] geolo.gasida.net</li></ul><details><summary>í•œêµ­ ìœ„ì¹˜ ì‹œ í•œêµ­ ì›¹ì„œë²„ ì „ë‹¬ ë ˆì½”ë“œ ìƒì„±</summary><div markdown="1"><pre><code>- ì´ë¦„: **geolo**.gasida.net- ìœ í˜•: **A - IPv4 ì£¼ì†Œ**- ë³„ì¹¨: **ì•„ë‹ˆìš”**- TTL(ì´ˆ): **300**- ê°’: **3.34.3.33**- ë¼ìš°íŒ… ì •ì±…: **ì§€ë¦¬ì  ìœ„ì¹˜**    - ìœ„ì¹˜: **ëŒ€í•œë¯¼êµ­**    - ì„¸íŠ¸ ID(*ì„¤ëª…, ì¼ì¢…ì˜ ì£¼ì„*): **í•œêµ­IPë§Œ í—ˆìš©**- ìƒíƒœ ê²€ì‚¬ì™€ ì—°ê²°: **ì•„ë‹ˆìš”**    - í•˜ë‹¨ `ìƒì„±` í´ë¦­</code></pre></div></details><br><details><summary>ë¯¸êµ­ ìœ„ì¹˜ ì‹œ í•œêµ­ ì›¹ì„œë²„ ì „ë‹¬ ë ˆì½”ë“œ ìƒì„±</summary><div markdown="1"><pre><code>- ì´ë¦„: **geolo**.gasida.net- ìœ í˜•: **A - IPv4 ì£¼ì†Œ**- ë³„ì¹¨: **ì•„ë‹ˆìš”**- TTL(ì´ˆ): **300**- ê°’: **18.206.97.145**- ë¼ìš°íŒ… ì •ì±…: **ì§€ë¦¬ì  ìœ„ì¹˜**    - ìœ„ì¹˜: **ë¯¸êµ­**        - í•˜ìœ„ ìœ„ì¹˜: skip â†’ ë¯¸êµ­ì˜ ê²½ìš° ì£¼ë³„ë¡œ ì œí•œ ì„¤ì • ê°€ëŠ¥    - ì„¸íŠ¸ ID(*ì„¤ëª…, ì¼ì¢…ì˜ ì£¼ì„*): **ë¯¸êµ­IPë§Œ í—ˆìš©**- ìƒíƒœ ê²€ì‚¬ì™€ ì—°ê²°: **ì•„ë‹ˆìš”**    - í•˜ë‹¨ `ìƒì„±` í´ë¦­</code></pre></div></details><ul><li><p>ìœ„ì¹˜ë¥¼ â€˜ê¸°ë³¸ê°’â€™ ì„ ì„¤ì •ì„ í•´ì•¼ ìœ„ â€˜í•œêµ­ê³¼ ë¯¸êµ­ ìœ„ì¹˜â€™ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ê³³ì—ì„œ ì ‘ì†ì´ ê°€ëŠ¥í•˜ë‹¤ â‡’ ì¦‰, ì§€ë¦¬ì  ì ‘ì† ì œí•œ ê°€ëŠ¥</p><p>  <img src="/images/Route53-Geolocation/Untitled4.png" alt="Route53%20Geolocation%20247d8a8c113e42e29a751d6e98ff864f/Untitled%204.png"></p></li></ul><br><ul><li><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2tvX2tyL1JvdXRlNTMvbGF0ZXN0L0RldmVsb3Blckd1aWRlL3F1ZXJ5LWxvZ3MuaHRtbA==">í•´ë‹¹ í˜¸ìŠ¤íŒ… ì˜ì—­ â€˜ì¿¼ë¦¬ ë¡œê¹…â€™ ì„¤ì •<i class="fa fa-external-link-alt"></i></span></p><ul><li><p>[Route 53 - í˜¸ìŠ¤íŒ… ì˜ì—­] ë„ë©”ì¸  ì„ íƒ í›„ ìš°ì¸¡ í•˜ë‹¨ì— <code>ì¿¼ë¦¬ ë¡œê¹…</code> ì„¤ì • : ë™ì‘ ë°œìƒ í›„ 50ì´ˆ ì •ë„ í›„ì— CloudWatch Log ë¡œ ìˆ˜ì§‘ëœë‹¤</p><ul><li>ìƒˆ ë¡œê·¸ ê·¸ë£¹ ìƒì„± : /aws/route53/hosted-zone-name (í•„ìëŠ” gasida ë¡œ ì„¤ì •)</li><li>ìƒˆ ë¦¬ì†ŒìŠ¤ ì •ì±… ìƒì„±</li></ul><p><img src="/images/Route53-Geolocation/Untitled5.png" alt="Route53%20Geolocation%20247d8a8c113e42e29a751d6e98ff864f/Untitled%205.png"></p></li></ul></li></ul><hr><br><h3 id="5-Verify"><a href="#5-Verify" class="headerlink" title="5. Verify"></a>5. Verify</h3><br><p>5.1 ê¸°ë³¸ ì •ë³´ í™•ì¸</p><ul><li><p>ë‹¨ë§ : ìì‹ ì˜ ê³µì¸IP ì •ë³´ì™€ ìœ„ì¹˜ ì •ë³´ë¥¼ í™•ì¸, DNSì„œë²„ í™•ì¸, ì›¹ ì„œë¹„ìŠ¤ í™•ì¸(EC2 Public IP)</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># í•œêµ­ ìœ„ì¹˜ ë‹¨ë§ (ìœˆë„ìš° ë‹¨ë§ì˜ ê²½ìš° dig ëŒ€ì‹  nslookup ì‚¬ìš©)</span></span><br><span class="line">curl https://checkip.amazonaws.com/</span><br><span class="line">curl https://ipvigilante.com/220.117.X.Y</span><br><span class="line">curl -s https://ipvigilante.com/$(curl -s checkip.amazonaws.com) | jq <span class="string">'.data.country_name, .data.city_name, .data.ipv4'</span></span><br><span class="line"><span class="string">"Republic of Korea"</span></span><br><span class="line"><span class="string">"Seoul"</span></span><br><span class="line"><span class="string">"220.117.X.Y"</span></span><br><span class="line"></span><br><span class="line">dig www.google.com |grep SERVER</span><br><span class="line">;; SERVER: 168.126.63.1<span class="comment">#53(168.126.63.1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ë¯¸êµ­ ìœ„ì¹˜ ë‹¨ë§</span></span><br><span class="line">curl -s https://ipvigilante.com/$(curl -s checkip.amazonaws.com) | jq <span class="string">'.data.country_name, .data.city_name, .data.ipv4'</span></span><br><span class="line"><span class="string">"United States"</span></span><br><span class="line"><span class="string">"Ann Arbor"</span></span><br><span class="line"><span class="string">"35.245.140.130"</span></span><br><span class="line"></span><br><span class="line">dig www.google.com |grep SERVER</span><br><span class="line">;; SERVER: 192.221.159.0<span class="comment">#53(192.221.159.0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># EC2 ì›¹ì„œë¹„ìŠ¤ í™•ì¸</span></span><br><span class="line">curl 3.34.3.33</span><br><span class="line">&lt;html&gt;&lt;h1&gt;Hello from MCN Web Server - Seoul Area&lt;/h1&gt;&lt;/html&gt;</span><br><span class="line">curl 18.206.97.145</span><br><span class="line">&lt;html&gt;&lt;h1&gt;Hello from MCN Web Server - Virgina Area&lt;/h1&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure></li></ul><br><p>5.2 <span class="exturl" data-url="aHR0cDovL2dlb2xvLmdhc2lkYS5uZXQ=">geolo.gasida.net<i class="fa fa-external-link-alt"></i></span> DNSì¡°íšŒ ë° ì ‘ì† í™•ì¸</p><ul><li><p>í•œêµ­ ìœ„ì¹˜ ë‹¨ë§(í•œêµ­ DNSì„œë²„)ì™€ ë¯¸êµ­ ìœ„ì¹˜ ë‹¨ë§(ë¯¸êµ­ DNSì„œë²„)ê°€ ê°ê° ê°€ê¹Œìš´ ìœ„ì¹˜ì˜ ì›¹ ì„œë²„ë¡œ ì ‘ì†ë¨ì„ í™•ì¸</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># í•œêµ­ ë‹¨ë§ (ìœˆë„ìš° ë‹¨ë§ì˜ ê²½ìš° dig ëŒ€ì‹  nslookup ì‚¬ìš©)</span></span><br><span class="line">curl geolo.gasida.net</span><br><span class="line">&lt;html&gt;&lt;h1&gt;Hello from MCN Web Server - Seoul Area&lt;/h1&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">dig geolo.gasida.net +short</span><br><span class="line">3.34.3.33</span><br><span class="line"></span><br><span class="line"><span class="comment"># ë¯¸êµ­ ë‹¨ë§</span></span><br><span class="line">curl geolo.gasida.net</span><br><span class="line">&lt;html&gt;&lt;h1&gt;Hello from MCN Web Server - Virgina Area&lt;/h1&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">dig geolo.gasida.net +short</span><br><span class="line">18.206.97.145</span><br></pre></td></tr></table></figure></li><li><p>DNS Query Log ( ë¡œê·¸ê·¸ë£¹ë³´ê¸°, í•„í„° geolo -â€œAAAAâ€ )</p><ul><li><p>KT DNSì„œë²„ ì—ì„œ ì†ŒìŠ¤IPë¥¼ 121.138.224.3(í•œêµ­IP) ë¡œ AWS Route53(gasida.net)ë¡œ ì§ˆì˜ë¥¼ í–ˆìŒ â‡’ Seoul-Web IP ì •ë³´ë¥¼ ì „ë‹¬</p></li><li><p>ë¯¸êµ­ DNSì„œë²„ ì—ì„œ ì†ŒìŠ¤IPë¥¼ 192.221.159.15(ë¯¸êµ­IP) ë¡œ AWS Route53(gasida.net)ë¡œ ì§ˆì˜ë¥¼ í–ˆìŒ â‡’ Virginia-Web IP ì •ë³´ë¥¼ ì „ë‹¬</p><p>  <img src="/images/Route53-Geolocation/Untitled6.png" alt="Route53%20Geolocation%20247d8a8c113e42e29a751d6e98ff864f/Untitled%206.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">geolo.gasida.net A NOERROR UDP ICN51-C1 (121.138.224.3 &#x3D; í•œêµ­ KT IP)</span><br><span class="line">geolo.gasida.net A NOERROR UDP ATL51-C1 (192.221.159.15 &#x3D; ë¯¸êµ­ Lv3 LLC IP)</span><br></pre></td></tr></table></figure></li></ul></li></ul><br><p>(ì˜µì…˜) 5.3 í•œêµ­ê³¼ ë¯¸êµ­ì´ ì•„ë‹Œ íƒ€ ë‚˜ë¼ì˜ ì‚¬ìš©ìì—ì„œ ì ‘ì† í™•ì¸</p><details><summary>í˜„ì¬ 'í•œêµ­ , ë¯¸êµ­' ì´ì™¸ì— íƒ€ ë‚˜ë¼(ì˜ˆ, ì¤‘êµ­ ë‹¨ë§ì—ì„œ í…ŒìŠ¤íŠ¸)ì—ì„œëŠ” DNS Query ì— ëŒ€í•œ ì‘ë‹µì„ í•˜ì§€ ì•ŠëŠ”ë‹¤</summary><div markdown="1"><ul><li>ì´ëŸ´ ê²½ìš°ì— ìœ„ì¹˜ë¥¼ <code>ê¸°ë³¸ê°’</code> ì„ ì„ íƒí•˜ê²Œ ë˜ë©´ ì§€ë¦¬ ìœ„ì¹˜ì— ë§¤ì¹­ë˜ì§€ ì•ŠëŠ” ëª¨ë“  ê²½ìš°ì— <code>ê¸°ë³¸ê°’</code>ì— ì •ì˜ëœ IP ì •ë³´ë¥¼ ì „ë‹¬í•´ì¤€ë‹¤</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ì¤‘êµ­ ë‹¨ë§</span></span><br><span class="line">curl -s https://ipvigilante.com/$(curl -s checkip.amazonaws.com) | jq <span class="string">'.data.country_name, .data.city_name, .data.ipv4'</span></span><br><span class="line"><span class="string">"China"</span></span><br><span class="line"><span class="string">"Suzhou"</span></span><br><span class="line"><span class="string">"103.125.234.199"</span></span><br><span class="line"></span><br><span class="line">curl geox.gasida.net</span><br><span class="line">curl: (6) Could not resolve host: geox.gasida.net</span><br><span class="line"></span><br><span class="line">dig geox.gasida.net +short</span><br></pre></td></tr></table></figure></div></details><hr><br><h3 id="6-Issue"><a href="#6-Issue" class="headerlink" title="6. Issue"></a>6. Issue</h3><ul><li><p>VPN, CDN í™˜ê²½ì´ë‚˜ í˜¹ì€ ì•„ë˜ ì²˜ëŸ¼ ë‹¤ë¥¸ ì§€ì—­ì˜ DNSì„œë²„ë¥¼ ì„¤ì • í•  ê²½ìš° Issue ê°€ ë°œìƒí•œë‹¤</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ë¯¸êµ­ ë‹¨ë§ DNSì„œë²„ë¥¼ KT DNSë¡œ ë³€ê²½</span></span><br><span class="line">cat /etc/resolv.conf |grep ^name</span><br><span class="line">nameserver 192.221.159.0</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">"s/^nameserver 192.221.159.0/nameserver 168.126.63.1/g"</span> /etc/resolv.conf</span><br><span class="line"></span><br><span class="line">dig www.google.com |grep SERVER</span><br><span class="line">;; SERVER: 168.126.63.1<span class="comment">#53(168.126.63.1)</span></span><br></pre></td></tr></table></figure><p>  <img src="/images/Route53-Geolocation/Untitled7.png" alt="Route53%20Geolocation%20247d8a8c113e42e29a751d6e98ff864f/Untitled%207.png"></p></li><li><p>ì•„ë˜ ì²˜ëŸ¼ ì‹¤ì œë¡œëŠ” ë¯¸êµ­ì— ìœ„ì¹˜í•œ ë‹¨ë§ì—ì„œ ì›¹ ì ‘ì† ì‹œ ìì‹ ì˜ ìœ„ì¹˜ì™€ ë–¨ì–´ì§„ ë¯¸êµ­ì— ìœ„ì¹˜í•œ ì›¹ì„œë²„ë¡œ ì ‘ì†ì„ í•œë‹¤</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ë¯¸êµ­ ë‹¨ë§</span></span><br><span class="line">curl -s https://ipvigilante.com/$(curl -s checkip.amazonaws.com) | jq <span class="string">'.data.country_name, .data.city_name, .data.ipv4'</span></span><br><span class="line"><span class="string">"United States"</span></span><br><span class="line"><span class="string">"Ann Arbor"</span></span><br><span class="line"><span class="string">"35.245.140.130"</span></span><br><span class="line"></span><br><span class="line">curl geolo.gasida.net</span><br><span class="line">&lt;html&gt;&lt;h1&gt;Hello from MCN Web Server - Seoul Area&lt;/h1&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">dig geolo.gasida.net +short</span><br><span class="line">3.34.3.33</span><br></pre></td></tr></table></figure></li><li><p>Route Query Log í™•ì¸í•˜ë©´ KT DNS IPê°€ Queryë¥¼ í–ˆìŒë¯€ë¡œ í•œêµ­ì— ìœ„ì¹˜í•œ ì›¹ì„œë²„ IP ì£¼ì†Œë¥¼ ì „ë‹¬í–ˆë‹¤</p><p>  <img src="/images/Route53-Geolocation/Untitled8.png" alt="Route53%20Geolocation%20247d8a8c113e42e29a751d6e98ff864f/Untitled%208.png"></p></li></ul><hr><br><h3 id="7-EDNS-Client-Subnet"><a href="#7-EDNS-Client-Subnet" class="headerlink" title="7. EDNS Client Subnet"></a>7. EDNS Client Subnet</h3><ul><li><p>ì‚¬ìš©ìì˜ ìœ„ì¹˜(IP)ë¥¼ ìµœì¢… DNSì„œë²„ê°€ ì•Œê¸° ìœ„í•´ì„œ DNSì— í™•ì¥ í•„ë“œ EDNS ì— Client Subnet í•„ë“œë¥¼ í†µí•´ì„œ â€˜ìµœì¢… ì‚¬ìš©ìâ€™ì˜ IP ëŒ€ì—­ ì •ë³´ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzc4NzE=">Client Subnet in DNS Queries<i class="fa fa-external-link-alt"></i></span> (RFC 7871)</li></ul></li><li><p>EDNS ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” DNS ì„œë²„ : êµ¬ê¸€ DNS ì„œë²„( 8.8.8.8 8.8.8.4 ) , OpenDNS ì„œë²„ ( 208.67.222.222 208.67.220.220)</p><ul><li><p><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9rby9wcmVtaXVtc3VwcG9ydC9rbm93bGVkZ2UtY2VudGVyL3Ryb3VibGVzaG9vdC1sYXRlbmN5LWJhc2VkLXJlY29yZHMv">EDNS ê¸°ëŠ¥ ì œê³µ í™•ì¸<i class="fa fa-external-link-alt"></i></span></p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EDNS ì œê³µ ì‹œ</span></span><br><span class="line">dig +nocl TXT o-o.myaddr.l.google.com @8.8.8.8 +short</span><br><span class="line"><span class="string">"2607:f8b0:4004:c02::102"</span></span><br><span class="line"><span class="string">"edns0-client-subnet 35.245.140.0/24"</span></span><br><span class="line">dig +nocl TXT o-o.myaddr.l.google.com @8.8.4.4 +short</span><br><span class="line">dig +nocl TXT o-o.myaddr.l.google.com @208.67.222.222 +short</span><br><span class="line">dig +nocl TXT o-o.myaddr.l.google.com @208.67.220.220 +short</span><br><span class="line"></span><br><span class="line"><span class="comment"># EDNS ë¯¸ ì œê³µ ì‹œ</span></span><br><span class="line">dig +nocl TXT o-o.myaddr.l.google.com @168.126.63.1 +short</span><br><span class="line"><span class="string">"59.18.51.28"</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><br><p>7.1 ENDS ë¯¸ì œê³µ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸</p><ul><li><p>ì•„ë˜ ì²˜ëŸ¼ ë¯¸êµ­ ìœ„ì¹˜ ë‹¨ë§ì´ MPLS VPN ë“± í™˜ê²½ìœ¼ë¡œ í•œêµ­ì„ ë°˜ë“œì‹œ ê²½ìœ í•˜ëŠ” í™˜ê²½ì´ë‹¤</p><ul><li><p>DNS ì„œë²„ë¥¼ í•œêµ­ KT DNS(EDNS ë¯¸ì œê³µ)ë¥¼ ì„¤ì •í•˜ê³  ì ‘ì† ì‹œ í•œêµ­ì— ìœ„ì¹˜í•œ ì›¹ì„œë²„ë¡œ ì ‘ì†ì„ í•œë‹¤</p><p>  <img src="/images/Route53-Geolocation/Untitled9.png" alt="Route53%20Geolocation%20247d8a8c113e42e29a751d6e98ff864f/Untitled%209.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ë¯¸êµ­ ìœ„ì¹˜ ë‹¨ë§</span></span><br><span class="line">curl -s https://ipvigilante.com/$(curl -s checkip.amazonaws.com) | jq <span class="string">'.data.country_name, .data.city_name, .data.ipv4'</span></span><br><span class="line"><span class="string">"United States"</span></span><br><span class="line">null</span><br><span class="line"><span class="string">"34.64.138.144"</span></span><br><span class="line">dig www.google.com |grep SERVER</span><br><span class="line">;; SERVER: 168.126.63.1<span class="comment">#53(168.126.63.1)</span></span><br><span class="line"></span><br><span class="line">curl geolo.gasida.net</span><br><span class="line">&lt;html&gt;&lt;h1&gt;Hello from MCN Web Server - Seoul Area&lt;/h1&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">dig geolo.gasida.net +short</span><br><span class="line">3.34.3.33</span><br></pre></td></tr></table></figure></li><li><p>Route 53 Query Log í™•ì¸ : ì•„ë˜  59. IPëŠ” í•œêµ­ ìœ„ì¹˜ IP ì´ë‹¤</p><p>  <img src="/images/Route53-Geolocation/Untitled10.png" alt="Route53%20Geolocation%20247d8a8c113e42e29a751d6e98ff864f/Untitled%2010.png"></p></li></ul></li></ul><br><p>7.2 EDNS ì œê³µ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸</p><ul><li><p>êµ¬ê¸€ DNS ê²½ìš° EDNS ë¥¼ ì œê³µí•˜ê¸° ë•Œë¬¸ì— DNS Query ì‹œ í™•ì¥í—¤ë”ì— ì‚¬ìš©ìì˜ ê³µì¸IPëŒ€ì—­ì„ ë‹´ì•„ì„œ ì „ë‹¬í•˜ì—¬ Route53ì—ì„œ ì¸ì‹ í›„ ë¯¸êµ­ ìœ„ì¹˜ ì›¹ ì„œë²„ IPë¥¼ ì „ë‹¬ í•´ì¤Œ</p><p>  <img src="/images/Route53-Geolocation/Untitled11.png" alt="Route53%20Geolocation%20247d8a8c113e42e29a751d6e98ff864f/Untitled%2011.png"></p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">"s/^nameserver 168.126.63.1/nameserver 8.8.8.8/g"</span> /etc/resolv.conf</span><br><span class="line">dig www.google.com |grep SERVER</span><br><span class="line">;; SERVER: 8.8.8.8<span class="comment">#53(8.8.8.8)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ì•„ë˜ì²˜ëŸ¼ EDNS ì œê³µ ì—¬ë¶€ í™•ì¸ í•  ìˆ˜ ìˆë‹¤</span></span><br><span class="line">dig +nocl TXT o-o.myaddr.l.google.com  +short</span><br><span class="line"><span class="string">"173.194.168.5"</span></span><br><span class="line"><span class="string">"edns0-client-subnet 34.64.138.0/24"</span></span><br><span class="line"></span><br><span class="line">curl geolo.gasida.net</span><br><span class="line">&lt;html&gt;&lt;h1&gt;Hello from MCN Web Server - Virgina Area&lt;/h1&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">dig geolo.gasida.net +short</span><br><span class="line">18.206.97.145</span><br></pre></td></tr></table></figure><ul><li><p>EDNS ì˜ íŒ¨í‚· ë‚´ìš©ì€ ëŒ€ëµ ì•„ë˜ì™€ ê°™ë‹¤</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ì•„ë˜ ì²˜ëŸ¼ ì‹¤í–‰ í›„ íŒ¨í‚· ìº¡ì³ í•´ì„œ í™•ì¸ í•´ë³´ì</span></span><br><span class="line">dig +nocl TXT o-o.myaddr.l.google.com @8.8.8.8 +short +subnet=34.64.138.0/24</span><br><span class="line"><span class="string">"2404:6800:400b:c002::101"</span></span><br><span class="line"><span class="string">"edns0-client-subnet 34.64.138.0/24"</span></span><br></pre></td></tr></table></figure><p>  <img src="/images/Route53-Geolocation/Untitled12.png" alt="Route53%20Geolocation%20247d8a8c113e42e29a751d6e98ff864f/Untitled%2012.png"></p></li></ul></li></ul><hr><br><h3 id="8-The-bottom-line"><a href="#8-The-bottom-line" class="headerlink" title="8. The bottom line"></a>8. The bottom line</h3><ul><li>ì¼ë°˜ì ì¸ ì‚¬ìš©ìì˜ í™˜ê²½ì—ì„œëŠ” DNS GeoLocation ì •ì±…ì— Issue ê°€ ë°œìƒí•˜ì§€ ì•Šì•„ì„œ DNSì„œë²„ê°€ ë°˜ë“œì‹œ EDNS ë¥¼ ì œê³µí•˜ëŠ”ê²ƒ í•„ìš” ì—†ë‹¤</li><li>ë‹¤ë§Œ, VPN CDN ë“±ì˜ í™˜ê²½ì—ì„œ EDNS Client Subnet ì„ ì œê³µ ì‹œ ì •í™•í•œ ì‚¬ìš©ìì˜ ìœ„ì¹˜ë¥¼ ê¸°ë°˜í•˜ê¸° ë•Œë¬¸ì— ì œê³µì„ ê¶Œì¥í•œë‹¤</li></ul><blockquote><p>ğŸ’¡ ì „ ì„¸ê³„ ëª¨ë“  DNS ì„œë²„ì— EDNS í™•ì¥ ê¸°ëŠ¥ì„ ì œê³µí•˜ê¸° ìœ„í•´ì„œ 2019 DNS Flag Day ì— ì ìš©ì„ í•˜ì˜€ë‹¤. <span class="exturl" data-url="aHR0cHM6Ly9ibG9ncy5ha2FtYWkuY29tL2tyLzIwMTkvMDEvZG5zLWZsYWctZGF5LWFrYW1haS5odG1s">ì°¸ê³ ë§í¬<i class="fa fa-external-link-alt"></i></span></p></blockquote><br>]]></content:encoded>
      
      <comments>http://cloudneta.github.io/2020/05/06/Route53-Geolocation/#disqus_thread</comments>
    </item>
    
  </channel>
</rss>
